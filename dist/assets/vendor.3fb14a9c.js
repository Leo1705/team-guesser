var yn=Object.defineProperty,vn=Object.defineProperties;var bn=Object.getOwnPropertyDescriptors;var qi=Object.getOwnPropertySymbols;var mn=Object.prototype.hasOwnProperty,gn=Object.prototype.propertyIsEnumerable;var pn=(R,F,U)=>F in R?yn(R,F,{enumerable:!0,configurable:!0,writable:!0,value:U}):R[F]=U,li=(R,F)=>{for(var U in F||(F={}))mn.call(F,U)&&pn(R,U,F[U]);if(qi)for(var U of qi(F))gn.call(F,U)&&pn(R,U,F[U]);return R},yi=(R,F)=>vn(R,bn(F));var Vi=(R,F)=>{var U={};for(var se in R)mn.call(R,se)&&F.indexOf(se)<0&&(U[se]=R[se]);if(R!=null&&qi)for(var se of qi(R))F.indexOf(se)<0&&gn.call(R,se)&&(U[se]=R[se]);return U};const base62="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function randomId(R){let F=R+"_";for(let U=0;U<22;++U)F+=base62.charAt(Math.random()*62>>>0);return F}function shortHash(R){let F=0;for(let se=0,ve=R.length;se<ve;++se)F=Math.imul(31,F)+R.charCodeAt(se)>>>0;if(F==0)return"0";let U="";for(;F>0;)U+=base62.charAt(F%62),F=F/62>>>0;return U}let cachedPayload;function decode$1(){if(cachedPayload)return cachedPayload;try{return cachedPayload=decodeRaw(location.href)}catch(R){console.error("Failed to decode payload",R),analytics.track("PayloadDecodeError",{url:location.href})}return cachedPayload={}}function decodeRaw(R){const F=new URL(R),se=new URL(F.hash.substring(1),F.origin).searchParams.get("link");if(se)return JSON.parse(se)||{};try{return JSON.parse(decodeURIComponent(F.hash.substring(1)))}catch{}return{}}function encode(R){const F=new URL(location.href),U=new URL(F.hash.substring(1),F.origin);return U.searchParams.set("link",JSON.stringify(R)),F.hash=U.pathname+U.search,F.toString()}function stripPayloadsFromUrl(R){const F=new URL(R),U=new URL(F.hash.substring(1),F.origin);return U.searchParams.has("link")&&(U.searchParams.delete("link"),F.hash=U.pathname+U.search,F.hash=="#/"&&(F.hash="")),F.searchParams.delete("payload"),F.toString()}class CloudStorage{constructor(F){this.localStorage=F}async onLogin(F){this.replicantClient=F;for(const se in F.storage.get())return;const U={};for(const se of await this.localStorage.getAllKeys()){const ve=await this.localStorage.get(se);U[se]=ve}await F.storage.set(U),this.localStorage.clear()}set(F,U){return this.replicantClient&&this.replicantClient.isLoggedIn()?this.replicantClient.storage.set({[F]:U}):this.localStorage.set(F,U)}get(F){return this.replicantClient&&this.replicantClient.isLoggedIn()?Promise.resolve(this.replicantClient.storage.get()[F]):this.localStorage.get(F)}remove(F){return this.replicantClient&&this.replicantClient.isLoggedIn()?this.replicantClient.storage.remove([F]):this.localStorage.remove(F)}}function toPromise(R){return new Promise((F,U)=>{R.onsuccess=()=>{F(R.result)},R.onerror=()=>{U(R.error)}})}class IDBStorage{constructor(F){this.internal=F;const U=indexedDB.open("Playpass",1);U.onupgradeneeded=()=>{const se=U.result;se.createObjectStore("Internal"),se.createObjectStore("Game")},this.db=toPromise(U)}set(F,U){return this.callStore("readwrite",se=>se.put(U,F))}get(F){return this.callStore("readonly",U=>U.get(F))}getAllKeys(){return this.callStore("readonly",F=>F.getAllKeys())}clear(){return this.callStore("readwrite",F=>F.clear())}remove(F){return this.callStore("readwrite",U=>U.delete(F))}async callStore(F,U){const se=await this.db,ve=this.internal?"Internal":"Game",ct=se.transaction(ve,F).objectStore(ve),pt=U(ct);return toPromise(pt)}}const cloudStorage=new CloudStorage(new IDBStorage(!1)),storage=cloudStorage,internalStorage=new IDBStorage(!0);let cachedFeatureFlags;async function initFeatureFlags(){cachedFeatureFlags=await internalStorage.get("featureFlags")||{};const R=decode$1();if(R.featureFlags){for(const F in R.featureFlags)cachedFeatureFlags[F]=!!R.featureFlags[F];internalStorage.set("featureFlags",cachedFeatureFlags)}setFeatureFlagUserProp()}function setFeatureFlagUserProp(){analytics.setUserProperties({featureFlags:cachedFeatureFlags})}var es=Object.create,ft=Object.defineProperty,ts=Object.getOwnPropertyDescriptor,rs=Object.getOwnPropertyNames,ss=Object.getPrototypeOf,ns=Object.prototype.hasOwnProperty,ke=(R,F)=>()=>(F||R((F={exports:{}}).exports,F),F.exports),is=(R,F)=>{for(var U in F)ft(R,U,{get:F[U],enumerable:!0})},as=(R,F,U,se)=>{if(F&&typeof F=="object"||typeof F=="function")for(let ve of rs(F))!ns.call(R,ve)&&ve!==U&&ft(R,ve,{get:()=>F[ve],enumerable:!(se=ts(F,ve))||se.enumerable});return R},Oe=(R,F,U)=>(U=R!=null?es(ss(R)):{},as(F||!R||!R.__esModule?ft(U,"default",{value:R,enumerable:!0}):U,R)),mt=(R,F,U)=>{if(!F.has(R))throw TypeError("Cannot "+U)},O=(R,F,U)=>(mt(R,F,"read from private field"),U?U.call(R):F.get(R)),me=(R,F,U)=>{if(F.has(R))throw TypeError("Cannot add the same private member more than once");F instanceof WeakSet?F.add(R):F.set(R,U)},ne=(R,F,U,se)=>(mt(R,F,"write to private field"),se?se.call(R,U):F.set(R,U),U),C$1=(R,F,U)=>(mt(R,F,"access private method"),U),dr=ke((R,F)=>{(function(U,se){typeof R=="object"&&typeof F<"u"?F.exports=se():typeof define=="function"&&define.amd?define(se):(U=typeof globalThis<"u"?globalThis:U||self,U["fast-copy"]=se())})(R,function(){var U=Function.prototype.toString,se=Object.create,ve=Object.defineProperty,ct=Object.getOwnPropertyDescriptor,pt=Object.getOwnPropertyNames,yt=Object.getOwnPropertySymbols,Et=Object.getPrototypeOf,Xt=Object.prototype,Tt=Xt.hasOwnProperty,lr=Xt.propertyIsEnumerable,jr={SYMBOL_PROPERTIES:typeof yt=="function",WEAKMAP:typeof WeakMap=="function"},Vr=function(){if(jr.WEAKMAP)return new WeakMap;var Jr=se({has:function(ei){return!!~Jr._keys.indexOf(ei)},set:function(ei,oi){Jr._keys.push(ei),Jr._values.push(oi)},get:function(ei){return Jr._values[Jr._keys.indexOf(ei)]}});return Jr._keys=[],Jr._values=[],Jr},ri=function(Jr,ei){if(!Jr.constructor)return se(null);var oi=Jr.constructor,ai=Jr.__proto__||Et(Jr);if(oi===ei.Object)return ai===ei.Object.prototype?{}:se(ai);if(~U.call(oi).indexOf("[native code]"))try{return new oi}catch{}return se(ai)},si=function(Jr,ei,oi,ai){var hi=ri(Jr,ei);ai.set(Jr,hi);for(var fi in Jr)Tt.call(Jr,fi)&&(hi[fi]=oi(Jr[fi],ai));if(jr.SYMBOL_PROPERTIES){var ii=yt(Jr),ci=ii.length;if(ci)for(var ni=0,ti=void 0;ni<ci;ni++)ti=ii[ni],lr.call(Jr,ti)&&(hi[ti]=oi(Jr[ti],ai))}return hi},Zr=function(Jr,ei,oi,ai){var hi=ri(Jr,ei);ai.set(Jr,hi);var fi=jr.SYMBOL_PROPERTIES?pt(Jr).concat(yt(Jr)):pt(Jr),ii=fi.length;if(ii){for(var ci=0,ni=void 0,ti=void 0;ci<ii;ci++)if(ni=fi[ci],ni!=="callee"&&ni!=="caller")if(ti=ct(Jr,ni),ti){!ti.get&&!ti.set&&(ti.value=oi(Jr[ni],ai));try{ve(hi,ni,ti)}catch{hi[ni]=ti.value}}else hi[ni]=oi(Jr[ni],ai)}return hi},di=function(Jr){var ei="";return Jr.global&&(ei+="g"),Jr.ignoreCase&&(ei+="i"),Jr.multiline&&(ei+="m"),Jr.unicode&&(ei+="u"),Jr.sticky&&(ei+="y"),ei},gi=Array.isArray,ui=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;console&&console.error&&console.error('Unable to locate global object, returning "this".')}();function pi(Jr,ei){var oi=!!(ei&&ei.isStrict),ai=ei&&ei.realm||ui,hi=oi?Zr:si,fi=function(ii,ci){if(!ii||typeof ii!="object")return ii;if(ci.has(ii))return ci.get(ii);var ni=ii.constructor;if(ni===ai.Object)return hi(ii,ai,fi,ci);var ti;if(gi(ii)){if(oi)return Zr(ii,ai,fi,ci);var mi=ii.length;ti=new ni,ci.set(ii,ti);for(var xi=0;xi<mi;xi++)ti[xi]=fi(ii[xi],ci);return ti}if(ii instanceof ai.Date)return new ni(ii.getTime());if(ii instanceof ai.RegExp)return ti=new ni(ii.source,ii.flags||di(ii)),ti.lastIndex=ii.lastIndex,ti;if(ai.Map&&ii instanceof ai.Map)return ti=new ni,ci.set(ii,ti),ii.forEach(function($i,Oi){ti.set(Oi,fi($i,ci))}),ti;if(ai.Set&&ii instanceof ai.Set)return ti=new ni,ci.set(ii,ti),ii.forEach(function($i){ti.add(fi($i,ci))}),ti;if(ai.Blob&&ii instanceof ai.Blob)return ii.slice(0,ii.size,ii.type);if(ai.Buffer&&ai.Buffer.isBuffer(ii))return ti=ai.Buffer.allocUnsafe?ai.Buffer.allocUnsafe(ii.length):new ni(ii.length),ci.set(ii,ti),ii.copy(ti),ti;if(ai.ArrayBuffer){if(ai.ArrayBuffer.isView(ii))return ti=new ni(ii.buffer.slice(0)),ci.set(ii,ti),ti;if(ii instanceof ai.ArrayBuffer)return ti=ii.slice(0),ci.set(ii,ti),ti}return typeof ii.then=="function"||ii instanceof Error||ai.WeakMap&&ii instanceof ai.WeakMap||ai.WeakSet&&ii instanceof ai.WeakSet?ii:hi(ii,ai,fi,ci)};return fi(Jr,Vr())}return pi.default=pi,pi.strict=function(Jr,ei){return pi(Jr,{isStrict:!0,realm:ei?ei.realm:void 0})},pi})}),hr=ke((R,F)=>{F.exports=function U(se,ve){if(se===ve)return!0;if(se&&ve&&typeof se=="object"&&typeof ve=="object"){if(se.constructor!==ve.constructor)return!1;var ct,pt,yt;if(Array.isArray(se)){if(ct=se.length,ct!=ve.length)return!1;for(pt=ct;pt--!==0;)if(!U(se[pt],ve[pt]))return!1;return!0}if(se.constructor===RegExp)return se.source===ve.source&&se.flags===ve.flags;if(se.valueOf!==Object.prototype.valueOf)return se.valueOf()===ve.valueOf();if(se.toString!==Object.prototype.toString)return se.toString()===ve.toString();if(yt=Object.keys(se),ct=yt.length,ct!==Object.keys(ve).length)return!1;for(pt=ct;pt--!==0;)if(!Object.prototype.hasOwnProperty.call(ve,yt[pt]))return!1;for(pt=ct;pt--!==0;){var Et=yt[pt];if(!U(se[Et],ve[Et]))return!1}return!0}return se!==se&&ve!==ve}}),qr=ke(R=>{Object.defineProperty(R,"__esModule",{value:!0}),R.InMemoryStorageAdapter=void 0;var F=function(){function U(se){this.storage=se,this.cache=new Map}return Object.defineProperty(U.prototype,"length",{get:function(){return this.storage.length},enumerable:!1,configurable:!0}),U.prototype.clear=function(){this.cache.clear(),this.storage.clear()},U.prototype.getItem=function(se){var ve=this.storage.getItem(se);return typeof ve<"u"&&ve!==null?(this.cache.set(se,ve),ve):this.cache.has(se)?this.cache.get(se):ve},U.prototype.key=function(se){return this.storage.key(se)},U.prototype.removeItem=function(se){this.cache.delete(se),this.storage.removeItem(se)},U.prototype.setItem=function(se,ve){this.cache.set(se,ve),this.storage.setItem(se,ve)},U}();R.InMemoryStorageAdapter=F}),Lt=ke(R=>{Object.defineProperty(R,"__esModule",{value:!0}),R.localStorage=R.getLocalStorage=R.isLocalStorageAvailable=void 0;var F=qr(),U={length:0,clear:function(){},getItem:function(){return null},key:function(){return null},removeItem:function(){},setItem:function(){}};function se(){try{var ct=new Date().toString();window.localStorage.setItem(ct,ct);var pt=window.localStorage.getItem(ct)===ct;return window.localStorage.removeItem(ct),pt}catch{return!1}}R.isLocalStorageAvailable=se;function ve(){return typeof window<"u"&&se()?window.localStorage:U}R.getLocalStorage=ve,R.localStorage=new F.InMemoryStorageAdapter(ve())}),ce=class{constructor(){this.migrations=[]}addMigration(R,F){if(R!==this.migrations.length+1)throw new Error("Migration version "+R+" not consecutive!");this.migrations.push(F)}getLatestVersion(){return this.migrations.length+1}applyMigration(R,F){let U=F-1;if(U<0||U>=this.migrations.length)throw new Error("Invalid migrationIndex: "+U+" when trying to migrate to version "+F);this.migrations[U](R)}},kt={};is(kt,{ArraySchema:()=>Fe,BooleanSchema:()=>Ne,IntegerSchema:()=>Ce,NumberSchema:()=>de,ObjectSchema:()=>De,Schema:()=>W,StringSchema:()=>Me,TupleSchema:()=>Ue,UnionSchema:()=>Le,UnknownSchema:()=>Be,array:()=>gs,boolean:()=>ps,float:()=>ls,int:()=>hs,map:()=>ys,number:()=>ds,object:()=>ms,string:()=>us,tuple:()=>Ss,union:()=>fs,unknown:()=>mr});function re$1(R){return R[0]==="Err"}function Q(R){return R[0]==="Ok"}var L$1=R=>["Ok",R],v$1=R=>["Err",R],ie=R=>["DecodeError",R],q=(R,F)=>["TypeMismatch",R,F],Zt=(R,F)=>["ErrorAtIndex",R,F],gt=(R,F)=>["ErrorAtProperty",R,F],Re=R=>()=>L$1(R),St=R=>()=>v$1([ie(R)]),er=()=>v$1([]),bt=L$1,tr=R=>typeof R=="boolean"?L$1(R):v$1([q("boolean",typeof R)]),_t=R=>typeof R=="string"?L$1(R):v$1([q("string",typeof R)]),rr=R=>typeof R!="number"?v$1([q("number",typeof R)]):Number.isFinite(R)?L$1(R):v$1([q("number",R.toString())]),sr=R=>typeof R!="number"?v$1([q("integer",typeof R)]):Number.isInteger(R)?L$1(R):v$1([q("integer",R.toString())]),nr=(R,F)=>U=>{let se=R(U);return re$1(se)?se:L$1(F(se[1]))},ir=(R,F)=>U=>{let se=R(U);if(Q(se))return se;let ve=F(U);return Q(ve)?ve:v$1(se[1].concat(ve[1]))},ge=(R,F)=>U=>{let se=R(U);return re$1(se)?se:F(se[1])(U)},ar=R=>F=>{if(!Array.isArray(F))return v$1([q("array",typeof F)]);let U=R,se=new Array(F.length),ve=[],ct;for(let pt=0;pt<F.length;pt++)ct=U(F[pt]),Q(ct)?se[pt]=ct[1]:ve.push(...ct[1].map(yt=>Zt(pt,yt)));return ve.length?v$1(ve):L$1(se)},At=R=>F=>{if(typeof F!="object")return v$1([q("object",typeof F)]);if(F===null)return v$1([q("object","null")]);let U=F,se=R,ve={},ct=[];for(let pt in U)if(Object.prototype.hasOwnProperty.call(U,pt)){let yt=se(U[pt]);Q(yt)?ve[pt]=yt[1]:ct.push(...yt[1].map(Et=>gt(pt,Et)))}return ct.length?v$1(ct):L$1(ve)},or=R=>F=>{if(typeof F!="object")return v$1([q("object",typeof F)]);if(F===null)return v$1([q("object","null")]);let U=F,se={},ve=[];for(let ct in R)if(Object.prototype.hasOwnProperty.call(R,ct)){let pt=(0,R[ct])(U[ct]);Q(pt)?typeof pt[1]<"u"&&(se[ct]=pt[1]):ve.push(...pt[1].map(yt=>gt(ct,yt)))}return ve.length?v$1(ve):L$1(se)},It=(R,F)=>U=>{let se=F(U);return re$1(se)?se:se[1]<R?v$1([ie("Unexpected value: expected >= "+R+", found "+se[1])]):se},wt=(R,F)=>U=>{let se=F(U);return re$1(se)?se:se[1]>R?v$1([ie("Unexpected value: expected <= "+R+", found "+se[1])]):se},cr=(R,F)=>U=>{let se=F(U);return re$1(se)?se:se[1].length<R?v$1([ie("Unexpected value: expected .length >= "+R+", found "+se[1].length)]):se},ur=(R,F)=>U=>{let se=F(U);return re$1(se)?se:se[1].length>R?v$1([ie("Unexpected value: expected .length <= "+R+", found "+se[1].length)]):se};function ye(R,F){return R(F)}function xe(R){switch(R[0]){case"DecodeError":return R[1];case"ErrorAtIndex":return"Error at array index  "+R[1]+": "+xe(R[2]);case"ErrorAtProperty":return"Error at property "+R[1]+": "+xe(R[2]);case"TypeMismatch":return"Type mismatch: expected "+R[1]+", found "+R[2]}}var pr=Oe(dr()),fr=Oe(hr());function ue(R,F){if(typeof F=="object"&&Array.isArray(F)){if(typeof R!="object"||!Array.isArray(R))return x$1(F);let U=!1,se=[...F];for(let ve=0;ve<F.length;ve++){let ct=ue(R[ve],F[ve]);ct!==R[ve]&&(U=!0),se[ve]=ct}return F.length!==R.length&&(U=!0),U?se:R}if(typeof F=="object"){if(typeof R!="object")return x$1(F);let U=!1,se=li({},F);for(let ve in F){let ct=ue(R[ve],F[ve]);ct!==R[ve]&&(U=!0),se[ve]=ct}for(let ve in R)if(!(ve in F)){U=!0;break}return U?se:R}return F!==R?F:R}function x$1(R){return(0,pr.default)(R)}function Pe(R,F){return(0,fr.default)(R,F)}function Y(R,F){let U={};for(let se in R)U[se]=F(se,R[se]);return U}var W=class{constructor(){this.__schema=!0,this.required=!0,this.defaultValueSet=!1,this.customValidatorFn=()=>null}isArraySchema(){return this._type==="array"}isObjectSchema(){return this._type==="object"}optional(){return this.required=!1,this}default(R){return this.tryValidate(R),this.defaultValue=R,this.defaultValueSet=!0,this}customValidator(R){return this.customValidatorFn=R,this}getDefault(){if(this.tryValidate(this.defaultValue),!(!this.required&&!this.defaultValueSet))return x$1(this.defaultValue)}tryValidate(R,F){let U=this.validate(R,F);if(U)throw new Error(U)}validate(R,F){return this.validateType(R,F)||(this.required||R!==void 0?this.customValidatorFn(R,F):null)}isValid(R){return!this.validate(R)}tryValidateAndFillDefaults(R,F){return R===void 0&&this.required?this.getDefault():(this.tryValidate(R,F),null)}tryDecode(R){let F=ye(this.toDecoder(),R);if(Q(F))return F[1];throw new Error(F[1].map(xe).join(`
`))}},de=class extends W{constructor(){super(),this._type="number",this.minVal=-1/0,this.maxVal=1/0,this.defaultValue=0}range(R,F){return this.minVal=R,this.maxVal=F,this}min(R){return this.minVal=R,this}max(R){return this.maxVal=R,this}validateType(R){return R===void 0&&!this.required?null:typeof R!="number"?"Not a number: "+R:this.minVal>R||this.maxVal<R?"Out of range: "+R+" in range ["+this.minVal+", "+this.maxVal+"]":isNaN(R)?"Value is NaN":null}serialize(){return{type:"number",optional:!this.required}}toDecoder(){let R=rr;return R=It(this.minVal,R),R=wt(this.maxVal,R),X(this,R)}},Ce=class extends de{constructor(){super(),this._type="integer"}validateType(R){return R===void 0&&!this.required?null:super.validateType(R)||(parseInt(R.toString(),10)!==R?"Not an integer":null)}toDecoder(){let R=sr;return R=It(this.minVal,R),R=wt(this.maxVal,R),X(this,R)}},Ne=class extends W{constructor(){super(),this._type="boolean",this.defaultValue=!1}validateType(R){return R===void 0&&!this.required?null:typeof R!="boolean"?"Not a boolean":null}serialize(){return{type:"boolean",optional:!this.required}}toDecoder(){return X(this,tr)}},Me=class extends W{constructor(){super(),this._type="string",this.defaultValue=""}validateType(R){return R===void 0&&!this.required||typeof R=="string"?null:"Not a string: "+R}serialize(){return{type:"string",optional:!this.required}}toDecoder(){return X(this,_t)}},De=class extends W{constructor(R){var F;super(),this._type="object",this.objValidators=R;for(let U in R)if(typeof R[U]!="object"||!((F=R[U])!=null&&F.__schema))throw new Error("Schema for field "+U+" not constructed by SchemaBuilder.")}validateType(R,F){if(R===void 0&&!this.required)return null;if(typeof R!="object"||R===null)return"Not an object: "+R;for(let se in R){let ve=this.objValidators[se],ct=F&&!!F.ignoreUnexpectedFields;if(!ve){if(ct)continue;if(!this.additionalPropertyValuesSchema)return"Unexpected field: "+se;ve=this.additionalPropertyValuesSchema}let pt=ve.validate(R[se],F);if(pt)return"Error validating field `"+se+"`: "+pt}let U=Object.keys(this.objValidators).filter(se=>this.objValidators[se].required).filter(se=>typeof R[se]>"u");return U.length>0?"Missing fields: "+U.join(", "):null}tryValidateAndFillDefaults(R,F){if(R===void 0&&!this.required)return null;if(typeof R!="object"||R===null)throw new Error("Not an object.");let U=!1;for(let ve in R){let ct=this.objValidators[ve],pt=F&&!!F.ignoreUnexpectedFields;if(!ct){if(pt)continue;if(!this.additionalPropertyValuesSchema)throw new Error("Unexpected field: "+ve);ct=this.additionalPropertyValuesSchema}let yt;try{yt=ct.tryValidateAndFillDefaults(R[ve],F)}catch(Et){throw new Error("Error validating field `"+ve+"`: "+Et.message)}yt&&(U||(R=x$1(R),U=!0),R[ve]=yt)}let se=Object.keys(this.objValidators).filter(ve=>this.objValidators[ve].required).filter(ve=>typeof R[ve]>"u");for(let ve of se)U||(R=x$1(R),U=!0),R[ve]=this.objValidators[ve].getDefault();return U?R:null}getDefault(){if(!this.required&&!this.defaultValueSet)return;let R;return this.defaultValue?R=this.defaultValue:R=Object.keys(this.objValidators).map(F=>({[F]:this.objValidators[F].getDefault()})).reduce((F,U)=>li(li({},F),U),{}),this.tryValidate(R),x$1(R)}serialize(){let R={};for(let F in this.objValidators)R[F]=this.objValidators[F].serialize();return{type:"object",optional:!this.required,fields:R}}getSchema(R){return this.objValidators[R]}getFullSchema(){return this.objValidators}additionalProperties(R){return this.additionalPropertyValuesSchema=R||mr(),this}toDecoder(){let R={};Object.entries(this.objValidators).forEach(([U,se])=>{R[U]=se.toDecoder()});let F=or(R);if(this.additionalPropertyValuesSchema){let U=this.additionalPropertyValuesSchema.toDecoder();F=ge(F,se=>ge(At(bt),ve=>{let ct={},pt;return Object.entries(ve).forEach(([yt,Et])=>{pt=ye(U,Et),Q(pt)&&(ct[yt]=pt[1])}),Re(li(li({},ct),se))}))}return X(this,F)}},Fe=class extends W{constructor(R){if(super(),this._type="array",this.minLengthVal=-1/0,this.maxLengthVal=1/0,this.defaultValue=[],this.itemSchema=R,typeof R!="object"||!R.__schema)throw new Error("Item schema for array not constructed by SchemaBuilder")}lengthRange(R,F){return this.minLengthVal=R,this.maxLengthVal=F,this}minLength(R){return this.minLengthVal=R,this}maxLength(R){return this.maxLengthVal=R,this}length(R){return this.minLengthVal=this.maxLengthVal=R,this}validateType(R,F){var U;if(R===void 0&&!this.required)return null;if(typeof R!="object"||!Array.isArray(R))return"Not an array "+R;if(this.minLengthVal>R.length||this.maxLengthVal<R.length)return`Length out of range: ${R.length} in range [${this.minLengthVal}, ${this.maxLengthVal}]`;for(let se=0;se<R.length;se++){let ve=(U=R[se])!=null?U:void 0,ct=this.itemSchema.validate(ve,F);if(ct)return"Error validating item "+se+": "+ct}return null}tryValidateAndFillDefaults(R,F){var se;if(R===void 0&&!this.required)return null;let U=!1;for(let ve=0;ve<R.length;ve++){let ct=(se=R[ve])!=null?se:void 0,pt;try{pt=this.itemSchema.tryValidateAndFillDefaults(ct,F)}catch(yt){throw new Error("Error validating item "+ve+": "+yt.message)}pt!==null&&(U||(R=x$1(R)),R[ve]=pt,U=!0)}return this.tryValidate(R,F),U?R:null}getDefault(){if(!(!this.required&&!this.defaultValueSet))return this.tryValidate(this.defaultValue),x$1(this.defaultValue)}serialize(){return{type:"array",optional:!this.required,items:this.itemSchema.serialize()}}getItemSchema(){return this.itemSchema}toDecoder(){let R=this.itemSchema.toDecoder(),F=ar(U=>ye(R,U!=null?U:void 0));return F=cr(this.minLengthVal,F),F=ur(this.maxLengthVal,F),X(this,F)}},Ue=class extends W{constructor(R){if(super(),this.values=R,this._type="tuple",R.length===0)throw new Error("Tuple schema requires at least one string literal type.")}validateType(R){return R===void 0&&!this.required||this.values.includes(R)?null:R+" is not valid, possible values: "+this.values.join(", ")}getDefault(){if(!(!this.required&&!this.defaultValueSet))return this.defaultValueSet?this.defaultValue:this.values[0]}serialize(){return{type:"tuple",optional:!this.required,values:this.values}}toDecoder(){let R=ge(_t,F=>this.values.includes(F)?Re(F):St("Expected one of { "+this.values.map(U=>JSON.stringify(U)).join(", ")+" }"));return X(this,R)}},vt=class extends W{constructor(R){if(super(),this._type="map",this.itemSchema=R,typeof R!="object"||!R.__schema)throw new Error("Item schema for array not constructed by SchemaBuilder");this.defaultValue={}}validateType(R,F){if(R===void 0&&!this.required)return null;if(typeof R!="object"||R===null)return"Not a map: "+R;for(let U in R){let se=this.itemSchema.validate(R[U],F);if(se)return'Error validating item in map with key "'+U+'": '+se}return null}tryValidateAndFillDefaults(R,F){if(this.required&&R===void 0)return this.getDefault();if(R===void 0&&!this.required)return null;if(typeof R!="object"||R===null)return"Not a map: "+R;let U=!1;for(let se in R){let ve;try{ve=this.itemSchema.tryValidateAndFillDefaults(R[se],F)}catch(ct){throw new Error('Error validating item in map with key "'+se+'": '+ct.message)}ve&&(U||(R=x$1(R)),R[se]=ve,U=!0)}return U?R:null}getDefault(){if(!(!this.required&&!this.defaultValueSet))return this.tryValidate(this.defaultValue),x$1(this.defaultValue)}serialize(){return{type:"map",optional:!this.required,items:this.itemSchema.serialize()}}toDecoder(){let R=At(this.itemSchema.toDecoder());return X(this,R)}},Le=class extends W{constructor(R){if(super(),this._type="union",R.length===0)throw new Error("Cannot define empty union type");this.itemSchemas=R}validateType(R,F){if(R===void 0&&!this.required)return null;let U=[];for(let se of this.itemSchemas){let ve=se.validate(R,F);if(ve)U.push("Could not validate value as "+se.constructor.name+": "+ve);else return null}return U.join(`
`)}getDefault(){if(!(!this.required&&!this.defaultValueSet))return this.defaultValueSet?this.defaultValue:this.itemSchemas[0].getDefault()}tryValidateAndFillDefaults(R,F){if(this.required&&R===void 0)return this.getDefault();if(R===void 0&&!this.required||!this.validate(R,F))return null;let U=[];for(let se of this.itemSchemas)try{return se.tryValidateAndFillDefaults(R,F)}catch(ve){U.push(ve)}throw new Error("Could not validate union: "+U.join(","))}serialize(){return{type:"union",optional:!this.required,variants:this.itemSchemas.map(R=>R.serialize())}}toDecoder(){let R=[...this.itemSchemas].reverse().reduce((F,U)=>ir(U.toDecoder(),F),er);return X(this,R)}},Be=class extends W{constructor(){return super(),this._type="unknown",this.optional()}validateType(R){return null}serialize(){return{type:"unknown",optional:!this.required}}toDecoder(){return nr(bt,x$1)}};function us(){return new Me}function ds(){return new de}function ls(){return new de}function hs(){return new Ce}function ps(){return new Ne}function fs(R){return new Le(R)}function ms(R){return new De(R)}function gs(R){return new Fe(R)}function ys(R){return new vt(R)}function Ss(R){return new Ue(R)}function mr(){return new Be}var X=(R,F)=>{let U=R.customValidatorFn;return U&&(F=ge(F,se=>{let ve=U(se);return ve?St(ve):Re(se)})),se=>typeof se>"u"?L$1(R.getDefault()):ye(F,se)},a$2=kt;function gr(R,F){switch(R){case"fb":case"line":case"link":case"snapchat":case"viber":case"zoom":case"tiktok":case"mock":return R;default:if(F)return F;throw new Error("Unsupported platform: "+R)}}function Z(R=Math.random){return R().toString(36).substr(2,9)}function yr(){try{return{}.STAGE}catch{return}}function Ot(R){throw new Error(`Invalid value: '${R}'`)}function j({days:R=0,hours:F=0,minutes:U=0,seconds:se=0,ms:ve=0}){return ve+se*1e3+U*6e4+F*36e5+R*864e5}function Sr(R){let F;try{F=JSON.parse(JSON.stringify(R))}catch{return!1}return Pe(F,R)}var br="web_",qe="_heartbeat",Rt="_applyMessages",_r=j({seconds:30}),Ar=j({seconds:90}),je=j({seconds:30}),K={network_error:"network_error",replication_error:"replication_error",version_error:"version_error",session_desync_error:"session_desync_error",authorization_error:"authorization_error",server_error:"server_error",unknown_error:"unknown_error"},xt={audience_mismatch:"audience_mismatch",id_mismatch:"id_mismatch",invalid_platform:"invalid_platform",invalid_otp_code:"invalid_otp_code",invalid_otp_receiver:"invalid_otp_receiver",invalid_scope:"invalid_scope",invalid_signature:"invalid_signature",token_expired:"token_expired"},Ir=yi(li({},xt),{action_args_too_large:"action_args_too_large",analytics_user_properties_error:"analytics_user_properties_error",db_error:"db_error",exceeded_message_reduction_threshold:"exceeded_message_reduction_threshold",gender_inference_error:"gender_inference_error",index_doc_too_large:"index_doc_too_large",invalid_ecpm:"invalid_ecpm",invalid_state:"invalid_state",invalid_action:"invalid_action",invalid_message:"invalid_message",invalid_phone_number:"invalid_phone_number",message_args_too_large:"message_args_too_large",missing_messages:"missing_messages",client_time_invalid:"client_time_invalid",client_time_offset_too_large:"client_time_offset_too_large",random_seed_invalid:"random_seed_invalid",message_errored:"message_errored",async_action_api_error:"async_action_api_error",delayed_actions_error:"delayed_actions_error",async_getter_error:"async_getter_error",payment_signature_verification_error:"payment_signature_verification_error",payment_already_purchased_error:"payment_already_purchased_error",scheduled_action_args_too_large:"scheduled_action_args_too_large",shared_state_message_args_too_large:"shared_state_message_args_too_large",user_asset_upload_error:"user_asset_upload_error",scheduled_actions_error:"scheduled_actions_error",key_value_storage_error:"key_value_storage_error",admin_interface_error:"admin_interface_error",user_login_error:"user_login_error",payload_too_large:"payload_too_large",state_too_large:"state_too_large",rev_id_mismatch:"rev_id_mismatch",request_replayed:"request_replayed",retry_queue_mismatch:"retry_queue_mismatch",invoking_while_out_of_sync:"invoking_while_out_of_sync",push_notification_error:"push_notification_error",search_error:"search_error",ab_tests_error:"ab_tests_error",chatbot_receiver_not_found:"chatbot_receiver_not_found",chatbot_missing_player:"chatbot_missing_player",chatbot_missing_receiver:"chatbot_missing_receiver",chatbot_missing_sender:"chatbot_missing_sender",chatbot_missing_configuration:"chatbot_missing_configuration",chatbot_missing_asset:"chatbot_missing_asset",chatbot_missing_asset_url:"chatbot_missing_asset_url",chatbot_send_error:"chatbot_send_error",fb_comment_retrieval_error:"fb_comment_retrieval_error",webhook_referral_url_not_set:"webhook_referral_url_not_set",webhook_referral_player_not_found:"webhook_referral_player_not_found",webhook_postback_missing_params:"webhook_postback_missing_params",payment_subscription_invalid_otp:"payment_subscription_invalid_otp"}),w$1=class extends Error{constructor(R,F,U,se,ve){super(R),this.code=F,this.subCode=U,this.severity=se,this.extras=ve,this.name="ReplicantError"}},bs=()=>{let R=new WeakSet;return(F,U)=>{if(typeof U=="object"&&U!==null){if(R.has(U))return;R.add(U)}return U}},_s=R=>R instanceof Error?R:JSON.stringify(R,bs(),4),G;(function(R){R[R.debug=0]="debug",R[R.info=1]="info",R[R.log=2]="log",R[R.warn=3]="warn",R[R.error=4]="error",R[R.fatal=5]="fatal"})(G||(G={}));var wr=G.info,le=(R,F)=>(F||(F=G[R]),(...U)=>{R>=wr&&console[F].apply(null,U.map(se=>typeof se=="object"?_s(se):se))}),As={debug:le(G.debug,"log"),info:le(G.info),log:le(G.log),warn:le(G.warn),error:le(G.error),fatal:le(G.fatal,"error"),level:R=>{if(G[R]===void 0)throw new Error("Unknown log level"+R+". Please use the LogLevel enum to set it");wr=R}},J=As,Er=j({days:30}),Tr=1/0;function Ve(R,F){let U=Er;try{U=Number({}.APPLE_DEVICE_TOKEN_EXPIRY_IN_MS)||Er}catch{}return R+U<F}function Ge(R,F){let U=Tr;try{U=Number({}.ANDROID_DEVICE_TOKEN_EXPIRY_IN_MS)||Tr}catch{}return R+U<F}var vr="__serialized__",Is="__error__";function Pt(R){if(typeof R=="object"&&R!==null&&R[vr]===Is){let F=R.name==="ReplicantError"?new w$1(R.message,R.code):Error();for(let U of Object.keys(R))U!==vr&&(F[U]=R[U]);return F}return R}function kr(R,F=-1){return F=Math.max(F,-1),U(R,0);function U(pt,yt){switch(typeof pt){case"object":return pt===null?"null":Array.isArray(pt)?ve(pt,yt):!pt.constructor||pt.constructor.name==="Object"?se(pt,yt):pt.constructor.name==="RegExp"?pt.toString():pt.constructor.name?"[object "+pt.constructor.name+"]":"[anonymous object]";case"undefined":return"undefined";case"number":if(Number.isNaN(pt))return"NaN";switch(pt){case 1/0:return"Infinity";case-1/0:return"-Infinity";default:return JSON.stringify(pt)}case"bigint":return pt.toString()+"n";case"function":return pt.name?"[function "+pt.name+"]":"[anonymous function]";case"symbol":return pt.toString();default:return JSON.stringify(pt)}}function se(pt,yt){let Et=[];for(let Xt in pt)pt.hasOwnProperty(Xt)&&Et.push(JSON.stringify(Xt)+": "+U(pt[Xt],yt+1));return ct(Et,"{","}",yt)}function ve(pt,yt){let Et=[];for(let Xt of pt)Et.push(U(Xt,yt+1));return ct(Et,"[","]",yt)}function ct(pt,yt,Et,Xt){return pt.length===0?yt+Et:F===-1?[yt,pt.join(", "),Et].join(" "):[yt,pt.map(Tt=>" ".repeat(F*(Xt+1))+Tt).join(`,
`)," ".repeat(F*Xt)+Et].join(`
`)}}function He(R){return R.startsWith(br)}function We(R){let F=2166136261;if(R)for(let U=0,se=R.length;U<se;U++){F=(F^R.charCodeAt(U))>>>0;let ve=(F<<1)+(F<<4)+(F<<7)+(F<<8)+(F<<24);F=F+ve>>>0}return F}function Ct(R){let F=R.v0,U=R.v1,se=0,ve=2654435769;se+=ve,F+=(U<<4)+2738958700^U+se^(U>>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>5)+2123724318,se+=ve,F+=(U<<4)+2738958700^U+se^(U>>5)+3355524772,U+=(F<<4)+2911926141^F+se^(F>>5)+2123724318,R.v0=F,R.v1=U}function Or(R,F=0){typeof R=="string"&&(R=We(R)|0);let U={v0:R,v1:F};return Ct(U),(U.v0&16777215)/16777216}function Rr(R,F){let U={v0:We(R),v1:F.n++};return Ct(U),(U.v0&16777215)/16777216}var xr=a$2.object({abTests:a$2.map(a$2.object({newUsersOnly:a$2.boolean().optional(),assignManually:a$2.boolean().optional(),buckets:a$2.array(a$2.object({id:a$2.string()})).minLength(1)})).optional()});function Nt(R,F,U){let se=U[F].buckets,ve=Or(`${R}_${F}`,0),ct=Math.floor(ve*se.length);return se[ct].id}function Ke(R,F,U){let se=F?` to bucket '${F}'`:"";throw new w$1(`Cannot assign test '${R}' to '${se}': ${U}`,"replication_error","ab_tests_error")}function Mt(R,F){throw new w$1(`Cannot unassign test '${R}': ${F}`,"replication_error","ab_tests_error")}var $e=class{constructor(R){this.opts=R}getBucketID(R,F){var U,se;return(se=(U=R.abTestAssignments)==null?void 0:U[F])==null?void 0:se.bucketId}assign(R,F,U,se){var yt;let ve=(yt=this.opts.config.ruleset)==null?void 0:yt.abTests;ve||Ke(U,se,"No ab tests have been configured."),ve[U]||Ke(U,se,"Not configured."),se||(se=Nt(F,U,ve)),ve[U].buckets.find(Et=>Et.id===se)||Ke(U,se,"Invalid bucket."),R.abTestAssignments||(R.abTestAssignments={});let ct=R.abTestAssignments[U],pt=(()=>{let Et=ct==null?void 0:ct.type;switch(Et){case"automatic":return"manual-active";case"manual-active":case"manual-inactive":return Et;case void 0:return"manual-inactive"}Ot(Et)})();R.abTestAssignments[U]=yi(li({},ct),{bucketId:se,type:pt})}unassign(R,F,U){var ct,pt;let se=R.abTestAssignments;se||Mt(U,"No tests assigned.");let ve=se[U];switch(ve||Mt(U,"Test not assigned."),ve.type){case"automatic":break;case"manual-active":{let yt=(ct=this.opts.config.ruleset)==null?void 0:ct.abTests;yt||Mt(U,"No ab tests have been configured.");let Et=Nt(F,U,yt);yt[U].buckets.find(Xt=>Xt.id===Et)||Ke(U,Et,"Invalid bucket."),ve.bucketId=Et;break}case"manual-inactive":{(pt=R.abTestAssignments)==null||delete pt[U];break}default:throw Ot(ve.type)}}};function Pr(R){let F=Object.keys(R.newAssignments),U=Object.keys(R.oldAssignments),se=[...F,...U];return se.filter((ve,ct)=>se.indexOf(ve)===ct).map(ve=>{let ct=R.newAssignments[ve],pt=R.oldAssignments[ve],yt=ct==null?void 0:ct.bucketId,Et=pt==null?void 0:pt.bucketId,Xt=!!(ct!=null&&ct.newUsersOnly)&&(ct==null?void 0:ct.type)==="automatic";return{testId:ve,bucketId:yt,previousBucketId:Et,newUsersOnly:Xt}}).filter(({bucketId:ve,previousBucketId:ct})=>ve!==ct)}var ze=class{constructor(R){this.opts=R,this.clientActionsApi=new $e({config:R.config}),this.assignmentsCache=x$1(R.metainfo.abTestAssignments||{}),this.changeEvents=this.opts.changeEvents.slice()}getBucketID(R){return this.clientActionsApi.getBucketID(this.opts.metainfo,R)}getABTests(){return Y(this.assignmentsCache,(R,F)=>F==null?void 0:F.bucketId)}getABTag(){return Object.keys(this.assignmentsCache).filter(R=>this.includeInABTag(R)).sort().map(R=>this.getTestTag(R)).join(",")}setOnChangedHandler(R){this.onABTestAssignmentsChanged=R,this.processChangeEvents()}handleReplicantActionCompleted(){let R=this.opts.metainfo.abTestAssignments||{};Pe(this.assignmentsCache,R)||(this.changeEvents.push(...Pr({newAssignments:R,oldAssignments:this.assignmentsCache})),this.assignmentsCache=x$1(R),this.processChangeEvents())}processChangeEvents(){if(!this.onABTestAssignmentsChanged||!this.changeEvents.length)return;let R=this.changeEvents;this.changeEvents=[],this.onABTestAssignmentsChanged(R)}includeInABTag(R){var U;let F=(U=this.opts.config.ruleset)==null?void 0:U.abTests;return!F||!F[R]?!1:!R.startsWith("0000_placebo")}getTestTag(R){let F=this.opts.config.ruleset.abTests,U=this.getBucketID(R),se=F[R].buckets.findIndex(ve=>ve.id===U);return`${R.substring(0,4)}-${se}`}},Cr=["id","createdAt","updatedAt","ruleset","userSharedStates"];function $$1(R,F,U){return Object.defineProperties(R,{id:{value:F.id,configurable:!0,enumerable:!1,writable:!0},createdAt:{value:F.createdAt,configurable:!0,enumerable:!1,writable:!0},updatedAt:{value:F.updatedAt,configurable:!0,enumerable:!1,writable:!0},ruleset:{get:()=>Es(F.metainfo),configurable:!0,enumerable:!1},userSharedStates:{get:()=>ws(U.sharedStates,F.userSharedStates),configurable:!0,enumerable:!1}}),R}function ae(R,F){return{id:R,createdAt:F.createdAt,updatedAt:F.lastUpdated,userSharedStates:F.userSharedStates,metainfo:F.metainfo}}function ws(R,F){var se;let U={};for(let ve in R){if(!((se=R[ve])!=null&&se.schema.user))continue;U[ve]={};let ct=F==null?void 0:F[ve];for(let pt in ct){let yt=ct[pt];!yt||(U[ve][pt]=yt.state)}}return U}function Es(R){return{abTests:Y(R.abTestAssignments||{},(F,U)=>U?{bucketId:U.bucketId}:void 0)}}async function Ye(R){let{clientAppName:F,devOpts:U,httpClient:se,isWebPlayable:ve,onLoginActionArgs:ct,otp:pt,prefetchKeys:yt,prefetchInternalKeys:Et,sessionId:Xt,skipOnLoginAction:Tt}=R,lr=(U==null?void 0:U.dateNow)||Date.now,jr=lr(),Vr=await se[ve?"doLoginOrCreateWebPlayerRequest":"doLoginOrCreateRequest"](li({sid:Xt,skipOnLoginAction:Tt,prefetchKeys:yt,prefetchInternalKeys:Et,onLoginActionArgs:ct},ve?{clientAppName:F,otp:pt}:{}));if(!Vr||!Vr.data)throw new w$1("Malformed result.",K.unknown_error);let ri=lr(),si=Se(jr,ri,Vr);return{data:Vr.data,clockOffset:si}}function Se(R,F,U){if(!U.t||typeof U.service>"u")throw new Error("Malformed server result: missing timing information");let se=U.t,ve=F-R-U.service,ct=se-Math.floor(ve/2);return Math.floor(ct-R)}var Je=class{constructor(R){this.opts=R,this.friendsIds=[],this.friendsStates={},this.fetchFriendsTimer=void 0,this.externalFriendsStates={},this.updateLocks={},this.onFriendStatesReceivedHandlers=[],this.messages=[],this.isPaused=!1,this.timestampLastFetched=0,this.didCallSetFriendsIds=!1,this.isOffline=!1,this.pendingOnFriendsChangedCall=!1,this.fetchInterval=R.options.refreshFriendsStatesInterval||0}setFriendsIds(R){let F=!this.didCallSetFriendsIds;this.didCallSetFriendsIds=!0;let U=R.sort(),se=U.filter((ve,ct)=>ve!==U[ct+1]);return se.length===this.friendsIds.length&&this.friendsIds.every((ve,ct)=>ve===se[ct])?Promise.resolve(this.friendsStates):(this.friendsIds=se,this.fetchFriendsTimer&&clearTimeout(this.fetchFriendsTimer),this.updateFriendsStates({isResponseToFirstSetFriendsIdsFetch:F}))}getFriendsStates(){return this.externalFriendsStates}setOnFriendsStatesChangedHandler(R){this.onFriendsChanged=R}setOnErrorHandler(R){this.onErrorHandler=R}stopCheckingForUpdates(){this.isPaused=!0,this.fetchFriendsTimer&&clearTimeout(this.fetchFriendsTimer)}async fetchOtherPlayerStates(R){let F=R.filter(ve=>!!this.friendsStates[ve]).map(ve=>({[ve]:this.friendsStates[ve].friendRev})).reduce((ve,ct)=>Object.assign(ve,ct),{}),U=await this.fetchStates(R,F);U&&this.handleFetchStatesResponse(U);let se={};for(let ve of R)se[ve]=this.friendsStates[ve];return se}pause(){this.stopCheckingForUpdates()}resume(){if(this.isPaused=!1,this.fetchInterval>0){let R=this.timestampLastFetched===0?0:Math.max(this.timestampLastFetched+this.fetchInterval-Date.now(),0);this.fetchFriendsTimer&&clearTimeout(this.fetchFriendsTimer),this.fetchFriendsTimer=setTimeout(()=>this.updateFriendsStates(),R),this.pendingOnFriendsChangedCall&&this.triggerOnChangedHandlers()}}handleReplicantMessage(R,F){this.messages.push({id:R,message:F})}handleReplicantActionCompleted(R){for(let{id:U,message:se}of this.messages)this.friendsStates[U]&&(this.applyMessageToState(U,se),this.updateLocks[U]||(this.updateLocks[U]={}),this.updateLocks[U][R]=(this.updateLocks[U][R]||[]).concat([se]));let F=this.messages.length;this.messages=[],F&&(this.pendingOnFriendsChangedCall=!0,this.triggerOnChangedHandlers())}handleReplicationResultStates(R,F){for(let U in R){let se=R[U];if($$1(se.state,ae(U,se),this.opts.config),this.friendsStates[U]=se,this.updateLocks[U])if(delete this.updateLocks[U][F],Object.keys(this.updateLocks[U]).length>0)for(let ve in this.updateLocks[U])for(let ct of this.updateLocks[U][ve])this.applyMessageToState(U,ct);else delete this.updateLocks[U]}Object.keys(R).length>0&&(this.pendingOnFriendsChangedCall=!0,this.triggerOnChangedHandlers())}clearLocks(){this.updateLocks={}}async fetchFriendsStatesNow(){return this.updateFriendsStates()}setOnFriendsStatesReceived(R){this.onFriendStatesReceivedHandlers.push(R)}clearFriendsStatesReceivedHandler(){this.onFriendStatesReceivedHandlers=[]}goOnline(){this.isOffline&&(this.isOffline=!1,this.scheduleFetchStates())}applyMessageToState(R,F){if(this.opts.config.messages){let U=this.friendsStates[R];this.opts.config.messages[F.name].reducer(U.state,F.args,{senderId:F.sender,timestamp:F.timestamp})}}async updateFriendsStates(R){let F,U=Object.keys(this.friendsStates).map(se=>({[se]:this.friendsStates[se].friendRev})).reduce((se,ve)=>Object.assign(se,ve),{});try{F=await this.fetchStates(this.friendsIds,U),this.timestampLastFetched=Date.now()}catch(se){J.error("Error fetching states: ",se),this.isOffline=se.code===K.network_error,this.onErrorHandler&&this.onErrorHandler(se)}return this.isOffline||this.scheduleFetchStates(),F&&this.handleFetchStatesResponse(F,R),this.friendsStates}triggerOnChangedHandlers(R){var se;if(this.isPaused||!this.pendingOnFriendsChangedCall)return;this.pendingOnFriendsChangedCall=!1;let F=this.externalFriendsStates;this.externalFriendsStates=ue(this.externalFriendsStates,this.friendsStates);let U=F!==this.externalFriendsStates;if(U)for(let ve in this.externalFriendsStates)this.externalFriendsStates[ve].state!==((se=F[ve])==null?void 0:se.state)&&$$1(this.externalFriendsStates[ve].state,ae(ve,this.friendsStates[ve]),this.opts.config);this.onFriendsChanged&&U&&this.onFriendsChanged(this.externalFriendsStates,R||{isResponseToFirstSetFriendsIdsFetch:!1})}async fetchStates(R,F){var Xt;let U=[],se=R.filter(Tt=>!(Tt in F)).length>100?100:300,ve=R.slice(0);for(;ve.length>0;){let Tt=ve.splice(0,se);U.push({ids:Tt})}let ct=((Xt=this.opts.options.devOpts)==null?void 0:Xt.dateNow)||Date.now,pt=U.map(async Tt=>{let lr={},jr=Tt.ids;do{let Vr=ct(),ri=await this.opts.httpClient.doFetchStatesRequest({ids:jr,friendRevs:F,consistentFetchIds:this.opts.calcConsistentFetchIds()}),si=ct();if(si-Vr<je){let Zr=Se(Vr,si,ri);this.opts.adjustClockOffset(Zr)}Object.assign(lr,ri.data.states),jr=ri.data.unprocessedIds||[]}while(jr.length>0);return lr}),yt=await Promise.all(pt),Et=Object.assign({},...yt);for(let Tt in Et){let lr=Et[Tt];$$1(Et[Tt].state,ae(Tt,lr),this.opts.config)}return Et&&Object.keys(Et).length>0&&(this.pendingOnFriendsChangedCall=!0),Et}handleFetchStatesResponse(R,F){this.onFriendStatesReceivedHandlers.forEach(U=>U(R));for(let U in this.updateLocks)R[U]&&(R[U]=this.friendsStates[U]);this.friendsStates=li(li({},this.friendsStates),R),this.triggerOnChangedHandlers(F)}scheduleFetchStates(){!this.isPaused&&this.fetchInterval>0&&(this.fetchFriendsTimer=setTimeout(()=>this.updateFriendsStates(),this.fetchInterval))}},Qe=class{constructor(R){this.opts=R}hasPhoneNumber(){return this.opts.hasPhoneNumber()}async initiateOtp(R){return this.opts.httpClient.doPostOtpInitiateAddReceiver(R)}};function Xe(R){return R.purchaseHistory?R.purchaseHistory.map(F=>{let U=li({},F);return F.purchase_time.toString().length===13?(U.issued_at=Number(F.issued_at),U.purchase_time=Number(F.purchase_time)):(U.issued_at=Number(F.issued_at)*1e3,U.purchase_time=Number(F.purchase_time)*1e3),U}):[]}function Nr(R){let{isAsync:F,id:U,apiMetainfo:se,chatbotMetainfo:ve,invokeTime:ct,messages:pt,onMessagePosted:yt}=R;function Et(){if(!F)throw new Error("Do not use this function in a sync Replicant action.")}function Xt(){return null}let Tt=()=>se().clockOffset||0,lr=Y(pt,(Zr,di)=>yt?(gi,ui)=>{if(di.isAdmin)throw new Error("Cannot send admin messages from with an action."+Zr);di.schema.tryValidate(ui),yt(gi,{name:Zr,args:ui,sender:U(),timestamp:ct()+Tt(),id:"0"})}:(gi,ui)=>{if(di.isAdmin)throw new Error("Cannot send admin messages from with an action."+Zr);di.schema.tryValidate(ui)}),jr=Y(R.sharedStates,(Zr,di)=>{let gi=di;return{create:Et,fetch:Et,setUserState:(ui,pi)=>{var oi,ai,hi,fi,ii,ci,ni;(oi=gi.schema.user)==null||oi.schema.tryValidate(pi);let Jr=R.userSharedStates(),ei={userId:U(),stateId:ui,stateName:Zr,createdAt:(fi=(hi=(ai=Jr[Zr])==null?void 0:ai[ui])==null?void 0:hi.createdAt)!=null?fi:ct(),version:0,rev:(ni=(ci=(ii=Jr[Zr])==null?void 0:ii[ui])==null?void 0:ci.rev)!=null?ni:0,updatedAt:ct(),state:pi};Jr[Zr]=yi(li({},Jr[Zr]),{[ui]:ei})},postMessage:gi.messages?Y(gi.messages,(ui,pi)=>(Jr,ei)=>{pi.schema.tryValidate(ei)}):{}}}),Vr=Y(R.scheduledActions,(Zr,{schema:di})=>({args:gi})=>{di.tryValidate(gi)}),ri=()=>F?Et():Rr(U(),se().random),si={asyncGetters:Y(R.asyncGetters,()=>Et),fetch:Et,math:{random:ri},getUserID:()=>U(),getSessionID:()=>R.sessionId(),date:{now:()=>(si.meta.hasUsedDateNow=!0,ct()+si.getClockOffset())},fetchStates:Et,flushMessages:Et,kvStore:{get:Et,getBatch:Et,send:Et,sendBatch:Et},getMentionCountForPagePost:Et,abTests:{getBucketID:Zr=>R.abTestsApiAccess().getBucketID(se(),Zr),assign:(Zr,di)=>{R.abTestsApiAccess().assign(se(),U(),Zr,di)},unassign:Zr=>{R.abTestsApiAccess().unassign(se(),U(),Zr)}},otp:{verifyOtp:Et},postMessage:lr,scheduledActions:{schedule:Vr,unschedule:Xt,rescheduleAllBy:Xt},payments:{createInvoice:Et},paymentSubscriptions:{initiate:Et,initiateWithOTPVerification:Et,verify:Et,verifyOTP:Et,getStatus:Et,cancel:Et},searchPlayers:Et,countPlayers:Et,purchases:{getPurchaseHistory:()=>Xe(se()),validatePurchase:Et},sendAnalyticsEvents:Xt,reportError:Xt,sharedStates:jr,meta:{hasUsedDateNow:!1,apiMetainfo:se,userSharedStates:R.userSharedStates},chatbot:{sendMessage:Xt,validateSubscription:Xt,unsubscribe:Xt,setAppleDeviceToken:Zr=>{ve.appleDeviceToken=Zr,ve.appleDeviceTokenUpdatedAt=si.date.now()},getAppleDeviceTokenUpdatedAt:()=>ve.appleDeviceTokenUpdatedAt||0,appleDeviceTokenIsValid:()=>!(ve.appleDeviceTokenUpdatedAt&&Ve(ve.appleDeviceTokenUpdatedAt,si.date.now()))&&!!ve.appleDeviceToken,setAndroidDeviceToken:Zr=>{ve.androidDeviceToken=Zr,ve.androidDeviceTokenUpdatedAt=si.date.now()},getAndroidDeviceTokenUpdatedAt:()=>ve.androidDeviceTokenUpdatedAt||0,androidDeviceTokenIsValid:()=>!(ve.androidDeviceTokenUpdatedAt&&Ge(ve.androidDeviceTokenUpdatedAt,si.date.now()))&&!!ve.androidDeviceToken,setEmail:Zr=>{ve.email=Zr}},generateOrGetNativeBridgeSecret:()=>(ve.nativeBridgeSecret||(ve.nativeBridgeSecret=Z(ri)),ve.nativeBridgeSecret),nukeUserMetainfo:()=>{se().random={n:0},se().clockOffset=0,delete se().purchaseHistory,delete se().lastSessionId,delete se().appVersion},setClockOffset:Zr=>{let di;try{di={}.STAGE}catch{}if(di==="prod")throw new Error("setClockOffset() cannot be used in prod");se().clockOffset=Math.floor(Zr)},getClockOffset:Tt,getPushNotificationLastTargetedAt:Et,getUserAssetUrl:Zr=>R.userAssetsBaseUrl()+Zr};return si}var Mr=R=>Nr(yi(li({},R),{isAsync:!1})),Dr=R=>{let F=Nr(yi(li({},R),{isAsync:!0}));return delete F.meta,F},Ze=class{constructor(R){this.receivedProfiles={},this.results=[];let F=(se,ve)=>{for(let ct in se)if(typeof se[ct]=="function")se[ct]=(...pt)=>{let yt=this.results[this.apiState.resultIndex];if(this.apiState.resultIndex++,this.apiState.apiCallQueue.push(ve+ct),!yt)throw new w$1("Client action trying to execute more api calls than server. Client queue: "+this.apiState.apiCallQueue.join(", ")+". Server results array: "+JSON.stringify(this.results),"replication_error","async_action_api_error");if(yt.failed){if(yt.async)return Promise.reject(Pt(yt.value));throw Pt(yt.value)}else{if(ve+ct==="api.fetchStates"&&(this.receivedProfiles=li(li({},this.receivedProfiles),yt.value)),ve==="api.postMessage."&&R.onMessagePosted(pt[0]),ve==="api.abTests."&&(ct==="assign"||ct==="unassign")&&R.abTestsApiAccess()[ct](R.apiMetaInfo(),R.id(),...pt),ve.startsWith("api.sharedStates")&&ct==="setUserState"){let Et=R.userSharedStates(),[,,Xt]=ve.split("."),[Tt,lr]=pt,jr={createdAt:0,rev:0,version:0,state:lr,stateId:Tt,stateName:Xt,updatedAt:0,userId:R.id()};Et[Xt]=yi(li({},Et[Xt]),{[Tt]:jr})}return yt.async?Promise.resolve(yt.value):yt.value}};else if(typeof se[ct]=="object")F(se[ct],ve+ct+".");else throw new Error("Unsupported field in API: "+ct)};this.apiState={resultIndex:0,apiCallQueue:[]};let U=Dr({id:R.id,sessionId:R.sessionId,apiMetainfo:R.apiMetaInfo,userSharedStates:R.userSharedStates,chatbotMetainfo:R.chatbotMetainfo(),invokeTime:R.invokeTime,messages:R.messages(),scheduledActions:R.scheduledActions(),computedProperties:R.computedProperties(),asyncGetters:R.asyncGetters(),sharedStates:R.sharedStates(),onMessagePosted:()=>null,userAssetsBaseUrl:R.userAssetsBaseUrl,abTestsApiAccess:R.abTestsApiAccess});F(U,"api."),this.api=U}getAPI(R){return this.receivedProfiles={},this.apiState.apiCallQueue=[],this.apiState.resultIndex=0,this.results=R,this.api}getReceivedProfiles(){return this.receivedProfiles}getAPIState(){return this.apiState}},et=class{constructor(R){this.postedMessages=[],this.invokeTime=0,this.api=Mr({id:R.id,sessionId:R.sessionId,apiMetainfo:()=>this.tempMetaInfo=this.tempMetaInfo||x$1(R.apiMetaInfo()),userSharedStates:()=>this.tempSharedStates=this.tempSharedStates||x$1(R.userSharedStates()),chatbotMetainfo:R.chatbotMetainfo(),invokeTime:()=>this.invokeTime,messages:R.messages(),scheduledActions:R.scheduledActions(),sharedStates:R.sharedStates(),onMessagePosted:(...F)=>this.postedMessages.push(F),userAssetsBaseUrl:R.userAssetsBaseUrl,abTestsApiAccess:R.abTestsApiAccess})}getAPI(R){var F;return this.postedMessages=[],this.tempMetaInfo=void 0,this.tempSharedStates=void 0,(F=this.api.meta)!=null&&F.hasUsedDateNow&&(this.api.meta.hasUsedDateNow=!1),this.invokeTime=R,this.api}updateMetaInfo(R){if(this.tempMetaInfo)for(let F in R)R[F]=this.tempMetaInfo[F]}updateUserSharedStates(R){for(let F in this.tempSharedStates)R[F]=this.tempSharedStates[F]}getPostedMessages(){return this.postedMessages}getInvokeTime(){return this.invokeTime}};function rt(){let R,F,U=(se,ve)=>{se?F(se):R(ve)};return{promise:new Promise((se,ve)=>{F=ve,R=se}),callback:U}}async function tt(R){if(R!==0)return new Promise(F=>setTimeout(F,R))}async function Dt(R,F){if(F.linearBackoff&&F.exponentialBackoff)throw new Error("Cannot set linearBackoff and exponentialBackoff at the same time");let U=F.retries,se=(F==null?void 0:F.linearBackoff)||0,ve=0;do try{return await R()}catch(ct){if((F==null?void 0:F.retryOnlyIf)&&!F.retryOnlyIf(ct)||ve>=U)throw ct;ve++,F!=null&&F.exponentialBackoff?await tt(Math.pow(2,ve)*F.exponentialBackoff+(Math.random()*F.exponentialBackoff-F.exponentialBackoff)):await tt(ve*se)}while(1);throw new Error("Unreachable")}var Ft=R=>typeof window>"u"?Buffer.from(R,"base64").toString("binary"):window.atob(R),be=(R,F)=>typeof window>"u"?global.setTimeout(R,F).unref():window.setTimeout(R,F),_e=class{constructor(R){this.opts=R,this.actionInvocationCallbacks={},this.queue=[],this.replicationBatch={queue:[],batchId:Z(),requestedProfileIds:[],clientRandomSeed:-1},this.replicationFlushPromise=null,this.batchToRetry=null,this.lockPromise=null,this.flushTimer=null,this.heartbeatTimer=0,this.isPaused=!1,this.isOnline=!0,this.onMessagesReceivedHandlers=[],this.consistentFetchTimestamps={},this.onMessagePosted=(U,se)=>{this.replicationBatch.requestedProfileIds.includes(U)||this.replicationBatch.requestedProfileIds.push(U),this.consistentFetchTimestamps[U]=se.timestamp,this.opts.hooks.onMessagePosted(U,se)},this.currentState=R.userData.state;let F=ae(R.id,R.userData);$$1(this.currentState,F,R.config),this.externalState=x$1(this.currentState),$$1(this.externalState,F,R.config),this.apiMetainfo=R.userData.metainfo,this.chatbotMetainfo=R.userData.chatbotMetainfo,this.metainfoMVCC=R.userData.metainfoMVCC,this.revId=R.userData.rev,this.syncApiCache=new et({id:()=>this.opts.id,sessionId:()=>this.opts.sessionId,apiMetaInfo:()=>this.apiMetainfo,userSharedStates:()=>R.userData.userSharedStates,chatbotMetainfo:()=>this.chatbotMetainfo,messages:()=>this.opts.config.messages,scheduledActions:()=>this.opts.config.scheduledActions,sharedStates:()=>this.opts.config.sharedStates,ruleset:()=>this.opts.config.ruleset,userAssetsBaseUrl:()=>this.opts.userAssetsBaseUrl,abTestsApiAccess:()=>this.opts.abTestsManager.clientActionsApi}),this.asyncApiCache=new Ze({id:()=>this.opts.id,sessionId:()=>this.opts.sessionId,apiMetaInfo:()=>this.apiMetainfo,userSharedStates:()=>R.userData.userSharedStates,chatbotMetainfo:()=>this.chatbotMetainfo,invokeTime:()=>this.opts.now(),messages:()=>this.opts.config.messages,scheduledActions:()=>this.opts.config.scheduledActions,computedProperties:()=>this.opts.config.computedProperties,asyncGetters:()=>this.opts.config.asyncGetters,sharedStates:()=>this.opts.config.sharedStates,ruleset:()=>this.opts.config.ruleset,onMessagePosted:U=>{this.consistentFetchTimestamps[U]=this.opts.now()},userAssetsBaseUrl:()=>this.opts.userAssetsBaseUrl,abTestsApiAccess:()=>this.opts.abTestsManager.clientActionsApi}),this.resetHeartbeatTimer()}async enqueueAction(R,F,U){let{promise:se,callback:ve}=rt();this.queue.push({type:F,fnName:R,args:U,callback:(pt,yt)=>{pt!==void 0&&(this.actionInvocationCallbacks.cancelled&&pt==="cancelled"?this.actionInvocationCallbacks.cancelled(R,U):this.actionInvocationCallbacks.failed&&this.actionInvocationCallbacks.failed(R,U,pt.message||pt)),ve(pt,yt)},promise:se}),this.resolveQueue();let ct=await se;return await this.lockPromise,ct}resetQueue(){this.queue.forEach(R=>R.callback("cancelled")),this.queue=[],this.replicationBatch={queue:[],batchId:Z(),requestedProfileIds:[],clientRandomSeed:-1},this.batchToRetry&&(this.batchToRetry.queue.forEach(R=>R.callback("cancelled",void 0)),this.batchToRetry=null,this.lockPromise=null)}onRefresh(R){this.currentState=R.state,$$1(this.currentState,ae(this.opts.id,R),this.opts.config),this.apiMetainfo=R.metainfo,this.revId=R.rev,this.isOnline=!0,this.resetHeartbeatTimer(),this.onStateChanged()}async retryLastRequest(){if(this.batchToRetry){if(this.flushReplication(),await this.replicationFlushPromise,!this.isOnline)throw new Error("Retrying last request failed.");return!0}else return!1}async waitForEmptyQueue(){if(!(this.queue.length===0&&!this.lockPromise))return this.lockPromise?await this.lockPromise:await tt(0),this.waitForEmptyQueue()}async flush(R){let F=R&&R.skipErrorHandlers;this.flushReplication();let U=new Promise((se,ve)=>{this.replicationFlushPromise?this.replicationFlushPromise.then(()=>{this.replicationBatch.queue.length>0||!!this.replicationFlushPromise?this.flush(R).then(()=>se()):this.lockPromise?this.lockPromise.then(()=>this.flush(R).then(()=>se())):se()}).catch(ct=>{F?se():(this.handleError(ct),ve(ct))}):se()});return F?new Promise(se=>{this.waitForEmptyQueue().then(()=>se(U)).catch(ve=>se(U))}):this.waitForEmptyQueue().then(()=>U)}async checkForMessages(){if(!this.replicationFlushPromise)if(this.replicationBatch.queue.length>0)this.flushReplication();else{J.debug("Sending heartbeat");let{promise:R,callback:F}=rt();this.queue.push({type:"sync",fnName:qe,args:[],callback:F,promise:R}),this.resolveQueue(),R.catch(U=>{})}await this.replicationFlushPromise,await this.lockPromise}getPurchaseHistory(){return Xe(this.apiMetainfo)}getExternalState(){return this.externalState}pause(){this.isPaused=!0,this.clearHeartbeatTimer(),this.isOnline&&this.flush()}resume(){this.isPaused=!1,this.resetHeartbeatTimer()}onMessagesReceived(R){this.onMessagesReceivedHandlers.push(R)}removeMessagesReceivedHandler(R){let F=this.onMessagesReceivedHandlers.indexOf(R);F>=0&&this.onMessagesReceivedHandlers.splice(F,1)}calcConsistentFetchIds(){var U;let R=((U=this.opts.replicantOptions.devOpts)==null?void 0:U.maxRecentMessagesTime)||_r,F=this.dateNow()-R;return Object.keys(this.consistentFetchTimestamps).filter(se=>this.consistentFetchTimestamps[se]>F)}invokeAsyncAction(R,F,U){let se=this.opts.config.actions[R.fnName];if(se.type!=="async")throw new Error("Inconsistent async / sync function invocation.");this.actionInvocationCallbacks.preInvoke&&this.actionInvocationCallbacks.preInvoke(R.fnName,R.args);let ve=se.fn(F,R.args,U);return this.actionInvocationCallbacks.postInvoke&&this.actionInvocationCallbacks.postInvoke(R.fnName,R.args),ve}invokeSyncAction(R,F,U){let se=this.opts.config.actions[R.fnName];if(se.type!=="sync")throw new Error("Inconsistent async / sync function invocation.");this.actionInvocationCallbacks.preInvoke&&this.actionInvocationCallbacks.preInvoke(R.fnName,R.args);let ve=se.fn(F,R.args,U);return this.actionInvocationCallbacks.postInvoke&&this.actionInvocationCallbacks.postInvoke(R.fnName,R.args),ve}resolveQueue(){if(this.lockPromise){let U=this.lockPromise;U.then(()=>{this.lockPromise===U&&(this.lockPromise=null,this.resolveQueue())}).catch(se=>null);return}let R=!1,F=!1;for(;this.queue.length>0&&!this.lockPromise;){let U=this.queue.shift();if(U.fnName===qe){this.replicationBatch.queue.push({fn:U.fnName,args:U.args,async:U.type==="async",callback:U.callback}),R=!0,F=!0;continue}if(U.type==="sync"){let se=U.fnName===Rt,ve=this.opts.config.actions[U.fnName];if(se){if(ve)throw new Error("System action names should not be available.")}else if(!ve||ve.type!=="sync")throw new Error("Inconsistent async / sync function invocation.");this.apiMetainfo.clockOffset=this.apiMetainfo.clockOffset||0;let ct=this.opts.now()-this.apiMetainfo.clockOffset,pt=this.syncApiCache.getAPI(ct),yt;try{se?st({state:this.currentState,metainfo:pt.meta.apiMetainfo(),updatedAt:this.currentState.updatedAt,fn:Et=>{this.applyMessages(this.currentState,U.args)},userSharedStates:pt.meta.userSharedStates(),config:this.opts.config}):yt=st({state:this.currentState,metainfo:pt.meta.apiMetainfo(),updatedAt:this.currentState.updatedAt,fn:Et=>this.invokeSyncAction(U,this.currentState,pt),userSharedStates:pt.meta.userSharedStates(),config:this.opts.config})}catch(Et){this.currentState=Fr({oldState:this.currentState,newState:this.externalState,metainfo:this.apiMetainfo,userSharedStates:this.opts.userData.userSharedStates,config:this.opts.config}),this.queue.forEach(Xt=>Xt.callback("cancelled")),this.queue=[],U.callback(Et);return}if(this.syncApiCache.updateMetaInfo(this.apiMetainfo),this.syncApiCache.updateUserSharedStates(this.opts.userData.userSharedStates),this.syncApiCache.getPostedMessages().forEach(Et=>this.onMessagePosted(...Et)),this.replicationBatch.queue.push({fn:U.fnName,args:se?U.args.map(Et=>Et.id):U.args,async:!1,callback:U.callback,meta:pt.meta.hasUsedDateNow?{now:this.syncApiCache.getInvokeTime()}:void 0}),R=!0,this.onStateChanged(),se)for(let Et of this.onMessagesReceivedHandlers)Et(U.args);U.callback(void 0,x$1(yt)),this.opts.hooks.onActionCompleted(this.replicationBatch.batchId)}else if(U.type==="async"){let{promise:se,callback:ve}=rt();this.replicationBatch.queue.push({fn:U.fnName,args:U.args,async:!0,meta:{now:this.opts.now()},callback:ve}),this.lockPromise=se.catch(ct=>U.callback(ct)).then(ct=>{if(!ct)return;let{result:pt,batchId:yt,requestedProfiles:Et,serverUpdatedAt:Xt,messages:Tt}=ct,lr=this.asyncApiCache.getAPI(pt),jr=this.opts.config.actions[U.fnName];if(!jr||jr.type!=="async")return Promise.reject("Action "+U.fnName+" is not an action or is not async.");let Vr=st({state:this.currentState,metainfo:this.apiMetainfo,updatedAt:Xt,fn:si=>this.invokeAsyncAction(U,si,lr),userSharedStates:this.opts.userData.userSharedStates,config:this.opts.config}),ri=si=>{if(Tt.length>0){st({state:this.currentState,metainfo:this.apiMetainfo,updatedAt:Xt,fn:Zr=>{this.applyMessages(Zr,Tt)},userSharedStates:this.opts.userData.userSharedStates,config:this.opts.config});for(let Zr of this.onMessagesReceivedHandlers)Zr(Tt)}this.opts.hooks.onReplicationResultStates(li(li({},this.asyncApiCache.getReceivedProfiles()),Et),yt),this.crosscheckAsyncAPICalls(U.fnName,this.asyncApiCache.getAPIState(),pt.length),this.onStateChanged(),U.callback(void 0,x$1(si)),this.opts.hooks.onActionCompleted(this.replicationBatch.batchId)};if(typeof Vr<"u"&&typeof Vr.then=="function")return Vr.then(ri).catch(si=>{U.callback(si),this.handleError(si)});ri(Vr)}).catch(ct=>{U.callback(ct),this.handleError(ct)}),R=!0,F=!0}else throw new Error("Action of type "+U.type+" should not be on the queue!")}R&&(!F&&!!this.opts.replicantOptions.batchingMaxTime?this.scheduleReplication():this.flushReplication(),this.resetHeartbeatTimer()),(this.queue.length>0||this.lockPromise)&&this.resolveQueue()}scheduleReplication(){this.flushTimer||(this.flushTimer=be(()=>this.flushReplication(),this.opts.replicantOptions.batchingMaxTime))}flushReplication(){if(this.replicationFlushPromise||(this.flushTimer&&(clearTimeout(this.flushTimer),this.flushTimer=null),this.replicationBatch.queue.length===0&&(!this.batchToRetry||this.batchToRetry.queue.length===0)))return;this.batchToRetry||(this.batchToRetry=this.replicationBatch,this.replicationBatch={queue:[],requestedProfileIds:[],batchId:Z(),clientRandomSeed:-1});let R=this.batchToRetry,F=R.queue.slice(),U=R.queue[R.queue.length-1].async?F.pop():null;if(F.some(se=>se.async))throw new Error("Too many async actions in batch.");R.clientRandomSeed===-1&&(R.clientRandomSeed=this.apiMetainfo.random.n),this.replicationFlushPromise=this.postReplicationQueue(R).then(se=>{var ct,pt,yt,Et;if(this.batchToRetry=null,se.newLastUpdated){he({state:this.currentState,metainfo:this.apiMetainfo,updatedAt:se.newLastUpdated,userSharedStates:this.opts.userData.userSharedStates,config:this.opts.config}),this.externalState=li({},this.externalState);let{id:Xt,createdAt:Tt,updatedAt:lr}=this.currentState;$$1(this.externalState,{id:Xt,createdAt:Tt,updatedAt:lr,userSharedStates:this.opts.userData.userSharedStates,metainfo:this.apiMetainfo},this.opts.config)}let ve=U?1:0;if(ve!==se.results.length)throw new Error("Invalid number of results received from server: "+se.results.length+(" expected: "+ve));for(let Xt of F)Xt.callback(void 0,void 0);if(U==null||U.callback(void 0,{result:se.results.shift(),batchId:R.batchId,requestedProfiles:se.requestedProfiles,messages:se.messages,serverUpdatedAt:se.lastUpdated}),!U&&!this.lockPromise&&se.messages.length>0&&this.enqueueAction(Rt,"sync",se.messages).catch(Xt=>this.handleError(new w$1(`Error applying messages on the client: ${Xt.message||Xt}`,"replication_error","message_errored","fatal"))),(ct=se.metainfoDelta)!=null&&ct.hasPhoneNumber&&(this.apiMetainfo.hasPhoneNumber=se.metainfoDelta.hasPhoneNumber),(pt=se.metainfoDelta)!=null&&pt.paymentSubscriptionStatus&&(this.metainfoMVCC.paymentSubscription=(yt=se.metainfoDelta)==null?void 0:yt.paymentSubscriptionStatus),(Et=se.metainfoDelta)==null?void 0:Et.purchaseHistory){let Xt=this.apiMetainfo.purchaseHistory||[];this.apiMetainfo.purchaseHistory=Xt.concat(se.metainfoDelta.purchaseHistory)}U||this.opts.hooks.onReplicationResultStates(se.requestedProfiles||{},R.batchId),this.replicationFlushPromise=null,this.isOnline=!0,this.flushReplication()}).catch(se=>{if(this.replicationFlushPromise=null,se.code!==K.network_error){this.batchToRetry=null;for(let ve of R.queue)ve.callback(se,void 0);this.resetQueue()}this.handleError(se)})}applyMessages(R,F){let U=this.opts.config.messages;if(U)for(let se of F)!U[se.name]||U[se.name].schema.validate(se.args)||U[se.name].reducer(R,se.args,{senderId:se.sender,timestamp:se.timestamp})}handleError(R){this.isOnline=!1,this.clearHeartbeatTimer(),this.opts.hooks.onError(R)}async postReplicationQueue(R){let{queue:F,requestedProfileIds:U,clientRandomSeed:se}=R,ve={queue:F.map(Et=>({fn:Et.fn,async:Et.async,args:Et.args,meta:Et.meta})),rev:this.revId,requestedProfileIds:U,consistentFetchIds:this.calcConsistentFetchIds(),sid:this.opts.sessionId,clientRandomSeed:se,crqid:Z()},ct=this.dateNow(),pt=await this.opts.httpClient.doPostReplicationRequest(ve),yt=this.dateNow();if(yt-ct<je){let Et=Se(ct,yt,pt);this.opts.adjustClockOffset(Et)}if(!pt.data||!pt.data.results||typeof pt.data.rev!="number")throw new Error("Invalid replication response.");return this.revId=pt.data.rev,{results:pt.data.results,messages:pt.data.messages,metainfoDelta:pt.data.metainfoDelta,requestedProfiles:pt.data.requestedProfiles,lastUpdated:pt.data.lastUpdated,newLastUpdated:pt.data.newLastUpdated}}resetHeartbeatTimer(){this.clearHeartbeatTimer();let R=this.opts.replicantOptions.checkForMessagesInterval;!R||!this.isOnline||this.isPaused||(this.heartbeatTimer=be(()=>this.scheduleCheckForMessages(),R))}clearHeartbeatTimer(){this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=0)}scheduleCheckForMessages(){if(this.replicationFlushPromise||this.queue.length>0||this.replicationBatch.queue.length>0||this.batchToRetry){this.resetHeartbeatTimer();return}this.queue.push({type:"sync",fnName:qe,args:[],callback:()=>null}),this.resolveQueue()}onStateChanged(){this.externalState=Fr({oldState:this.externalState,newState:this.currentState,metainfo:this.apiMetainfo,userSharedStates:this.opts.userData.userSharedStates,config:this.opts.config}),this.opts.hooks.onStateChanged(this.externalState)}dateNow(){var R,F;return((F=(R=this.opts.replicantOptions.devOpts)==null?void 0:R.dateNow)==null?void 0:F.call(R))||Date.now()}crosscheckAsyncAPICalls(R,F,U){if(F.resultIndex!==U)throw new w$1(`Action ${R} used ${F.resultIndex} api calls: `+F.apiCallQueue.join(", ")+`; but server provided ${U} results!`,"replication_error","async_action_api_error")}};function Fr(R){let F=ue(R.oldState,R.newState);if(F!==R.oldState){let{id:U,createdAt:se,updatedAt:ve}=R.newState;$$1(F,{id:U,createdAt:se,updatedAt:ve,metainfo:R.metainfo,userSharedStates:R.userSharedStates},R.config)}return F}function he(R){$$1(R.state,{createdAt:R.state.createdAt,id:R.state.id,updatedAt:R.updatedAt,metainfo:R.metainfo,userSharedStates:R.userSharedStates},R.config)}function st(R){let F=R.state.updatedAt;he({state:R.state,metainfo:R.metainfo,updatedAt:R.updatedAt,userSharedStates:R.userSharedStates,config:R.config});try{let U=R.fn(R.state);return U&&typeof U.then=="function"?U.then(se=>(he({state:R.state,metainfo:R.metainfo,updatedAt:F,userSharedStates:R.userSharedStates,config:R.config}),se)).catch(se=>(he({state:R.state,metainfo:R.metainfo,updatedAt:F,userSharedStates:R.userSharedStates,config:R.config}),Promise.reject(se))):(he({state:R.state,metainfo:R.metainfo,updatedAt:F,userSharedStates:R.userSharedStates,config:R.config}),U)}catch(U){throw he({state:R.state,metainfo:R.metainfo,updatedAt:F,userSharedStates:R.userSharedStates,config:R.config}),U}}var nt=class{constructor(R,F){this.httpClient=R,this.now=F,this.calledUpdateSelf=!1}async updateSelf(R,F){this.calledUpdateSelf=!0,await this.httpClient.doPostSocialGraphUpdateSelf({nonPlayerFriendIds:R,meta:F})}async trackInteractions(R){if(!this.calledUpdateSelf)throw Error("socialGraph.updateSelf must be called before tracking interactions");let F=this.now(),U=R.map(se=>yi(li({},se),{timestamp:se.timestamp||F}));await this.httpClient.doPostSocialGraphTrackInteractions({interactions:U})}};function Ur(R){if(R.indexOf("data:")!==0)throw new it("Invalid dataUrl");let F=R.substring(R.indexOf(":")+1,R.indexOf(","));if(F!=="image/jpeg;base64"&&F!=="image/png;base64")throw new it("Unsupported media type: "+F);return F}var it=class extends Error{constructor(R){super(R),this.name="APIError"}},Ae=class{constructor(R){this.httpClient=R}async upload(R){if(R.length>94e4)throw new w$1("Maximum payload size exceeded for dataUrl: "+R.length,"replication_error","user_asset_upload_error");Ur(R);let F=await this.httpClient.doUploadUserAssetRequest({dataUrl:R},{defaultErrorCodes:{code:"replication_error",subCode:"user_asset_upload_error"}});if(!F.data||!F.data.assetUrl)throw new w$1("Invalid user asset upload response.","replication_error","user_asset_upload_error");return F.data.assetUrl}},at=class{constructor(R,F,U,se,ve,ct,pt,yt,Et,Xt,Tt,lr,jr){this.id=R,this.sessionId=F,this.userData=U,this.config=se,this.options=ve,this.httpClient=ct,this.kvStore=pt,this.internalKvStore=yt,this.replicantVersion=Et,this.userAssetsBaseUrl=Xt,this.chatbotAssetUrls=Tt,this.extraData=lr,this.asyncGetters={},this.invoke={},this.extras={getECPM:()=>({fb:this.extraData.ecpmPerAdPlacement?{perAdPlacement:this.extraData.ecpmPerAdPlacement}:{}}),afterContextSwitch:async Vr=>{await this.httpClient.doPostAfterContextSwitchRequest({contextSwitchEventId:Vr.contextSwitchEventId})}},this.paymentSubscriptions={getStatus:()=>{var Vr;return(Vr=this.userData.metainfoMVCC.paymentSubscription)==null?void 0:Vr.status}},this.refreshToRetry=!1,this.forbidInvocations=!1,this.onStateChangedHandlers=[],this.paused=!1,this.onError=Vr=>{throw new Error(`{message: ${Vr.message}, code: ${Vr.code} }`)},this.onMessagePosted=(Vr,ri)=>{this.friendsMngr.handleReplicantMessage(Vr,ri)},this.handleActionCompleted=Vr=>{this.friendsMngr.handleReplicantActionCompleted(Vr),this.abTestsManager.handleReplicantActionCompleted()};for(let Vr in se.actions)this.invoke[Vr]=this.wrapAction(Vr,se.actions[Vr].type);for(let Vr in se.asyncGetters)this.asyncGetters[Vr]=ri=>{let si=this.queueManager.calcConsistentFetchIds();return this.httpClient.doAsyncGetterRequest({args:ri,name:Vr,sid:this.sessionId,consistentFetchIds:si})};this.clockSyncOffset=this.options.clockOffset||0,this.currentTime=this.userData.lastInvokeTime||0,this.friendsMngr=new Je({config:se,options:ve,httpClient:this.httpClient,adjustClockOffset:(...Vr)=>this.adjustClockOffset(...Vr),calcConsistentFetchIds:()=>this.queueManager.calcConsistentFetchIds()}),this.abTestsManager=new ze({config:se,metainfo:this.userData.metainfo,changeEvents:jr}),U.chatbotMetainfo=U.chatbotMetainfo||{},this.otp=new Qe({hasPhoneNumber:()=>!!this.userData.metainfo.hasPhoneNumber,httpClient:this.httpClient}),this.queueManager=new _e({id:R,sessionId:this.sessionId,userData:U,config:se,replicantOptions:ve,httpClient:this.httpClient,now:()=>this.now(),adjustClockOffset:(...Vr)=>this.adjustClockOffset(...Vr),hooks:{onStateChanged:Vr=>this.handleOnStateChanged(Vr),onActionCompleted:Vr=>this.handleActionCompleted(Vr),onMessagePosted:(Vr,ri)=>this.onMessagePosted(Vr,ri),onReplicationResultStates:(Vr,ri)=>{this.friendsMngr.handleReplicationResultStates(Vr,ri)},onError:Vr=>{Vr.code!==K.network_error&&(this.friendsMngr.clearLocks(),this.pause(),this.forbidInvocations=!0),this.onError(Vr)}},userAssetsBaseUrl:Xt,abTestsManager:this.abTestsManager}),this.socialGraph=new nt(this.httpClient,()=>this.now()),this.userAssets=new Ae(this.httpClient),se.onError&&this.setOnError(se.onError)}get state(){return this.queueManager.getExternalState()}get userId(){return this.id}get friends(){return this.friendsMngr}get abTests(){return this.abTestsManager}getChatbotSessionData(){return{sessionId:this.sessionId,appVersion:this.config.version}}onStateChanged(R){this.onStateChangedHandlers.push(R)}removeStateChangedHandler(R){this.onStateChangedHandlers=this.onStateChangedHandlers.filter(F=>F!==R)}clearStateChangedHandlers(){this.onStateChangedHandlers=[]}onMessagesReceived(R){this.queueManager.onMessagesReceived(R)}removeMessagesReceivedHandler(R){this.queueManager.removeMessagesReceivedHandler(R)}setOnError(R){this.onError=R}pause(){this.paused=!0,this.queueManager.pause(),this.friendsMngr.pause(),this.httpClient.pause()}resume(R){this.forbidInvocations||(this.paused=!1,this.queueManager.resume(),this.friendsMngr.resume(),this.httpClient.resume(),R!=null&&R.skipCheckForMessages||this.checkForMessages())}isPaused(){return this.paused}async fetchStates(R){return this.friendsMngr.fetchOtherPlayerStates(R)}async waitForEmptyQueue(){return this.queueManager.waitForEmptyQueue()}async flush(R){return this.queueManager.flush(R)}now(){return this.currentTime=Math.max(this.currentTime,Math.floor(this.dateNow()+this.clockSyncOffset)),this.currentTime+(this.userData.metainfo.clockOffset||0)}adjustClockOffset(R){var U;let F=((U=this.options.devOpts)==null?void 0:U.clockSyncOffsetAllowedDifference)||Ar/2;Math.abs(this.now()-(this.dateNow()+R))>F&&(this.clockSyncOffset=R)}checkForMessages(){return this.forbidInvocations?Promise.reject(new w$1("Do not check for messages while out of sync. Refresh first!","replication_error","invoking_while_out_of_sync")):this.queueManager.checkForMessages()}async setTestUsers(R){return(await this.httpClient.doPostTestUsers({states:R})).data.testUsersMap}getPurchaseHistory(){return this.queueManager.getPurchaseHistory()}getToken(){return this.httpClient.getToken()}async inferGenderFromName(R){return(await this.httpClient.doPostInferGenderFromName({name:R})).data}async refresh(R){this.friendsMngr.clearLocks(),this.queueManager.resetQueue(),await this.flush({skipErrorHandlers:!0}),R&&this.httpClient.setSignature(R);let F;try{F=await Ye({httpClient:this.httpClient,devOpts:this.options.devOpts,sessionId:this.sessionId,skipOnLoginAction:!0,isWebPlayable:He(this.userId)})}catch(U){throw this.refreshToRetry=!0,this.onError(U),U}this.forbidInvocations=!1,this.refreshToRetry=!1,this.clockSyncOffset=F.clockOffset,this.currentTime=F.data.lastInvokeTime||0,this.queueManager.onRefresh(F.data),this.resume({skipCheckForMessages:!0})}async retryLastRequest(){let R;return this.refreshToRetry?(await this.refresh(),R=!0):R=await this.queueManager.retryLastRequest(),this.friendsMngr.goOnline(),R}async uploadUserAsset(R){return this.userAssets.upload(R)}async sendIOSPushNotification(R){return(await this.httpClient.doPostAPN(R)).data}getAppleDeviceToken(){var R,F;return(R=this.userData.chatbotMetainfo)!=null&&R.appleDeviceTokenUpdatedAt&&Ve(this.userData.chatbotMetainfo.appleDeviceTokenUpdatedAt,this.dateNow())||(F=this.userData.chatbotMetainfo)==null?void 0:F.appleDeviceToken}async sendAndroidPushNotification(R){return(await this.httpClient.doPostAndroidPushNotification(R)).data}getAndroidDeviceToken(){var R,F;return(R=this.userData.chatbotMetainfo)!=null&&R.androidDeviceTokenUpdatedAt&&Ge(this.userData.chatbotMetainfo.androidDeviceTokenUpdatedAt,this.dateNow())||(F=this.userData.chatbotMetainfo)==null?void 0:F.androidDeviceToken}async sendPushNotification(R){let ve=R,{notification:F}=ve,U=Vi(ve,["notification"]),se;if("text"in F){let{text:{title:ct,body:pt}}=F;se={ios:{alert:{title:ct,body:pt},sound:"default"},android:{title:ct,body:pt,icon:"ic_launcher",sound:"default"}}}else se=F.overrideDefaultProps;return(await this.httpClient.doPostPushNotification(li({notifications:se},U))).data}getNativeBridgeSecret(){var R;return(R=this.userData.chatbotMetainfo)==null?void 0:R.nativeBridgeSecret}getGeolocation(){return this.extraData.geolocation}getReplicantVersion(){return this.replicantVersion}getExchangeRatesUSD(){return li({},this.extraData.exchangeRatesUSD)}getUserAssetUrl(R){return this.userAssetsBaseUrl+R}getChatbotAssetUrl(R){return this.chatbotAssetUrls[R]}setActionPreInvokeCallback(R){this.queueManager.actionInvocationCallbacks.preInvoke=R}setActionPostInvokeCallback(R){this.queueManager.actionInvocationCallbacks.postInvoke=R}setActionCancelledCallback(R){this.queueManager.actionInvocationCallbacks.cancelled=R}setActionFailedCallback(R){this.queueManager.actionInvocationCallbacks.failed=R}handleOnStateChanged(R){this.onStateChangedHandlers.forEach(F=>F(R))}wrapAction(R,F){return U=>{let se=!1;try{se={}.STAGE==="prod"}catch{}return!se&&U!==void 0&&!Sr(U)&&(J.warn([`Action ${R} was called with an argument that can't be sent to the server.`,"Argument: "+kr(U,4),"Would be sent as: "+JSON.stringify(U,null,4)].join(`
`)),J.warn("Above Warning may become an EXCEPTION in future release, please fix it!")),this.forbidInvocations?Promise.reject(new w$1(`Trying to invoke ${R} while state is out of sync. Refresh first!`,"replication_error","invoking_while_out_of_sync")):this.queueManager.enqueueAction(R,F,U)}}dateNow(){var R,F;return((F=(R=this.options.devOpts)==null?void 0:R.dateNow)==null?void 0:F.call(R))||Date.now()}},Ts=a$2.union([a$2.string(),a$2.unknown()]).customValidator(R=>R!==null&&typeof R!="string"?"Not a string or null: "+R:null),ot=a$2.object({$channel:a$2.string(),feature:a$2.string(),$subFeature:Ts}).additionalProperties(),S$2={AFTER_CONTEXT_SWITCH:"afterContextSwitch",REPLICATE:"replicate",LOGIN_OR_CREATE:"loginOrCreate",LOGIN_OR_CREATE_WEB_PLAYER:"loginOrCreateWebPlayer",TOKEN:"token",TOKEN_WEB_PLAYER:"tokenWebPlayer",FETCH_STATES:"fetchStates",ASYNC_GETTER:"asyncGetter",FB_WEBHOOK:"fbwebhook",UPLOAD_USER_ASSET:"userAsset",KEY_VALUE:"kv",INTERNAL_KEY_VALUE:"ikv",IOS_POST_APN:"iosPostApn",ANDROID_POST_PUSH_NOTIFICATION:"androidPushFcm",PUSH_NOTIFICATION:"pushNotification",FB_MESSAGING_REFERRALS:"fbmessaging_referrals",USER_DATA_DELETE:"deletion",LINE_WEBHOOK:"line-webhook",INFER_GENDER_FROM_NAME:"inferGenderFromName",OTP_INITIATE_ADD_RECEIVER:"otpInitiateAddReceiver",OTP_INITIATE_LOGIN:"otpInitiateLogin",SOCIAL_GRAPH_UPDATE_SELF:"socialGraphUpdateSelf",SOCIAL_GRAPH_TRACK_INTERACTIONS:"socialGraphTrackInteractions",STRIPE_WEBHOOK:"stripe_webhook"},Lr=a$2.object({alert:a$2.union([a$2.string(),a$2.object({title:a$2.string(),subtitle:a$2.string().optional(),body:a$2.string(),"launch-image":a$2.string().optional()})]),badge:a$2.number().optional(),sound:a$2.string().optional()}),Br=a$2.object({title:a$2.string(),icon:a$2.string(),color:a$2.string().optional(),body:a$2.string().optional(),sound:a$2.string().optional()}),vs={_healthcheck:pe(null),[S$2.AFTER_CONTEXT_SWITCH]:N$1(a$2.object({id:a$2.string(),auth:a$2.string(),contextSwitchEventId:a$2.string()})),[S$2.LOGIN_OR_CREATE]:N$1(a$2.object({id:a$2.string(),auth:a$2.string().optional(),onLoginActionArgs:a$2.unknown(),prefetchKeys:a$2.array(a$2.string()).optional(),prefetchInternalKeys:a$2.array(a$2.string()).optional(),sid:a$2.string(),skipOnLoginAction:a$2.boolean().optional()})),[S$2.LOGIN_OR_CREATE_WEB_PLAYER]:N$1(a$2.object({clientAppName:a$2.string().optional(),id:a$2.string().optional(),auth:a$2.string().optional(),onLoginActionArgs:a$2.unknown(),otp:a$2.object({code:a$2.string(),verificationId:a$2.string()}).optional(),prefetchKeys:a$2.array(a$2.string()).optional(),prefetchInternalKeys:a$2.array(a$2.string()).optional(),sid:a$2.string(),skipOnLoginAction:a$2.boolean().optional()})),[S$2.REPLICATE]:N$1(a$2.object({id:a$2.string(),auth:a$2.string().optional(),queue:a$2.array(a$2.object({fn:a$2.string(),args:a$2.unknown().optional(),async:a$2.boolean(),meta:a$2.object({now:a$2.number()}).optional()}).customValidator(R=>R.async&&!R.meta?"Client time must be provided for async actions.":null)),rev:a$2.number(),clientRandomSeed:a$2.number(),requestedProfileIds:a$2.array(a$2.string()).optional(),consistentFetchIds:a$2.array(a$2.string()),sid:a$2.string(),crqid:a$2.string()})),[S$2.FETCH_STATES]:N$1(a$2.object({id:a$2.string(),auth:a$2.string().optional(),ids:a$2.array(a$2.string()),consistentFetchIds:a$2.array(a$2.string()),friendRevs:a$2.map(a$2.number())})),[S$2.ASYNC_GETTER]:N$1(a$2.object({id:a$2.string(),sid:a$2.string(),auth:a$2.string().optional(),name:a$2.string(),args:a$2.unknown(),consistentFetchIds:a$2.array(a$2.string())})),[S$2.FB_WEBHOOK]:Ie({get:null,post:a$2.map(a$2.unknown())}),[S$2.USER_DATA_DELETE]:Ie({get:a$2.object({id:a$2.string(),fbclid:a$2.string().optional()}),post:null}),[S$2.UPLOAD_USER_ASSET]:N$1(a$2.object({id:a$2.string(),auth:a$2.string().optional(),dataUrl:a$2.string()})),[S$2.KEY_VALUE]:Ie({post:a$2.object({id:a$2.string(),auth:a$2.string().optional(),pairs:a$2.map(a$2.string())}),get:a$2.object({id:a$2.string(),auth:a$2.string().optional(),keys:a$2.array(a$2.string())})}),[S$2.INTERNAL_KEY_VALUE]:Ie({get:a$2.object({id:a$2.string(),auth:a$2.string().optional(),keys:a$2.array(a$2.string())}),post:null}),admin:N$1(a$2.object({auth:a$2.string(),action:a$2.string(),args:a$2.unknown()})),"ios-bridge":Ie({get:a$2.object({auth:a$2.string(),id:a$2.string(),uuid:a$2.string()}),post:a$2.object({auth:a$2.string(),id:a$2.string(),uuid:a$2.string(),payload:a$2.string()})}),[S$2.IOS_POST_APN]:N$1(a$2.object({id:a$2.string(),auth:a$2.string().optional(),receiverId:a$2.string(),notification:Lr,payload:ot,imageUrl:a$2.string().optional(),analyticsUserProps:a$2.map(a$2.unknown()).optional()})),[S$2.ANDROID_POST_PUSH_NOTIFICATION]:N$1(a$2.object({id:a$2.string(),auth:a$2.string().optional(),receiverId:a$2.string(),notification:Br,payload:ot,imageUrl:a$2.string().optional(),analyticsUserProps:a$2.map(a$2.unknown()).optional()})),[S$2.PUSH_NOTIFICATION]:N$1(a$2.object({id:a$2.string(),auth:a$2.string().optional(),receiverId:a$2.string(),notifications:a$2.object({ios:Lr,android:Br}),payload:ot,imageUrl:a$2.string().optional(),analyticsUserProps:a$2.map(a$2.unknown()).optional()})),[S$2.LINE_WEBHOOK]:N$1(a$2.object({destination:a$2.string(),events:a$2.array(a$2.unknown())})),[S$2.TOKEN]:pe(a$2.object({id:a$2.string(),auth:a$2.string().optional()})),[S$2.TOKEN_WEB_PLAYER]:pe(a$2.object({id:a$2.string(),auth:a$2.string()})),[S$2.INFER_GENDER_FROM_NAME]:N$1(a$2.object({id:a$2.string(),auth:a$2.string(),name:a$2.string()})),[S$2.OTP_INITIATE_ADD_RECEIVER]:N$1(a$2.object({id:a$2.string(),auth:a$2.string(),consentText:a$2.string().customValidator(R=>R.length===0?"Value must be a non-empty string":null),receiver:a$2.string(),templateId:a$2.string().optional(),type:a$2.tuple(["sms"])})),[S$2.OTP_INITIATE_LOGIN]:N$1(a$2.object({clientAppName:a$2.string().optional(),receiver:a$2.string(),templateId:a$2.string().optional(),type:a$2.tuple(["sms"])})),[S$2.SOCIAL_GRAPH_UPDATE_SELF]:N$1(a$2.object({id:a$2.string(),auth:a$2.string(),nonPlayerFriendIds:a$2.array(a$2.string()),meta:a$2.map(a$2.unknown())})),[S$2.STRIPE_WEBHOOK]:N$1(a$2.unknown()),[S$2.SOCIAL_GRAPH_TRACK_INTERACTIONS]:N$1(a$2.object({id:a$2.string(),auth:a$2.string(),interactions:a$2.array(a$2.object({receiverId:a$2.string(),timestamp:a$2.int(),type:a$2.string(),meta:a$2.map(a$2.unknown())}))}))},ks={nukeUser:pe(a$2.object({id:a$2.string(),secret:a$2.tuple(["iamsure"])})),nukeDB:pe(a$2.object({secret:a$2.tuple(["iamsupersure"])})),testUsers:N$1(a$2.object({id:a$2.string(),auth:a$2.string().optional(),states:a$2.map(a$2.unknown())}))},Ut=li(li({},ks),vs);function pe(R){return{get:{schema:R}}}function N$1(R){return{post:{schema:R}}}function Ie(R){return li(li({},pe(R.get)),N$1(R.post))}var Bt=class{constructor(R,F){this.type=R,this.getter=F}searchable(){if(this._payload)throw Error("Invalid computed property: use either .payload() or .searchable(), not both.");return this._searchable=!0,this._payload=!0,this}payload(){if(this._searchable)throw Error("Invalid computed property: use either .payload() or .searchable(), not both.");return this._payload=!0,this}};function ut(R,F){return new Bt(R,F)}var qt={name:a$2.string(),picture:a$2.string(),friendIds:a$2.array(a$2.string())};function jt(R){return Vt(R),R}function Vt(R){var ve,ct;function F(pt){throw new Error(pt)}R||F("Replicant config not present. Make sure to make default export of the config module."),typeof R=="object"||F("Replicant config not an object."),"stateSchema"in R||F("No stateSchema in Replicant config"),typeof R.stateSchema=="object"||F("stateSchema is not an object."),R.stateSchema.__schema||F("stateSchema not a SchemaBuilder object"),"actions"in R||F("No actions in Replicant config. Keys: "+Object.keys(R)),"migrator"in R||F("No migrator in Replicant config"),"version"in R||F("Version missing in Replicant config"),"appName"in R||F("appName missing in Replicant config"),typeof R.appName=="string"||F("appName not a string in Replicant config"),typeof R.version=="string"||F("Version not a string in Replicant config: "+R.version);for(let pt in R.stateSchema.getDefault())Cr.includes(pt)&&F(`stateSchema.${pt} is a reserved property - try using another name`);for(let pt in R.actions)if(R.actions.hasOwnProperty(pt)){pt.startsWith("_")&&F("Actions names cannot start with _");let yt=R.actions[pt];"type"in yt&&"fn"in yt||F("Action "+pt+" malformed. Please use helpers `actions` and `asyncAction`"),typeof yt.type=="string"||F("Type flag in action["+pt+"] not a string."),typeof yt.fn=="function"||F("Function in actions["+pt+"] not a function.")}if(typeof R.chatbot<"u"&&(typeof R.chatbot.events<"u"&&("onGameEnd"in R.chatbot.events&&(typeof R.chatbot.events.onGameEnd=="function"||F("chatbot.events.onGameEnd not a function: "+typeof R.chatbot.events.onGameEnd)),"onWebhook"in R.chatbot.events&&(typeof R.chatbot.events.onWebhook=="function"||F("chatbot.events.onWebhook not a function: "+typeof R.chatbot.events.onWebhook),Array.isArray(R.chatbot.events.enabledWebhookEvents)&&R.chatbot.events.enabledWebhookEvents.length>0||F("chatbot.events.enabledWebhookEvents must contain at least one item when the onWebhook handler is defined"))),"assets"in R.chatbot)){typeof R.chatbot.assets=="object"||F("chatbot.assets is not an object, use the renderTemplatesWithAssets helper to create this configuration.");let pt=Object.values(R.chatbot.assets).flatMap(yt=>typeof yt=="string"?[yt]:Object.values(yt));for(let yt of pt)yt.includes("\\")&&F("chatbot.assets contains invalid path separator: "+yt)}if(typeof R.asyncGetters<"u"){typeof R.asyncGetters=="object"&&!Array.isArray(R.asyncGetters)||F("asyncGetters is not an object");for(let pt in R.asyncGetters)typeof R.asyncGetters[pt]=="function"||F(`asyncGetters.${pt} is not a function`)}if(typeof R.onError<"u"&&(typeof R.onError=="function"||F("onError is not a function.")),R.onLoginAction&&!(R.onLoginAction in R.actions)&&F("onLoginAction is not a valid action"),typeof R.computedProperties<"u"){let pt=R.computedProperties;for(let[yt,Et]of Object.entries(pt)){if((yt.includes(".")||yt.includes(">"))&&F(`computed property name '${yt}' contains illegal characters`),Et.type.isObjectSchema()){Object.keys(Et.type.getFullSchema()).length===0&&F("object schema must have at least one property");for(let Xt in Et.type.getFullSchema()){let Tt=Et.type.getFullSchema()[Xt];if(Tt.isArraySchema()){let lr=Tt.getItemSchema();(lr.isArraySchema()||lr.isObjectSchema())&&F(`invalid nested object in computedProperties: ${yt}.${Xt} array must only include primitive items`)}Tt.isObjectSchema()&&F(`invalid nested object in computedProperties: ${yt}.${Xt} cannot be an object`)}}if(Et.type.isArraySchema()){let Xt=Et.type.getItemSchema();if(Xt.isObjectSchema())for(let Tt in Xt.getFullSchema()){let lr=Xt.getFullSchema()[Tt];if(lr.isArraySchema()){let jr=lr.getItemSchema();(jr.isArraySchema()||jr.isObjectSchema())&&F(`invalid nested object in computedProperties: ${yt}[].${Tt} array must only include primitive items`)}lr.isObjectSchema()&&F(`invalid nested object in computedProperties: ${yt}[].${Tt} cannot be an object`)}}}}(((ve=R.adminTool)==null?void 0:ve.profile)||[]).forEach((pt,yt)=>{var Xt;typeof pt=="object"||F(`adminTool.profile[${yt}] is not an object`),typeof pt.property=="string"||F(`adminTool.profile[${yt}].property is not a string`);let Et=(Xt=R.computedProperties)==null?void 0:Xt[pt.property];if(Et||F(`adminTool.profile[${yt}].property is not found among computedProperties`),pt.role){pt.role in qt||F(`adminTool.profile[${yt}].role is not supported`);let Tt=qt[pt.role],lr=JSON.stringify(Tt.serialize()),jr=JSON.stringify(Et.type.serialize());lr===jr||F(`adminTool.profile[${yt}].property type does not match the role requirement.The role expects ${lr}, but the computed property type is ${jr}`)}});let U=[];if(R.messages)for(let pt in R.messages)R.messages.hasOwnProperty(pt)&&R.messages[pt].isAdmin&&U.push(pt);let se=((ct=R.adminTool)==null?void 0:ct.adminMessageGroups)||{};Object.keys(se).length&&!R.messages&&F("adminTool.adminMessageGroups contains grouped messages, while there's no messages provided in config.messages");for(let pt in se){if(!se.hasOwnProperty(pt))continue;let yt=se[pt];Array.isArray(yt)||F(`adminTool.adminMessageGroups[${pt}].messages is not an array`);for(let Et of yt)U.includes(Et)||F(`adminTool.adminMessageGroups[${pt}].messages contains message ${Et}, which is not an admin message`)}if(R.otp&&R.otp.smsTemplates){typeof R.otp.smsTemplates!="object"&&F("otp.smsTemplates must be an object");for(let pt in R.otp.smsTemplates){typeof R.otp.smsTemplates[pt]!="function"&&F(`otp.smsTemplates.${pt} must be a function of type (otpCode: string) => string`);let yt="123456",Et=R.otp.smsTemplates[pt](yt);(typeof Et!="string"||!Et.includes(yt))&&F(`otp.smsTemplates.${pt} must return a string that includes the OTP code argument`)}}R.ruleset&&xr.validate(R.ruleset),R.stateSchema.getDefault()}function Gr(R,F){return{schema:R,reducer:F}}function Hr(R){return F=>F}function Wr(R,F){return{schema:R,messages:F}}var we=class{constructor(R,F={}){this.httpClient=R,this.cache=F}async get(R,F){return(await this.getBatch([R],F))[R]||null}async getBatch(R,F){let U=F&&F.forceFetch?R:R.filter(ve=>!(ve in this.cache));U.length&&await this.fetchBatch(U);let se={};for(let ve of R)ve in this.cache&&(se[ve]=this.cache[ve]);return se}async fetchBatch(R){let F=await this.httpClient.doGetInternalKeyValuePairsRequest({keys:R},{defaultErrorCodes:{code:"replication_error",subCode:"key_value_storage_error"},retryOptions:{retries:8}});if(!F.data)throw new w$1("Invalid internal key value store fetch response.","replication_error","key_value_storage_error");for(let U in F.data)this.cache[U]=F.data[U]}},Ee=class{constructor(R,F={}){this.httpClient=R,this.cache=F}async get(R,F){return(await this.getBatch([R],F))[R]||null}async getBatch(R,F){let U=F&&F.forceFetch?R:R.filter(ve=>!(ve in this.cache));U.length&&await this.fetchBatch(U);let se={};for(let ve of R)ve in this.cache&&(se[ve]=this.cache[ve]);return se}async send(R,F){return this.sendBatch({[R]:F})}async sendBatch(R){for(let U in R)if(!R[U]||typeof R[U]!="string")throw new w$1(`Invalid value for key: '${U}'.`,"replication_error","key_value_storage_error");let F={pairs:R};await this.httpClient.doSendKeyValuePairsRequest(F,{defaultErrorCodes:{code:"replication_error",subCode:"key_value_storage_error"},retryOptions:{retries:8}});for(let U in R)this.cache[U]=R[U]}async fetchBatch(R){let F=await this.httpClient.doGetKeyValuePairsRequest({keys:R},{defaultErrorCodes:{code:"replication_error",subCode:"key_value_storage_error"},retryOptions:{retries:8}});if(!F.data)throw new w$1("Invalid key value store fetch response.","replication_error","key_value_storage_error");for(let U in F.data)this.cache[U]=F.data[U]}},Te=class{constructor(R){this.options=R,this.signatureRefreshOffset=j({hours:1}),R.initialSignature?this.setSignature(R.initialSignature):this.refreshSignature()}pause(){this.timeoutHandle&&(clearTimeout(this.timeoutHandle),delete this.timeoutHandle)}resume(){if(this.pause(),!this.options.obtainSignature)return;let R=this.getTimeUntilSignatureUpdate();R>0?this.timeoutHandle=be(()=>this.refreshSignature(),R):this.refreshSignature()}async getSignature(){return this.getTimeUntilSignatureUpdate()<=0&&(this.refreshSignature(),this.isSignatureExpired()&&await this.refreshSignaturePromise),this.signature}setSignature(R){if(this.signature=R,!!this.options.obtainSignature){this.pause();try{let F=R.split(".")[1],U=Ft(F),se=JSON.parse(U);if(se.exp)this.signatureExpiresAt=j({seconds:se.exp}),this.signatureRefreshOffset=j({minutes:1});else{let ve=j({seconds:se.issued_at});this.signatureExpiresAt=ve+j({hours:24})}}catch{this.signatureExpiresAt=this.options.now()+j({hours:24})}this.resume()}}async getToken(){return this.isTokenExpired()&&this.refreshToken(),await this.refreshTokenPromise,this.token}setToken(R){this.token=R;try{let F=R.split(".")[1],U=Ft(F),se=JSON.parse(U);this.tokenExpiresAt=j({seconds:se.exp})}catch(F){throw new w$1(F.message,"authorization_error","invalid_signature")}}refreshSignature(){let R=this.options.obtainSignature;!R||this.refreshSignaturePromise||(this.pause(),this.refreshSignaturePromise=R().then(F=>this.setSignature(F)).finally(()=>delete this.refreshSignaturePromise))}refreshToken(){return this.refreshTokenPromise||(this.refreshTokenPromise=this.options.obtainToken().then(R=>this.setToken(R)).finally(()=>delete this.refreshTokenPromise)),this.refreshTokenPromise}getTimeUntilSignatureUpdate(){return this.signatureExpiresAt===void 0?0:this.signatureExpiresAt-this.options.now()-this.signatureRefreshOffset}isSignatureExpired(){return this.getTimeUntilSignatureUpdate()<=this.signatureRefreshOffset}isTokenExpired(){if(this.tokenExpiresAt===void 0)return!0;let R=this.signatureRefreshOffset/2;return this.tokenExpiresAt-R<this.options.now()}},Kr={Accept:"application/json, text/plain, */*","Content-Type":"text/plain"},Ps=`Please check the following:
- Is the backend endpoint URL configured correctly? Make sure you're targeting the right deployment stage.`,Cs=`Please check the following:
- Is the backend endpoint URL configured correctly?
- Is the backend infrastructure provisioned?
- Is the backend deployed?`,Ns=`Please check the following:
- Is the backend endpoint URL configured correctly? Make sure you're targeting the right deployment stage.
- Is the current app version deployed to the backend?`,oe=class{constructor(R){this.id=R.id,this.endpoint=R.endpoint,this.version=R.version,this.retryOptions=R.retryOptions,this.signatureManager=new Te({initialSignature:R.signature,obtainSignature:R.obtainSignature,obtainToken:()=>!this.id||He(this.id)?this.doGetTokenWebPlayerRequest():this.doGetTokenRequest(),now:()=>R.now()}),this.fetchFn=R.fetchOverride||fetch.bind(window)}pause(){this.signatureManager.pause()}resume(){this.signatureManager.resume()}getToken(){return this.signatureManager.getToken()}async doLoginOrCreateRequest(R){let F=await this.postRequest(S$2.LOGIN_OR_CREATE,R);return this.signatureManager.setToken(F.data.token),F}async doLoginOrCreateWebPlayerRequest(R){let F=await this.postRequest(S$2.LOGIN_OR_CREATE_WEB_PLAYER,R);return this.id=F.data.id,this.signatureManager.setToken(F.data.token),this.signatureManager.setSignature(F.data.webPlayerAuthToken),F}async doFetchStatesRequest(R){return this.postRequest(S$2.FETCH_STATES,R)}async doAsyncGetterRequest(R){let{result:F}=await this.postRequest(S$2.ASYNC_GETTER,R);return F}async doPostAfterContextSwitchRequest(R,F){await this.postRequest(S$2.AFTER_CONTEXT_SWITCH,R,F)}async doPostReplicationRequest(R){return this.postRequest(S$2.REPLICATE,R)}async doSendKeyValuePairsRequest(R,F){return this.postRequest(S$2.KEY_VALUE,R,F)}async doGetKeyValuePairsRequest(R,F){return this.getRequest(S$2.KEY_VALUE,R,F)}doGetInternalKeyValuePairsRequest(R,F){return this.getRequest(S$2.INTERNAL_KEY_VALUE,R,F)}async doUploadUserAssetRequest(R,F){return this.postRequest(S$2.UPLOAD_USER_ASSET,R,F)}async doPostAPN(R,F){return this.postRequest(S$2.IOS_POST_APN,R,F)}async doPostAndroidPushNotification(R,F){return this.postRequest(S$2.ANDROID_POST_PUSH_NOTIFICATION,R,F)}async doPostPushNotification(R,F){return this.postRequest(S$2.PUSH_NOTIFICATION,R,F)}async doPostTestUsers(R,F){return this.postRequest("testUsers",R,F)}doPostInferGenderFromName(R,F){return this.postRequest(S$2.INFER_GENDER_FROM_NAME,R,F)}async doPostOtpInitiateAddReceiver(R,F){return(await this.postRequest(S$2.OTP_INITIATE_ADD_RECEIVER,R,F)).data}async doPostOtpInitiateLogin(R,F){return(await this.postRequest(S$2.OTP_INITIATE_LOGIN,R,F)).data}async doPostSocialGraphUpdateSelf(R,F){await this.postRequest(S$2.SOCIAL_GRAPH_UPDATE_SELF,R,F)}async doPostSocialGraphTrackInteractions(R,F){await this.postRequest(S$2.SOCIAL_GRAPH_TRACK_INTERACTIONS,R,F)}setSignature(R){this.signatureManager.setSignature(R)}async doGetTokenRequest(){return(await this.getRequest(S$2.TOKEN,{})).data.token}async doGetTokenWebPlayerRequest(){return(await this.getRequest(S$2.TOKEN_WEB_PLAYER,{})).data.token}async postRequest(R,F,U){var Xt;let se=R===S$2.LOGIN_OR_CREATE||R===S$2.LOGIN_OR_CREATE_WEB_PLAYER||R===S$2.OTP_INITIATE_LOGIN?await this.signatureManager.getSignature():await this.signatureManager.getToken(),ve=!this.id&&(R===S$2.LOGIN_OR_CREATE_WEB_PLAYER||R===S$2.OTP_INITIATE_LOGIN)?F:yi(li({},F),{id:this.id,auth:se});if((Xt=Ut[R].post.schema)!=null&&Xt.validate(ve))throw new w$1("Invalid parameters","replication_error");let ct=JSON.stringify(ve);if(ct.length>95e4)throw new w$1("Client payload too large","replication_error","payload_too_large");let pt,yt=this.endpoint+"/v"+this.version+"/"+R,Et=li(li({},this.retryOptions),U==null?void 0:U.retryOptions);try{pt=await Dt(()=>this.fetchFn(yt,{method:"POST",headers:Kr,body:ct}),Et)}catch(Tt){throw $r({error:Tt,method:"POST",path:R,body:ct})}return await this.parseTextAndHandleError(pt,R,U==null?void 0:U.defaultErrorCodes)}async getRequest(R,F,U){var Et;let se=R===S$2.TOKEN||R===S$2.TOKEN_WEB_PLAYER?await this.signatureManager.getSignature():await this.signatureManager.getToken(),ve=this.endpoint+"/v"+this.version+"/"+R;if((Et=Ut[R].get.schema)!=null&&Et.validate(li({id:this.id,auth:se},F)))throw new w$1("Invalid parameters","replication_error");let ct="?id="+encodeURIComponent(this.id)+(se?"&auth="+encodeURIComponent(se):"")+Object.keys(F).map(Xt=>"&"+Xt+"="+encodeURIComponent(JSON.stringify(F[Xt]))),pt,yt=li(li({},this.retryOptions),U==null?void 0:U.retryOptions);try{pt=await Dt(()=>this.fetchFn(ve+ct,{method:"GET",headers:Kr}),yt)}catch(Xt){throw $r({error:Xt,method:"GET",path:R+ct})}return await this.parseTextAndHandleError(pt,R,U==null?void 0:U.defaultErrorCodes)}async parseTextAndHandleError(R,F,U){let se=await R.text();if(R.status>=502)throw new w$1("Status code: "+R.status+", message: "+se,"server_error");if(R.status===403){let ve;try{let ct=JSON.parse(se);(ct==null?void 0:ct.subCode)in xt&&(ve=ct.subCode)}catch{}throw new w$1(((se||"")+`

`+Ps).trim(),"authorization_error",ve)}if(R.status>=400){let ve=se,ct=(U==null?void 0:U.code)||K.unknown_error,pt=U==null?void 0:U.subCode;try{let yt=JSON.parse(se);yt.message&&(ve=yt.message),yt.code in K&&(ct=yt.code),yt.subCode in Ir&&(pt=yt.subCode)}catch{}throw R.status===404&&(ve=((ve||"")+`

`+Ns).trim()),new w$1(ve,ct,pt)}try{return JSON.parse(se)}catch{throw new w$1("Payload not JSON: "+se+" for API call: "+F,"unknown_error")}}};function $r(R){let F=`${R.method} /${R.path}${R.body?" "+JSON.stringify(R.body):""}`;return new w$1(`${R.error.message||"Request failed"} (${F.length>500?F.substr(500)+"...":F})

${Cs}`.trim(),"network_error")}async function zr(R){var ai;let{config:F,id:U,isWebPlayable:se,options:ve,internalKeyValueStorePrefetchKeys:ct,keyValueStorePrefetchKeys:pt}=R;if(Vt(F),!U&&!se)throw new Error("Invalid ID");let yt,Et=()=>{var fi,ii;return(yt==null?void 0:yt.now())||((ii=(fi=ve.devOpts)==null?void 0:fi.dateNow)==null?void 0:ii.call(fi))||Date.now()},Xt=new oe({id:U,endpoint:ve.endpoint,version:F.version,fetchOverride:ve.fetchOverride,signature:ve.signature,retryOptions:((ai=ve.devOpts)==null?void 0:ai.retryOptions)||{retries:1,linearBackoff:500},obtainSignature:ve.obtainSignature,now:Et}),Tt=Z(),lr=await Ye({clientAppName:R.clientAppName,httpClient:Xt,devOpts:ve.devOpts,isWebPlayable:se,onLoginActionArgs:ve.onLoginActionArgs,otp:se?R.otp:void 0,prefetchKeys:pt,prefetchInternalKeys:ct,sessionId:Tt}),jr=lr.clockOffset;ve.clockOffset=jr;try{lr.data.state=F.stateSchema.tryDecode(lr.data.state)}catch(fi){throw new Error("User state invalid: "+fi.message)}let hi=lr.data,{extraData:Vr,replicantVersion:ri,prefetchedKeys:si,prefetchedInternalKeys:Zr,userAssetsBaseUrl:di,chatbotAssetUrls:gi,abTestChangeEvents:ui}=hi,pi=Vi(hi,["extraData","replicantVersion","prefetchedKeys","prefetchedInternalKeys","userAssetsBaseUrl","chatbotAssetUrls","abTestChangeEvents"]),Jr=new Ee(Xt,si),ei=new we(Xt,Zr);yt=new at("id"in lr.data?lr.data.id:U,Tt,pi,F,ve,Xt,Jr,ei,ri,di,gi,Vr,ui);let oi="webPlayerAuthToken"in lr.data?lr.data.webPlayerAuthToken:void 0;return{replicant:yt,webPlayerAuthToken:oi}}async function Gt(R){return new oe({endpoint:R.endpoint,fetchOverride:R.fetchOverride,retryOptions:{retries:1,linearBackoff:500},version:R.version,now:()=>0,obtainSignature:void 0}).doPostOtpInitiateLogin({clientAppName:R.clientAppName,receiver:R.receiver,type:R.type,templateId:R.templateId})}var dt=Oe(Lt()),Ms="ReplicantWebCredentials_";function Ht(R,F){let U=yr(),se=F?`_${F}`:"",ve=!U||U==="prod"?"":"-"+U;return Ms+R+se+ve}function Yr(R,F,U){let se=Ht(R,U),ve=F.getItem(se);if(ve)try{let ct=JSON.parse(ve);if(ct.id&&typeof ct.id=="string"&&ct.token&&typeof ct.token=="string")return ct}catch(ct){J.error("Failed to parse web player credentials",ct)}}function Ds(R,F,U,se){let ve=Ht(R,se);F.setItem(ve,JSON.stringify(U))}function Wt(R,F=dt.localStorage,U){return!!Yr(R,F,U)}function Kt(R,F=dt.localStorage,U){let se=Ht(R,U);F.removeItem(se)}async function $t(R,F){let Tt=F,{kvStore:U,storageOverride:se,credentialsOverride:ve}=Tt,ct=Vi(Tt,["kvStore","storageOverride","credentialsOverride"]);ct.debug&&J.level(G.debug),gr(ct.platform);let pt=se||dt.localStorage,yt=F.otp?void 0:ve||Yr(R.appName,pt,F.clientAppName),{replicant:Et,webPlayerAuthToken:Xt}=await zr({clientAppName:F.clientAppName,config:R,id:yt==null?void 0:yt.id,options:yi(li({},ct),{obtainSignature:void 0,signature:yt==null?void 0:yt.token}),otp:F.otp,keyValueStorePrefetchKeys:U&&U.prefetchKeys,internalKeyValueStorePrefetchKeys:U==null?void 0:U.prefetchInternalKeys,isWebPlayable:!0});return(ve||!yt)&&Xt&&Ds(R.appName,pt,{id:Et.userId,token:Xt},F.clientAppName),Et}function fe(R){return{fn:R,type:"sync"}}function ee(R){return{fn:R,type:"async"}}function zt(R,F){return U=>U}function Yt(R,F){return U=>U}var Xr=Oe(Lt());function Qr(R,F){let U=a$2.object({data:a$2.map(a$2.unknown()),profileData:a$2.unknown(),leaderboards:a$2.map(a$2.object({score:a$2.int(),recordData:a$2.unknown()}))}),se={leaderboards:ut(a$2.array(a$2.object({leaderboardId:a$2.string(),score:a$2.int(),recordData:a$2.string()})),Tt=>Object.entries(Tt.leaderboards).map(([lr,jr])=>{var Vr;return{leaderboardId:lr,score:jr.score,recordData:JSON.stringify((Vr=jr.recordData)!=null?Vr:null)}})).searchable(),profileData:ut(a$2.string(),Tt=>{var lr;return JSON.stringify((lr=Tt.profileData)!=null?lr:null)}).payload()},ve={global:{schema:a$2.object({storage:a$2.map(a$2.unknown()),members:a$2.map(a$2.boolean())})}},ct=Hr()({setGroupStorage:Gr(a$2.object({props:a$2.map(a$2.unknown())}),(Tt,lr,jr)=>{Tt.global.members[jr.senderId]=!0;for(let Vr in lr.props){let ri=lr.props[Vr];Tt.global.storage[Vr]=ri}})}),pt={groups:Wr(ve,ct)},yt=Yt()({getPaymentStatus:(Tt,lr)=>lr.payments.getPaymentStatus(Tt),fetchGroup:async(Tt,lr)=>{let jr=await lr.sharedStates.groups.fetch(Tt.sharedStateId);return jr?{members:Object.entries(jr.global.members).filter(([Vr,ri])=>ri).map(([Vr])=>Vr),storage:jr.global.storage}:null},listLeaderboardRecords:async(Tt,lr)=>(await lr.searchPlayers({where:[{leaderboards:{leaderboardId:{isAnyOf:[Tt.leaderboardId]}}}],sort:[{field:"leaderboards.score",order:Tt.lowerIsBetter?"asc":"desc"}],limit:50})).results.map((jr,Vr)=>{let ri=jr.leaderboards[0];return{rank:Vr+1,score:ri.score,recordData:ri.recordData,playerId:jr.id,profileData:JSON.parse(jr.profileData)}}),getLeaderboardRecords:async(Tt,lr)=>(await lr.searchPlayers({where:[{id:{isOneOf:Tt.playerIds},leaderboards:{leaderboardId:{isAnyOf:[Tt.leaderboardId]}}}],limit:100})).results.map(jr=>{let Vr=jr.leaderboards[0];return{rank:-1,score:Vr.score,recordData:Vr.recordData,playerId:jr.id,profileData:JSON.parse(jr.profileData)}}),getLeaderboardRecordCount:async(Tt,lr)=>await lr.countPlayers({where:[{leaderboards:{leaderboardId:{isAnyOf:[Tt.leaderboardId]}}}]})}),Et=zt()({asyncCreateInvoice:ee(async(Tt,lr,jr)=>{let{paymentIntent:Vr}=await jr.payments.createInvoice(lr);return{paymentIntent:Vr}}),asyncCancelSubscription:ee(async(Tt,lr,jr)=>{await jr.paymentSubscriptions.cancel(lr)}),asyncCompleteSubscription:ee(async(Tt,lr,jr)=>jr.paymentSubscriptions.verify(lr)),asyncInitiateSubscription:ee(async(Tt,lr,jr)=>{let{subscriptionId:Vr,paymentIntent:ri,setupIntent:si}=await jr.paymentSubscriptions.initiate(lr),Zr=ri||si;if(!Zr)throw Error("Did not receive either payment or setup intent");return{clientSecret:Zr,subscriptionId:Vr}}),setDataProperties:fe((Tt,lr)=>{Tt.data=li(li({},Tt.data),lr)}),removeDataProperties:fe((Tt,lr)=>{for(let jr of lr)delete Tt.data[jr]}),asyncVerifyOtp:ee((Tt,lr,jr)=>jr.otp.verifyOtp(lr)),asyncCreateGroup:ee(async(Tt,lr,jr)=>await jr.sharedStates.groups.create()),setGroupStorage:fe(async(Tt,lr,jr)=>{jr.sharedStates.groups.postMessage.setGroupStorage(lr.sharedStateId,{props:lr.props})}),setLeaderboardProfileData:fe((Tt,lr)=>{Tt.profileData=lr.profileData}),submitLeaderboardRecord:ee((Tt,lr)=>{let jr=Tt.leaderboards[lr.leaderboardId];jr?(lr.lowerIsBetter&&lr.score<=jr.score||!lr.lowerIsBetter&&lr.score>=jr.score)&&(jr.score=lr.score,jr.recordData=lr.recordData):Tt.leaderboards[lr.leaderboardId]={score:lr.score,recordData:lr.recordData}})}),Xt={smsTemplates:{loginTemplateEn:Tt=>"Your one-time passcode is "+Tt}};return jt({actions:Et,appName:R,asyncGetters:yt,migrator:new ce,otp:Xt,stateSchema:U,sharedStates:pt,computedProperties:se,version:F,indexAnonymousWebPlayers:!0})}var ht,D,B,V$1,H$1,z$1,te,Qt=class{constructor(R,F){me(this,V$1),me(this,z$1),me(this,D,void 0),me(this,B,void 0),this.purchases={initiatePurchase:async U=>{if(!O(this,D).stripeAccountId)throw Error("stripeAccountId must be defined to initiate a purchase");let{paymentIntent:se}=await C$1(this,V$1,H$1).call(this).invoke.asyncCreateInvoice({productId:U,stripeAccountId:O(this,D).stripeAccountId}),ve=async()=>await C$1(this,V$1,H$1).call(this).asyncGetters.getPaymentStatus({paymentIntentId:se.id,stripeAccountId:O(this,D).stripeAccountId})==="succeeded";return{clientSecret:se.clientSecret,verifyPayment:ve}}},this.storage={get:()=>C$1(this,V$1,H$1).call(this).state.data,set:async U=>{await C$1(this,V$1,H$1).call(this).invoke.setDataProperties(U)},remove:async U=>{await C$1(this,V$1,H$1).call(this).invoke.removeDataProperties(U)},flush:async()=>{await C$1(this,V$1,H$1).call(this).flush()}},this.groups={create:async()=>(await C$1(this,z$1,te).call(this)).invoke.asyncCreateGroup(),fetch:async U=>(await C$1(this,z$1,te).call(this)).asyncGetters.fetchGroup({sharedStateId:U}),setStorage:async(U,se)=>{await(await C$1(this,z$1,te).call(this)).invoke.setGroupStorage({sharedStateId:U,props:se})}},this.leaderboards={setProfileData:async U=>{await(await C$1(this,z$1,te).call(this)).invoke.setLeaderboardProfileData(U)},getProfileData:()=>C$1(this,V$1,H$1).call(this).state.profileData,listRecords:async U=>(await C$1(this,z$1,te).call(this)).asyncGetters.listLeaderboardRecords(U),getRecords:async U=>(await C$1(this,z$1,te).call(this)).asyncGetters.getLeaderboardRecords(U),getRecordCount:async U=>(await C$1(this,z$1,te).call(this)).asyncGetters.getLeaderboardRecordCount(U),submitRecord:async U=>(await C$1(this,z$1,te).call(this)).invoke.submitLeaderboardRecord(U)},this.subscriptions={initiateSubscription:async U=>{let{clientSecret:se}=await C$1(this,V$1,H$1).call(this).invoke.asyncInitiateSubscription({productId:U,stripeAccountId:O(this,D).stripeAccountId});return{clientSecret:se,completeSubscription:async()=>{await C$1(this,V$1,H$1).call(this).invoke.asyncCompleteSubscription({stripeAccountId:O(this,D).stripeAccountId})}}},cancelSubscription:async()=>{await C$1(this,V$1,H$1).call(this).invoke.asyncCancelSubscription({stripeAccountId:O(this,D).stripeAccountId})},getSubscription:()=>{let U=C$1(this,V$1,H$1).call(this).paymentSubscriptions.getStatus();return(U==null?void 0:U.productId)&&["active","trialing"].includes(U.status)?U.productId:null}},ne(this,D,R),ne(this,B,F)}static async create(R){var se,ve,ct,pt;let F=yi(li({},R),{replicant:{appName:((se=R.replicant)==null?void 0:se.appName)||"replicant-lite",endpoint:((ve=R.replicant)==null?void 0:ve.endpoint)||"https://replicant-lite.us-east-1.replicant-playpass.gc-internal.net/replicant-lite",storageOverride:((ct=R.replicant)==null?void 0:ct.storageOverride)||Xr.localStorage,version:((pt=R.replicant)==null?void 0:pt.version)||"1.1.0"}}),U=Wt(F.replicant.appName,F.replicant.storageOverride,F.appName)?await lt(F):void 0;return new Qt(F,U)}getUserId(){var R;return(R=O(this,B))==null?void 0:R.userId}isLoggedIn(){var R;return!!((R=O(this,B))!=null&&R.otp.hasPhoneNumber())}async login(R){if(this.isLoggedIn())throw Error("Already logged in");if(O(this,B)){let{localePhoneNumber:F,phoneNumber:U,verificationId:se}=await O(this,B).otp.initiateOtp({consentText:R.consentText,receiver:R.phoneNumber,templateId:"loginTemplateEn",type:"sms"});return{localePhoneNumber:F,phoneNumber:U,verifyOtp:async ve=>O(this,B).invoke.asyncVerifyOtp({code:ve,verificationId:se})}}try{let{localePhoneNumber:F,phoneNumber:U,verificationId:se}=await Gt({clientAppName:O(this,D).appName,endpoint:O(this,D).replicant.endpoint,receiver:R.phoneNumber,templateId:"loginTemplateEn",type:"sms",version:O(this,D).replicant.version});return{localePhoneNumber:F,phoneNumber:U,verifyOtp:async ve=>{try{return ne(this,B,await lt(O(this,D),{code:ve,verificationId:se})),!0}catch(ct){if(ct.subCode!=="invalid_otp_code")throw ct;return!1}}}}catch(F){if(F.subCode!=="invalid_otp_receiver")throw F;let U=await lt(O(this,D)),{localePhoneNumber:se,phoneNumber:ve,verificationId:ct}=await U.otp.initiateOtp({consentText:R.consentText,receiver:R.phoneNumber,templateId:"loginTemplateEn",type:"sms"});return{localePhoneNumber:se,phoneNumber:ve,verifyOtp:async pt=>await U.invoke.asyncVerifyOtp({code:pt,verificationId:ct})?(ne(this,B,U),!0):!1}}}logout(){C$1(this,V$1,H$1).call(this),Kt(O(this,D).replicant.appName,O(this,D).replicant.storageOverride,O(this,D).appName),ne(this,B,void 0),ht=void 0}},Jt=Qt;D=new WeakMap,B=new WeakMap,V$1=new WeakSet,H$1=function(){if(!this.isLoggedIn())throw Error("Cannot perform operation before logging in: resolve ReplicantLite.login and try again.");return O(this,B)},z$1=new WeakSet,te=async function(){return O(this,B)||ne(this,B,await lt(O(this,D))),O(this,B)};function lt(R,F){if(!ht){let U=Qr(R.replicant.appName,R.replicant.version);ht=$t(U,{clientAppName:R.appName,endpoint:R.replicant.endpoint,otp:F,platform:"tiktok",storageOverride:R.replicant.storageOverride})}return ht}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const t$2=window.ShadowRoot&&(window.ShadyCSS===void 0||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,e$4=Symbol(),n$5=new Map;class s$3{constructor(F,U){if(this._$cssResult$=!0,U!==e$4)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=F}get styleSheet(){let F=n$5.get(this.cssText);return t$2&&F===void 0&&(n$5.set(this.cssText,F=new CSSStyleSheet),F.replaceSync(this.cssText)),F}toString(){return this.cssText}}const o$5=R=>new s$3(typeof R=="string"?R:R+"",e$4),r$2=(R,...F)=>{const U=R.length===1?R[0]:F.reduce((se,ve,ct)=>se+(pt=>{if(pt._$cssResult$===!0)return pt.cssText;if(typeof pt=="number")return pt;throw Error("Value passed to 'css' function must be a 'css' function result: "+pt+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(ve)+R[ct+1],R[0]);return new s$3(U,e$4)},i$2=(R,F)=>{t$2?R.adoptedStyleSheets=F.map(U=>U instanceof CSSStyleSheet?U:U.styleSheet):F.forEach(U=>{const se=document.createElement("style"),ve=window.litNonce;ve!==void 0&&se.setAttribute("nonce",ve),se.textContent=U.cssText,R.appendChild(se)})},S$1=t$2?R=>R:R=>R instanceof CSSStyleSheet?(F=>{let U="";for(const se of F.cssRules)U+=se.cssText;return o$5(U)})(R):R;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var s$2;const e$3=window.trustedTypes,r$1=e$3?e$3.emptyScript:"",h$1=window.reactiveElementPolyfillSupport,o$4={toAttribute(R,F){switch(F){case Boolean:R=R?r$1:null;break;case Object:case Array:R=R==null?R:JSON.stringify(R)}return R},fromAttribute(R,F){let U=R;switch(F){case Boolean:U=R!==null;break;case Number:U=R===null?null:Number(R);break;case Object:case Array:try{U=JSON.parse(R)}catch{U=null}}return U}},n$4=(R,F)=>F!==R&&(F==F||R==R),l$3={attribute:!0,type:String,converter:o$4,reflect:!1,hasChanged:n$4};class a$1 extends HTMLElement{constructor(){super(),this._$Et=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Ei=null,this.o()}static addInitializer(F){var U;(U=this.l)!==null&&U!==void 0||(this.l=[]),this.l.push(F)}static get observedAttributes(){this.finalize();const F=[];return this.elementProperties.forEach((U,se)=>{const ve=this._$Eh(se,U);ve!==void 0&&(this._$Eu.set(ve,se),F.push(ve))}),F}static createProperty(F,U=l$3){if(U.state&&(U.attribute=!1),this.finalize(),this.elementProperties.set(F,U),!U.noAccessor&&!this.prototype.hasOwnProperty(F)){const se=typeof F=="symbol"?Symbol():"__"+F,ve=this.getPropertyDescriptor(F,se,U);ve!==void 0&&Object.defineProperty(this.prototype,F,ve)}}static getPropertyDescriptor(F,U,se){return{get(){return this[U]},set(ve){const ct=this[F];this[U]=ve,this.requestUpdate(F,ct,se)},configurable:!0,enumerable:!0}}static getPropertyOptions(F){return this.elementProperties.get(F)||l$3}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const F=Object.getPrototypeOf(this);if(F.finalize(),this.elementProperties=new Map(F.elementProperties),this._$Eu=new Map,this.hasOwnProperty("properties")){const U=this.properties,se=[...Object.getOwnPropertyNames(U),...Object.getOwnPropertySymbols(U)];for(const ve of se)this.createProperty(ve,U[ve])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(F){const U=[];if(Array.isArray(F)){const se=new Set(F.flat(1/0).reverse());for(const ve of se)U.unshift(S$1(ve))}else F!==void 0&&U.push(S$1(F));return U}static _$Eh(F,U){const se=U.attribute;return se===!1?void 0:typeof se=="string"?se:typeof F=="string"?F.toLowerCase():void 0}o(){var F;this._$Ep=new Promise(U=>this.enableUpdating=U),this._$AL=new Map,this._$Em(),this.requestUpdate(),(F=this.constructor.l)===null||F===void 0||F.forEach(U=>U(this))}addController(F){var U,se;((U=this._$Eg)!==null&&U!==void 0?U:this._$Eg=[]).push(F),this.renderRoot!==void 0&&this.isConnected&&((se=F.hostConnected)===null||se===void 0||se.call(F))}removeController(F){var U;(U=this._$Eg)===null||U===void 0||U.splice(this._$Eg.indexOf(F)>>>0,1)}_$Em(){this.constructor.elementProperties.forEach((F,U)=>{this.hasOwnProperty(U)&&(this._$Et.set(U,this[U]),delete this[U])})}createRenderRoot(){var F;const U=(F=this.shadowRoot)!==null&&F!==void 0?F:this.attachShadow(this.constructor.shadowRootOptions);return i$2(U,this.constructor.elementStyles),U}connectedCallback(){var F;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(F=this._$Eg)===null||F===void 0||F.forEach(U=>{var se;return(se=U.hostConnected)===null||se===void 0?void 0:se.call(U)})}enableUpdating(F){}disconnectedCallback(){var F;(F=this._$Eg)===null||F===void 0||F.forEach(U=>{var se;return(se=U.hostDisconnected)===null||se===void 0?void 0:se.call(U)})}attributeChangedCallback(F,U,se){this._$AK(F,se)}_$ES(F,U,se=l$3){var ve,ct;const pt=this.constructor._$Eh(F,se);if(pt!==void 0&&se.reflect===!0){const yt=((ct=(ve=se.converter)===null||ve===void 0?void 0:ve.toAttribute)!==null&&ct!==void 0?ct:o$4.toAttribute)(U,se.type);this._$Ei=F,yt==null?this.removeAttribute(pt):this.setAttribute(pt,yt),this._$Ei=null}}_$AK(F,U){var se,ve,ct;const pt=this.constructor,yt=pt._$Eu.get(F);if(yt!==void 0&&this._$Ei!==yt){const Et=pt.getPropertyOptions(yt),Xt=Et.converter,Tt=(ct=(ve=(se=Xt)===null||se===void 0?void 0:se.fromAttribute)!==null&&ve!==void 0?ve:typeof Xt=="function"?Xt:null)!==null&&ct!==void 0?ct:o$4.fromAttribute;this._$Ei=yt,this[yt]=Tt(U,Et.type),this._$Ei=null}}requestUpdate(F,U,se){let ve=!0;F!==void 0&&(((se=se||this.constructor.getPropertyOptions(F)).hasChanged||n$4)(this[F],U)?(this._$AL.has(F)||this._$AL.set(F,U),se.reflect===!0&&this._$Ei!==F&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(F,se))):ve=!1),!this.isUpdatePending&&ve&&(this._$Ep=this._$E_())}async _$E_(){this.isUpdatePending=!0;try{await this._$Ep}catch(U){Promise.reject(U)}const F=this.scheduleUpdate();return F!=null&&await F,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var F;if(!this.isUpdatePending)return;this.hasUpdated,this._$Et&&(this._$Et.forEach((ve,ct)=>this[ct]=ve),this._$Et=void 0);let U=!1;const se=this._$AL;try{U=this.shouldUpdate(se),U?(this.willUpdate(se),(F=this._$Eg)===null||F===void 0||F.forEach(ve=>{var ct;return(ct=ve.hostUpdate)===null||ct===void 0?void 0:ct.call(ve)}),this.update(se)):this._$EU()}catch(ve){throw U=!1,this._$EU(),ve}U&&this._$AE(se)}willUpdate(F){}_$AE(F){var U;(U=this._$Eg)===null||U===void 0||U.forEach(se=>{var ve;return(ve=se.hostUpdated)===null||ve===void 0?void 0:ve.call(se)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(F)),this.updated(F)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Ep}shouldUpdate(F){return!0}update(F){this._$EC!==void 0&&(this._$EC.forEach((U,se)=>this._$ES(se,this[se],U)),this._$EC=void 0),this._$EU()}updated(F){}firstUpdated(F){}}a$1.finalized=!0,a$1.elementProperties=new Map,a$1.elementStyles=[],a$1.shadowRootOptions={mode:"open"},h$1==null||h$1({ReactiveElement:a$1}),((s$2=globalThis.reactiveElementVersions)!==null&&s$2!==void 0?s$2:globalThis.reactiveElementVersions=[]).push("1.3.2");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var t$1;const i$1=globalThis.trustedTypes,s$1=i$1?i$1.createPolicy("lit-html",{createHTML:R=>R}):void 0,e$2=`lit$${(Math.random()+"").slice(9)}$`,o$3="?"+e$2,n$3=`<${o$3}>`,l$2=document,h=(R="")=>l$2.createComment(R),r=R=>R===null||typeof R!="object"&&typeof R!="function",d=Array.isArray,u=R=>{var F;return d(R)||typeof((F=R)===null||F===void 0?void 0:F[Symbol.iterator])=="function"},c=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,v=/-->/g,a=/>/g,f=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,_=/'/g,m=/"/g,g=/^(?:script|style|textarea|title)$/i,p$1=R=>(F,...U)=>({_$litType$:R,strings:F,values:U}),$=p$1(1),y=p$1(2),b=Symbol.for("lit-noChange"),w=Symbol.for("lit-nothing"),T=new WeakMap,x=(R,F,U)=>{var se,ve;const ct=(se=U==null?void 0:U.renderBefore)!==null&&se!==void 0?se:F;let pt=ct._$litPart$;if(pt===void 0){const yt=(ve=U==null?void 0:U.renderBefore)!==null&&ve!==void 0?ve:null;ct._$litPart$=pt=new N(F.insertBefore(h(),yt),yt,void 0,U!=null?U:{})}return pt._$AI(R),pt},A=l$2.createTreeWalker(l$2,129,null,!1),C=(R,F)=>{const U=R.length-1,se=[];let ve,ct=F===2?"<svg>":"",pt=c;for(let Et=0;Et<U;Et++){const Xt=R[Et];let Tt,lr,jr=-1,Vr=0;for(;Vr<Xt.length&&(pt.lastIndex=Vr,lr=pt.exec(Xt),lr!==null);)Vr=pt.lastIndex,pt===c?lr[1]==="!--"?pt=v:lr[1]!==void 0?pt=a:lr[2]!==void 0?(g.test(lr[2])&&(ve=RegExp("</"+lr[2],"g")),pt=f):lr[3]!==void 0&&(pt=f):pt===f?lr[0]===">"?(pt=ve!=null?ve:c,jr=-1):lr[1]===void 0?jr=-2:(jr=pt.lastIndex-lr[2].length,Tt=lr[1],pt=lr[3]===void 0?f:lr[3]==='"'?m:_):pt===m||pt===_?pt=f:pt===v||pt===a?pt=c:(pt=f,ve=void 0);const ri=pt===f&&R[Et+1].startsWith("/>")?" ":"";ct+=pt===c?Xt+n$3:jr>=0?(se.push(Tt),Xt.slice(0,jr)+"$lit$"+Xt.slice(jr)+e$2+ri):Xt+e$2+(jr===-2?(se.push(void 0),Et):ri)}const yt=ct+(R[U]||"<?>")+(F===2?"</svg>":"");if(!Array.isArray(R)||!R.hasOwnProperty("raw"))throw Error("invalid template strings array");return[s$1!==void 0?s$1.createHTML(yt):yt,se]};class E{constructor({strings:F,_$litType$:U},se){let ve;this.parts=[];let ct=0,pt=0;const yt=F.length-1,Et=this.parts,[Xt,Tt]=C(F,U);if(this.el=E.createElement(Xt,se),A.currentNode=this.el.content,U===2){const lr=this.el.content,jr=lr.firstChild;jr.remove(),lr.append(...jr.childNodes)}for(;(ve=A.nextNode())!==null&&Et.length<yt;){if(ve.nodeType===1){if(ve.hasAttributes()){const lr=[];for(const jr of ve.getAttributeNames())if(jr.endsWith("$lit$")||jr.startsWith(e$2)){const Vr=Tt[pt++];if(lr.push(jr),Vr!==void 0){const ri=ve.getAttribute(Vr.toLowerCase()+"$lit$").split(e$2),si=/([.?@])?(.*)/.exec(Vr);Et.push({type:1,index:ct,name:si[2],strings:ri,ctor:si[1]==="."?M:si[1]==="?"?H:si[1]==="@"?I:S})}else Et.push({type:6,index:ct})}for(const jr of lr)ve.removeAttribute(jr)}if(g.test(ve.tagName)){const lr=ve.textContent.split(e$2),jr=lr.length-1;if(jr>0){ve.textContent=i$1?i$1.emptyScript:"";for(let Vr=0;Vr<jr;Vr++)ve.append(lr[Vr],h()),A.nextNode(),Et.push({type:2,index:++ct});ve.append(lr[jr],h())}}}else if(ve.nodeType===8)if(ve.data===o$3)Et.push({type:2,index:ct});else{let lr=-1;for(;(lr=ve.data.indexOf(e$2,lr+1))!==-1;)Et.push({type:7,index:ct}),lr+=e$2.length-1}ct++}}static createElement(F,U){const se=l$2.createElement("template");return se.innerHTML=F,se}}function P(R,F,U=R,se){var ve,ct,pt,yt;if(F===b)return F;let Et=se!==void 0?(ve=U._$Cl)===null||ve===void 0?void 0:ve[se]:U._$Cu;const Xt=r(F)?void 0:F._$litDirective$;return(Et==null?void 0:Et.constructor)!==Xt&&((ct=Et==null?void 0:Et._$AO)===null||ct===void 0||ct.call(Et,!1),Xt===void 0?Et=void 0:(Et=new Xt(R),Et._$AT(R,U,se)),se!==void 0?((pt=(yt=U)._$Cl)!==null&&pt!==void 0?pt:yt._$Cl=[])[se]=Et:U._$Cu=Et),Et!==void 0&&(F=P(R,Et._$AS(R,F.values),Et,se)),F}class V{constructor(F,U){this.v=[],this._$AN=void 0,this._$AD=F,this._$AM=U}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(F){var U;const{el:{content:se},parts:ve}=this._$AD,ct=((U=F==null?void 0:F.creationScope)!==null&&U!==void 0?U:l$2).importNode(se,!0);A.currentNode=ct;let pt=A.nextNode(),yt=0,Et=0,Xt=ve[0];for(;Xt!==void 0;){if(yt===Xt.index){let Tt;Xt.type===2?Tt=new N(pt,pt.nextSibling,this,F):Xt.type===1?Tt=new Xt.ctor(pt,Xt.name,Xt.strings,this,F):Xt.type===6&&(Tt=new L(pt,this,F)),this.v.push(Tt),Xt=ve[++Et]}yt!==(Xt==null?void 0:Xt.index)&&(pt=A.nextNode(),yt++)}return ct}m(F){let U=0;for(const se of this.v)se!==void 0&&(se.strings!==void 0?(se._$AI(F,se,U),U+=se.strings.length-2):se._$AI(F[U])),U++}}class N{constructor(F,U,se,ve){var ct;this.type=2,this._$AH=w,this._$AN=void 0,this._$AA=F,this._$AB=U,this._$AM=se,this.options=ve,this._$Cg=(ct=ve==null?void 0:ve.isConnected)===null||ct===void 0||ct}get _$AU(){var F,U;return(U=(F=this._$AM)===null||F===void 0?void 0:F._$AU)!==null&&U!==void 0?U:this._$Cg}get parentNode(){let F=this._$AA.parentNode;const U=this._$AM;return U!==void 0&&F.nodeType===11&&(F=U.parentNode),F}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(F,U=this){F=P(this,F,U),r(F)?F===w||F==null||F===""?(this._$AH!==w&&this._$AR(),this._$AH=w):F!==this._$AH&&F!==b&&this.$(F):F._$litType$!==void 0?this.T(F):F.nodeType!==void 0?this.k(F):u(F)?this.S(F):this.$(F)}M(F,U=this._$AB){return this._$AA.parentNode.insertBefore(F,U)}k(F){this._$AH!==F&&(this._$AR(),this._$AH=this.M(F))}$(F){this._$AH!==w&&r(this._$AH)?this._$AA.nextSibling.data=F:this.k(l$2.createTextNode(F)),this._$AH=F}T(F){var U;const{values:se,_$litType$:ve}=F,ct=typeof ve=="number"?this._$AC(F):(ve.el===void 0&&(ve.el=E.createElement(ve.h,this.options)),ve);if(((U=this._$AH)===null||U===void 0?void 0:U._$AD)===ct)this._$AH.m(se);else{const pt=new V(ct,this),yt=pt.p(this.options);pt.m(se),this.k(yt),this._$AH=pt}}_$AC(F){let U=T.get(F.strings);return U===void 0&&T.set(F.strings,U=new E(F)),U}S(F){d(this._$AH)||(this._$AH=[],this._$AR());const U=this._$AH;let se,ve=0;for(const ct of F)ve===U.length?U.push(se=new N(this.M(h()),this.M(h()),this,this.options)):se=U[ve],se._$AI(ct),ve++;ve<U.length&&(this._$AR(se&&se._$AB.nextSibling,ve),U.length=ve)}_$AR(F=this._$AA.nextSibling,U){var se;for((se=this._$AP)===null||se===void 0||se.call(this,!1,!0,U);F&&F!==this._$AB;){const ve=F.nextSibling;F.remove(),F=ve}}setConnected(F){var U;this._$AM===void 0&&(this._$Cg=F,(U=this._$AP)===null||U===void 0||U.call(this,F))}}class S{constructor(F,U,se,ve,ct){this.type=1,this._$AH=w,this._$AN=void 0,this.element=F,this.name=U,this._$AM=ve,this.options=ct,se.length>2||se[0]!==""||se[1]!==""?(this._$AH=Array(se.length-1).fill(new String),this.strings=se):this._$AH=w}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(F,U=this,se,ve){const ct=this.strings;let pt=!1;if(ct===void 0)F=P(this,F,U,0),pt=!r(F)||F!==this._$AH&&F!==b,pt&&(this._$AH=F);else{const yt=F;let Et,Xt;for(F=ct[0],Et=0;Et<ct.length-1;Et++)Xt=P(this,yt[se+Et],U,Et),Xt===b&&(Xt=this._$AH[Et]),pt||(pt=!r(Xt)||Xt!==this._$AH[Et]),Xt===w?F=w:F!==w&&(F+=(Xt!=null?Xt:"")+ct[Et+1]),this._$AH[Et]=Xt}pt&&!ve&&this.C(F)}C(F){F===w?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,F!=null?F:"")}}class M extends S{constructor(){super(...arguments),this.type=3}C(F){this.element[this.name]=F===w?void 0:F}}const k=i$1?i$1.emptyScript:"";class H extends S{constructor(){super(...arguments),this.type=4}C(F){F&&F!==w?this.element.setAttribute(this.name,k):this.element.removeAttribute(this.name)}}class I extends S{constructor(F,U,se,ve,ct){super(F,U,se,ve,ct),this.type=5}_$AI(F,U=this){var se;if((F=(se=P(this,F,U,0))!==null&&se!==void 0?se:w)===b)return;const ve=this._$AH,ct=F===w&&ve!==w||F.capture!==ve.capture||F.once!==ve.once||F.passive!==ve.passive,pt=F!==w&&(ve===w||ct);ct&&this.element.removeEventListener(this.name,this,ve),pt&&this.element.addEventListener(this.name,this,F),this._$AH=F}handleEvent(F){var U,se;typeof this._$AH=="function"?this._$AH.call((se=(U=this.options)===null||U===void 0?void 0:U.host)!==null&&se!==void 0?se:this.element,F):this._$AH.handleEvent(F)}}class L{constructor(F,U,se){this.element=F,this.type=6,this._$AN=void 0,this._$AM=U,this.options=se}get _$AU(){return this._$AM._$AU}_$AI(F){P(this,F)}}const z=window.litHtmlPolyfillSupport;z==null||z(E,N),((t$1=globalThis.litHtmlVersions)!==null&&t$1!==void 0?t$1:globalThis.litHtmlVersions=[]).push("2.2.3");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var l$1,o$2;class s extends a$1{constructor(){super(...arguments),this.renderOptions={host:this},this._$Dt=void 0}createRenderRoot(){var F,U;const se=super.createRenderRoot();return(F=(U=this.renderOptions).renderBefore)!==null&&F!==void 0||(U.renderBefore=se.firstChild),se}update(F){const U=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(F),this._$Dt=x(U,this.renderRoot,this.renderOptions)}connectedCallback(){var F;super.connectedCallback(),(F=this._$Dt)===null||F===void 0||F.setConnected(!0)}disconnectedCallback(){var F;super.disconnectedCallback(),(F=this._$Dt)===null||F===void 0||F.setConnected(!1)}render(){return b}}s.finalized=!0,s._$litElement$=!0,(l$1=globalThis.litElementHydrateSupport)===null||l$1===void 0||l$1.call(globalThis,{LitElement:s});const n$2=globalThis.litElementPolyfillSupport;n$2==null||n$2({LitElement:s});((o$2=globalThis.litElementVersions)!==null&&o$2!==void 0?o$2:globalThis.litElementVersions=[]).push("3.2.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const n$1=R=>F=>typeof F=="function"?((U,se)=>(window.customElements.define(U,se),se))(R,F):((U,se)=>{const{kind:ve,elements:ct}=se;return{kind:ve,elements:ct,finisher(pt){window.customElements.define(U,pt)}}})(R,F);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const i=(R,F)=>F.kind==="method"&&F.descriptor&&!("value"in F.descriptor)?yi(li({},F),{finisher(U){U.createProperty(F.key,R)}}):{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:F.key,initializer(){typeof F.initializer=="function"&&(this[F.key]=F.initializer.call(this))},finisher(U){U.createProperty(F.key,R)}};function e$1(R){return(F,U)=>U!==void 0?((se,ve,ct)=>{ve.constructor.createProperty(ct,se)})(R,F,U):i(R,F)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function t(R){return e$1(yi(li({},R),{state:!0}))}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const o$1=({finisher:R,descriptor:F})=>(U,se)=>{var ve;if(se===void 0){const ct=(ve=U.originalKey)!==null&&ve!==void 0?ve:U.key,pt=F!=null?{kind:"method",placement:"prototype",key:ct,descriptor:F(U.key)}:yi(li({},U),{key:ct});return R!=null&&(pt.finisher=function(yt){R(yt,ct)}),pt}{const ct=U.constructor;F!==void 0&&Object.defineProperty(U,se,F(se)),R==null||R(ct,se)}};/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var n;const e=((n=window.HTMLSlotElement)===null||n===void 0?void 0:n.prototype.assignedElements)!=null?(R,F)=>R.assignedElements(F):(R,F)=>R.assignedNodes(F).filter(U=>U.nodeType===Node.ELEMENT_NODE);function l(R){const{slot:F,selector:U}=R!=null?R:{};return o$1({descriptor:se=>({get(){var ve;const ct="slot"+(F?`[name=${F}]`:":not([name])"),pt=(ve=this.renderRoot)===null||ve===void 0?void 0:ve.querySelector(ct),yt=pt!=null?e(pt,R):[];return U?yt.filter(Et=>Et.matches(U)):yt},enumerable:!0,configurable:!0})})}var __decorate$2=globalThis&&globalThis.__decorate||function(R,F,U,se){var ve=arguments.length,ct=ve<3?F:se===null?se=Object.getOwnPropertyDescriptor(F,U):se,pt;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")ct=Reflect.decorate(R,F,U,se);else for(var yt=R.length-1;yt>=0;yt--)(pt=R[yt])&&(ct=(ve<3?pt(ct):ve>3?pt(F,U,ct):pt(F,U))||ct);return ve>3&&ct&&Object.defineProperty(F,U,ct),ct};let PaymentPopup=class extends s{constructor(){super(...arguments);this.loading=!1,this.subscribed=!1,this.abortOnClose=!0}onClose(F){F.preventDefault(),this.remove(),this.abortOnClose&&this.onAbort&&this.onAbort()}async onSubmit(F){F.preventDefault(),!this.loading&&(this.loading=!0,this.onPaymentSubmitted&&this.onPaymentSubmitted())}setErrorMessage(F){this.error=F}setLoading(F){this.loading=F}setSubscribed(){this.loading=!1,this.subscribed=!0}setAbortOnClose(F){this.abortOnClose=F}render(){let F;return this.subscribed?F=$`
                <form id="payment-form" @submit="${this.onSubmit}">
                    <p>You have successfully subscribed!</p>
                    <br>
                </form>
            `:F=$`
                <form id="payment-form" @submit="${this.onSubmit}">
                    <slot></slot>
                    <br>
                    <button id="submit" type="submit" ${this.loading?"disabled":""}>
                        ${this.loading?$`<span class="spinner"></span>`:"Subscribe"}
                    </button>
                    <div id="error-message" class="error">
                        ${this.error}
                    </div>
                </form>
            `,$`
            <div class="overlay">
                <div class="popup">
                    <div class="close" @click="${this.onClose}"></div>
                    ${F}
                </div>
            </div>
        `}};PaymentPopup.styles=r$2`
        :host {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 99999999;
            width: 100%;
            height: 100%;

            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Helvetica, sans-serif;
            user-select: none;

            color: #415462;

            --primary: #1095c1;
            font-size: 18px;
        }

        .overlay {
            position: relative;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);

            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadein 0.05s linear;
        }

        @keyframes fadein {
            from {
                background: transparent;
            }
            to {
                background: rgba(0,0,0,0.6);
            }
        }

        .popup {
            position: relative;

            background: #fff;
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;

            box-shadow: rgba(0,0,0,0.3) 0 8px 24px;
            margin: 1rem;

            animation: popup-enter 0.2s ease-out;
        }

        @keyframes popup-enter {
            from {
                transform: translateY(-1.5rem);
            }
            to {
                transform: translateY(0);
            }
        }

        .spinner {
            display: inline-block;
            border-radius: 50%;

            width: 1em;
            height: 1em;
            padding: 0;
            margin: -8px 0;
            border: 5px solid rgba(0,0,0,0.1);
            border-bottom-color: #fff;
            animation: spinner-spin 1s infinite linear;
        }
        @keyframes spinner-spin { from { transform: rotate(0); } to { transform: rotate(360deg); } }

        .close {
            cursor: pointer;
            position: absolute;
            top: 0;
            right: 0;
            color: #c0c0c0;
            font-size: 32px;
            padding: 10px;
            line-height: 20px;
        }
        .close:after {
            content: "\\00d7";
        }
        .close:hover {
            color: #999;
        }

        form {
            display: flex;
            flex-direction: column;
        }

        form * {
            padding: 0.5rem;
        }

        input {
            transition: box-shadow;
            outline: none;
            box-shadow: none;
            border: 1px solid #a2afb9;
            padding: 0.75rem 1rem;
            font-size: 1.25rem;
            border-radius: 0.25rem;
        }

        input:focus {
            box-shadow: 0 0 0 3px rgba(16, 149, 193, 0.125);
            border-color: var(--primary);
        }

        button {
            color: white;
            background: var(--primary);
            padding: 0.75rem 1rem;
            font-size: 1rem;

            border: none;
            outline: none;
            cursor: pointer;
            text-align: center;
            border-radius: 0.25rem;
            font-size: 1.25rem;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }

        #code {
            text-align: center;
        }
        .error {
            color: red;
        }
    `;__decorate$2([t()],PaymentPopup.prototype,"loading",void 0);__decorate$2([t()],PaymentPopup.prototype,"subscribed",void 0);__decorate$2([t()],PaymentPopup.prototype,"abortOnClose",void 0);__decorate$2([t()],PaymentPopup.prototype,"error",void 0);PaymentPopup=__decorate$2([n$1("playpass-pay")],PaymentPopup);async function initSubscriptionCache(){await replicantClient.subscriptions.getSubscription()}var __decorate$1=globalThis&&globalThis.__decorate||function(R,F,U,se){var ve=arguments.length,ct=ve<3?F:se===null?se=Object.getOwnPropertyDescriptor(F,U):se,pt;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")ct=Reflect.decorate(R,F,U,se);else for(var yt=R.length-1;yt>=0;yt--)(pt=R[yt])&&(ct=(ve<3?pt(ct):ve>3?pt(F,U,ct):pt(F,U))||ct);return ve>3&&ct&&Object.defineProperty(F,U,ct),ct};let LoginPopup=class extends s{constructor(){super(...arguments);this.loggedIn=!1,this.loading=!1}onClose(F){F.preventDefault(),this.remove(),this.loggedIn?this.onLogin&&this.onLogin():this.onAbort&&this.onAbort()}async onSubmitPhone(F){if(F.preventDefault(),this.loading)return;this.loading=!0;const U=window.intlTelInputGlobals.getInstance(this.phoneElement[0].children[0].children[1]).s.dialCode,se=this.phoneElement[0].children[0].children[1].value,ve=se.startsWith("+")?se:U+se;this.error=void 0;try{const{verifyOtp:ct}=await this.replicantClient.login({consentText:"Enter phone number",phoneNumber:ve});this.verifyOtp=ct}catch(ct){console.error(ct),this.error="Invalid phone number, try again",this.loading=!1;return}this.phone=se,this.loading=!1}async onInputCode(F){this.error=void 0;const U=F.target,se=/\d{6}/.exec(U.value);if(se){const ve=se[0];await this.verifyOtp(ve)?this.loggedIn=!0:this.error="Invalid code"}}onTryAnotherPhone(F){F.preventDefault(),this.error=void 0,this.phone=void 0}render(){let F;return this.loggedIn?F=$`<h2>Welcome</h2>
                <p>Success! You are now logged in.</p>
                <form @submit="${this.onClose}">
                    <button type="submit">Continue</button>
                </form>`:this.phone?F=$`<h2>Confirm</h2>
                <p>We sent a code to ${this.phone}, enter it below.</p>
                <form>
                    <input id="code" type="text" inputmode="numeric" pattern="[0-9]*" autocomplete="one-time-code" @input="${this.onInputCode}" autofocus />
                    <span class="error">${this.error}</span>
                    <a @click="${this.onTryAnotherPhone}" href="#">← Use a different phone number</a>
                </form>`:F=$`<h2>Login</h2>
                <p>Enter your phone number below to login.</p>
                <form @submit="${this.onSubmitPhone}">
                    <slot></slot>
                    <span class="error">${this.error}</span>
                    <button type="submit" ${this.loading?"disabled":""}>
                        ${this.loading?$`<span class="spinner"></span>`:"Send SMS"}
                    </button>
                </form>`,$`
            <div class="overlay">
                <div class="popup">
                    <div class="close" @click="${this.onClose}"></div>
                    ${F}
                </div>
            </div>
        `}};LoginPopup.styles=r$2`
        :host {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 0;
            width: 100%;
            height: 100%;

            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Helvetica, sans-serif;
            user-select: none;

            color: #415462;

            --primary: #1095c1;
            font-size: 18px;
        }

        .overlay {
            position: relative;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);

            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadein 0.05s linear;
        }

        @keyframes fadein {
            from {
                background: transparent;
            }
            to {
                background: rgba(0,0,0,0.6);
            }
        }

        .popup {
            position: relative;

            background: #fff;
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;

            box-shadow: rgba(0,0,0,0.3) 0 8px 24px;
            margin: 1rem;

            animation: popup-enter 0.2s ease-out;
        }

        @keyframes popup-enter {
            from {
                transform: translateY(-1.5rem);
            }
            to {
                transform: translateY(0);
            }
        }

        .spinner {
            display: inline-block;
            border-radius: 50%;

            width: 1em;
            height: 1em;
            padding: 0;
            margin: -8px 0;
            border: 5px solid rgba(0,0,0,0.1);
            border-bottom-color: #fff;
            animation: spinner-spin 1s infinite linear;
        }
        @keyframes spinner-spin { from { transform: rotate(0); } to { transform: rotate(360deg); } }

        .close {
            cursor: pointer;
            position: absolute;
            top: 0;
            right: 0;
            color: #c0c0c0;
            font-size: 32px;
            padding: 10px;
            line-height: 20px;
        }
        .close:after {
            content: "\\00d7";
        }
        .close:hover {
            color: #999;
        }

        form {
            display: flex;
            flex-direction: column;
        }

        form * {
            padding: 0.5rem;
        }

        input {
            transition: box-shadow;
            outline: none;
            box-shadow: none;
            border: 1px solid #a2afb9;
            padding: 0.75rem 1rem;
            font-size: 1.25rem;
            border-radius: 0.25rem;
        }

        input:focus {
            box-shadow: 0 0 0 3px rgba(16, 149, 193, 0.125);
            border-color: var(--primary);
        }

        button {
            color: white;
            background: var(--primary);
            padding: 0.75rem 1rem;
            font-size: 1rem;

            border: none;
            outline: none;
            cursor: pointer;
            text-align: center;
            border-radius: 0.25rem;
            font-size: 1.25rem;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }

        #code {
            text-align: center;
        }
        .error {
            color: red;
        }
    `;__decorate$1([t()],LoginPopup.prototype,"loggedIn",void 0);__decorate$1([t()],LoginPopup.prototype,"phone",void 0);__decorate$1([t()],LoginPopup.prototype,"error",void 0);__decorate$1([t()],LoginPopup.prototype,"loading",void 0);__decorate$1([l({slot:""})],LoginPopup.prototype,"phoneElement",void 0);LoginPopup=__decorate$1([n$1("playpass-login")],LoginPopup);let replicantClient,pendingLogin,loggedIn=!1;async function onLogin(){await Promise.all([cloudStorage.onLogin(replicantClient),initSubscriptionCache()]),loggedIn=!0}function onLogout(){loggedIn=!1}function isLoggedIn(){return loggedIn}async function login(){if(requireInit("playpass.account.login"),isLoggedIn())return!0;if(pendingLogin)return pendingLogin;const R=document.createElement("div"),F=document.createElement("input");F.id="phone",F.className="phoneInput",F.type="tel",F.autocomplete="tel",F.required=!0,R.appendChild(F),window.intlTelInput(F,{});const U=document.createElement("playpass-login");U.appendChild(R),document.body.appendChild(U),pendingLogin=new Promise(ve=>{U.replicantClient=replicantClient,U.onAbort=()=>{ve(!1)},U.onLogin=async()=>{await onLogin(),ve(!0)}});const se=await pendingLogin;return pendingLogin=void 0,se}function logout(){requireInit("playpass.account.logout"),replicantClient.logout(),onLogout()}async function initLogin(R){const F="replicantCreds";let U=await internalStorage.get(F),se;function ve(ct){if(se&&se!=ct)throw new Error("Multiple storage keys not supported");se=ct}replicantClient=await Jt.create({appName:R,replicant:{storageOverride:{length:1,getItem(ct){return ve(ct),U},setItem(ct,pt){ve(ct),U=pt,internalStorage.set(F,U)},removeItem(ct){ve(ct),internalStorage.remove(F)},clear(){throw new Error("Not implemented")},key(){throw new Error("Not implemented")}},version:"1.4.0"},stripeAccountId:getStripeAccount()}),replicantClient.isLoggedIn()&&await onLogin()}let playerId="",initialized=!1,stripeAccount,stripeScript,phoneCodeCss,phoneCodeScript;async function init(R){if(playerId=await internalStorage.get("playerId"),playerId||(playerId=randomId("player"),internalStorage.set("playerId",playerId)),stripeAccount=R==null?void 0:R.stripeAccount,stripeScript||(stripeScript=document.createElement("script"),stripeScript.setAttribute("src","https://js.stripe.com/v3/"),stripeScript.setAttribute("crossorigin","anonymous"),document.head.appendChild(stripeScript)),phoneCodeCss||(phoneCodeCss=document.createElement("link"),phoneCodeCss.rel="stylesheet",phoneCodeCss.href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css",document.head.appendChild(phoneCodeCss)),!phoneCodeScript){phoneCodeScript=document.createElement("script"),phoneCodeScript.setAttribute("src","https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"),phoneCodeScript.setAttribute("crossorigin","anonymous"),document.head.appendChild(phoneCodeScript);const ct=document.createElement("style");ct.innerText=".phoneInput { transition: box-shadow; outline: none; box-shadow: none; border: 1px solid #a2afb9; padding: 0.75rem 1rem; font-size: 1.25rem; border-radius: 0.25rem; } .phoneInput:focus { box-shadow: 0 0 0 3px rgba(16, 149, 193, 0.125); border-color: var(--primary); }",document.head.appendChild(ct)}const F=(R==null?void 0:R.gameId)||"unknown";await Promise.all([initFeatureFlags(),initLogin(F)]),playpassAnalytics.init(F);const U=decode$1(),se=getGCInstantEntryData(),ve=stripPayloadsFromUrl(location.href);ve!=location.href&&history.replaceState(null,"",ve),playpassAnalytics.track("Entry",yi(li({},se),{channel:U.channel,$referrer_id:U.referrer})),window.addEventListener("appinstalled",()=>{analytics.track("HomescreenInstall")}),initialized=!0}function requireInit(R){if(!initialized)throw new Error(`Await for playpass.init() before calling ${R}()`)}function getStripeAccount(){return stripeAccount}function getPlayerId(){return playerId}function getGCInstantEntryData(){const R=new URLSearchParams(location.search).get("payload");if(R)try{return JSON.parse(R)}catch{}return{}}const SEND_DELAY=250;function send(R){const F="https://t.playpass.games/record",U=JSON.stringify(R);navigator.sendBeacon?navigator.sendBeacon(F,new Blob([U],{type:"application/json"})):fetch(F,{method:"POST",headers:{"Content-Type":"application/json"},body:U})}class PlaypassAnalytics{constructor(){this.initialized=!1,this.gameId=void 0,this.eventQueue=[],this.userProps={},this.sessionId=randomId("session"),document.addEventListener("visibilitychange",()=>{document.visibilityState=="hidden"&&(this.track("PageHide"),this.flush())});const F=()=>{this.track("FirstTap"),window.removeEventListener("pointerdown",F)};window.addEventListener("pointerdown",F)}track(F,U){this.initialized&&this.eventQueue.length==0&&setTimeout(()=>{this.flush()},SEND_DELAY),this.eventQueue.push({user_id:getPlayerId(),session_id:this.sessionId,event_time:new Date().toISOString(),event_type:F,page:document.location.href,referrer:document.referrer,locale:navigator==null?void 0:navigator.language,event_properties:U||{},user_properties:this.userProps})}setUserProperties(F){this.userProps=li(li({},this.userProps),F)}init(F){this.initialized=!0,this.gameId=F,this.flush()}flush(){this.eventQueue.length&&(this.gameId&&send({project_id:this.gameId,events:this.eventQueue}),this.eventQueue.length=0)}}const playpassAnalytics=new PlaypassAnalytics;class MirrorAnalytics{constructor(){this.targets=[playpassAnalytics]}track(F,U){this.targets.forEach(se=>{se.track(F,U)})}setUserProperties(F){this.targets.forEach(U=>{U.setUserProperties(F)})}addTarget(F){this.targets.push(F)}}const mirror=new MirrorAnalytics,analytics=mirror;var ShareType;(function(R){R.Any="any",R.Facebook="facebook",R.Twitter="twitter",R.WhatsApp="whatsapp",R.Telegram="telegram",R.Clipboard="clipboard"})(ShareType||(ShareType={}));/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function*o(R,F){if(R!==void 0){let U=0;for(const se of R)yield F(se,U++)}}const popupCss=r$2`
    :host {
        position: fixed;
        top: 0;
        left: 0;
        z-index: 0;
        width: 100%;
        height: 100%;

        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Helvetica, sans-serif;
        user-select: none;

        color: #415462;

        --primary: #1095c1;
        font-size: 18px;
    }

    .overlay {
        position: relative;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.6);

        display: flex;
        align-items: center;
        justify-content: center;
        animation: fadein 0.05s linear;
    }

    @keyframes fadein {
        from {
            background: transparent;
        }
        to {
            background: rgba(0,0,0,0.6);
        }
    }

    .popup {
        position: relative;

        background: #fff;
        padding: 1.5rem;
        border-radius: 0.5rem;
        text-align: center;

        box-shadow: rgba(0,0,0,0.3) 0 8px 24px;
        margin: 1rem;

        animation: popup-enter 0.2s ease-out;
    }

    @keyframes popup-enter {
        from {
            transform: translateY(-1.5rem);
        }
        to {
            transform: translateY(0);
        }
    }

    .spinner {
        display: inline-block;
        border-radius: 50%;

        width: 1em;
        height: 1em;
        padding: 0;
        margin: -8px 0;
        border: 5px solid rgba(0,0,0,0.1);
        border-bottom-color: #fff;
        animation: spinner-spin 1s infinite linear;
    }
    @keyframes spinner-spin { from { transform: rotate(0); } to { transform: rotate(360deg); } }

    .close {
        cursor: pointer;
        position: absolute;
        top: 0;
        right: 0;
        color: #c0c0c0;
        font-size: 32px;
        padding: 10px;
        line-height: 20px;
    }
    .close:after {
        content: "\\00d7";
    }
    .close:hover {
        color: #999;
    }

    form {
        display: flex;
        flex-direction: column;
    }

    form * {
        padding: 0.5rem;
    }

    input {
        transition: box-shadow;
        outline: none;
        box-shadow: none;
        border: 1px solid #a2afb9;
        padding: 0.75rem 1rem;
        font-size: 1.25rem;
        border-radius: 0.25rem;
    }

    input:focus {
        box-shadow: 0 0 0 3px rgba(16, 149, 193, 0.125);
        border-color: var(--primary);
    }

    button {
        color: white;
        background: var(--primary);
        padding: 0.75rem 1rem;
        font-size: 1rem;

        border: none;
        outline: none;
        cursor: pointer;
        text-align: center;
        border-radius: 0.25rem;
        font-size: 1.25rem;
    }

    a {
        color: var(--primary);
        text-decoration: none;
    }
    a:hover {
        text-decoration: underline;
    }

    .error {
        color: red;
    }
`;class Popup extends s{onClose(F){F.preventDefault(),this.remove()}renderPopup(){return $`<p>Hello world</p>`}render(){return $`
            <div class="overlay">
                <div class="popup">
                    <div class="close" @click="${this.onClose}"></div>
                    ${this.renderPopup()}
                </div>
            </div>
        `}}var __decorate=globalThis&&globalThis.__decorate||function(R,F,U,se){var ve=arguments.length,ct=ve<3?F:se===null?se=Object.getOwnPropertyDescriptor(F,U):se,pt;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")ct=Reflect.decorate(R,F,U,se);else for(var yt=R.length-1;yt>=0;yt--)(pt=R[yt])&&(ct=(ve<3?pt(ct):ve>3?pt(F,U,ct):pt(F,U))||ct);return ve>3&&ct&&Object.defineProperty(F,U,ct),ct};const icons=[{type:ShareType.Facebook,path:y`<path d="M24 12a12 12 0 10-13.9 11.9v-8.4h-3V12h3V9.4c0-3 1.8-4.7 4.6-4.7l2.6.2v3h-1.5c-1.5 0-2 .9-2 1.8V12h3.4l-.5 3.5h-2.8v8.4A12 12 0 0024 12z" />`,color:"#0076FB"},{type:ShareType.Twitter,path:y`<path d="M24 4.6a10 10 0 01-2.9.7 5 5 0 002.2-2.7c-1 .6-2 1-3.1 1.2a5 5 0 00-8.4 4.5A14 14 0 011.6 3.2 4.8 4.8 0 001 5.6a5 5 0 002.2 4.1 4.9 4.9 0 01-2.3-.6A5 5 0 005 14a5 5 0 01-2.2 0 5 5 0 004.6 3.5 9.9 9.9 0 01-6.1 2.1H0a14 14 0 007.6 2.2c9 0 14-7.5 14-14V7A10 10 0 0024 4.6z" />`,color:"#1DA1F2"},{type:ShareType.WhatsApp,path:y`<path d="M17.5 14.4l-2-1c-.3 0-.5-.1-.7.2l-1 1.1c-.1.2-.3.3-.6.1s-1.3-.5-2.4-1.5a9 9 0 01-1.7-2c-.1-.3 0-.5.2-.6l.4-.6c.2-.1.2-.3.3-.5v-.5L9 7c-.2-.6-.4-.5-.6-.5h-.6c-.2 0-.5 0-.8.4-.2.3-1 1-1 2.5s1 2.8 1.2 3c.2.2 2.1 3.2 5.1 4.5l1.7.6a4 4 0 001.9.2c.5-.1 1.7-.8 2-1.5.2-.6.2-1.2.1-1.4l-.5-.3M12 21.8a9.9 9.9 0 01-5-1.4l-.4-.2-3.7 1 1-3.7-.2-.3a9.9 9.9 0 01-1.5-5.3 9.9 9.9 0 0116.8-7 9.8 9.8 0 013 7 9.9 9.9 0 01-10 9.9m8.4-18.3A11.8 11.8 0 0012.1 0 12 12 0 001.8 17.8L0 24l6.4-1.6a11.9 11.9 0 005.6 1.4 12 12 0 0012-11.9 11.8 11.8 0 00-3.5-8.4z" />`,color:"#25D366"},{type:ShareType.Telegram,path:y`<path d="M23.91 3.79L20.3 20.84c-.25 1.21-.98 1.5-2 .94l-5.5-4.07-2.66 2.57c-.3.3-.55.56-1.1.56-.72 0-.6-.27-.84-.95L6.3 13.7.85 12c-1.18-.35-1.19-1.16.26-1.75l21.26-8.2c.97-.43 1.9.24 1.53 1.73z" />`,color:"#0088CC"},{type:ShareType.Clipboard,path:y`<path d="M16 1H4a2 2 0 00-2 2v14h2V3h12V1zm3 4H8a2 2 0 00-2 2v14c0 1.1.9 2 2 2h11a2 2 0 002-2V7a2 2 0 00-2-2zm0 16H8V7h11v14z" />`,color:"#718096"}];let SharePopup=class extends Popup{constructor(){super(...arguments);this.shareText=""}onClose(F){super.onClose(F),this.onShare&&this.onShare(null)}onShareClick(F){if(this.onShare&&F.currentTarget instanceof HTMLButtonElement){const U=F.currentTarget.name;this.onShare(U)}this.remove()}renderPopup(){return $`
            <p class="preview">
                ${this.shareText}
            </p>
            ${o(icons,F=>$`
                <button style="background: ${F.color}" name="${F.type}" @click="${this.onShareClick}">
                    <svg fill="white" viewBox="0 0 24 24">
                        ${F.path}
                    </svg>
                </button>`)}
        `}};SharePopup.styles=[popupCss,r$2`
            button {
                font-size: 0;
                width: 4rem;
                padding: 0.5rem;
            }

            .preview {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 24rem;
                font-style: italic;
                color: #666;
            }
        `];__decorate([e$1()],SharePopup.prototype,"shareText",void 0);SharePopup=__decorate([n$1("playpass-share")],SharePopup);async function share(R){var yt,Et;const F=(R==null?void 0:R.files)||[],U=(R==null?void 0:R.text)||F.length?R==null?void 0:R.text:createLink(),se=(R==null?void 0:R.type)||ShareType.Any,ve={fileCount:F.length,textLength:(yt=U==null?void 0:U.length)!=null?yt:0,type:se};analytics.track("SharePrompted",ve);const ct={files:F,text:U};let pt=!1;if(se==ShareType.Any)if(((Et=navigator.canShare)==null?void 0:Et.call(navigator,ct))&&navigator.share&&"ontouchstart"in document.documentElement)try{await navigator.share(ct),pt=!0}catch(Xt){if(!(Xt instanceof Error))throw Xt;Xt.name=="AbortError"?analytics.track("ShareRejected",ve):analytics.track("ShareError",yi(li({},ve),{error:Xt.name}))}else U&&(pt=await new Promise(Xt=>{const Tt=document.createElement("playpass-share");Tt.shareText=U,Tt.onShare=lr=>{Xt(lr?doShare(lr,U):!1)},document.body.appendChild(Tt)}));else U&&await doShare(se,U)&&(pt=!0);return pt&&analytics.track("ShareSent",ve),pt}async function doShare(R,F){const U=/\bhttps?:\/\/[^\s]+/,se=F.match(U),ve=F.replace(U,"").trim();switch(R){case ShareType.Facebook:return openNewTab("https://www.facebook.com/sharer/sharer.php",{quote:ve,u:se?se[0]:createLink()}),!0;case ShareType.Twitter:return openNewTab("https://twitter.com/intent/tweet",{text:F}),!0;case ShareType.WhatsApp:return openNewTab("https://api.whatsapp.com/send",{text:F}),!0;case ShareType.Telegram:return openNewTab("https://telegram.me/share/msg",{text:ve,url:se?se[0]:createLink()}),!0;case ShareType.Clipboard:return copyToClipboard(F),!0;default:throw new Error(`Unsupported share type: ${R}`)}}function openNewTab(R,F){const U=new URL(R);for(const se in F)U.searchParams.set(se,F[se]);window.open(U.toString(),"_blank","noopener")}let gcinstantSharePayload={};function createLink(R){var se,ve;const F=location.port||location.hostname.endsWith(".playpass.games")?"playpass.link":location.hostname,U=encode({channel:(se=R==null?void 0:R.channel)!=null?se:"SHARE",data:R==null?void 0:R.data,referrer:getPlayerId(),gcinstant:yi(li({},gcinstantSharePayload),{$channel:(ve=R==null?void 0:R.channel)!=null?ve:"SHARE"})});return callShortener(U),`https://${F}/${shortHash(U)}`}async function callShortener(R){await(await fetch("https://api.playpass.link",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Basic d29yZHMuZ2c6RHV4ZXRTMVhPTXBEd3JjZA=="},body:JSON.stringify({url:R})})).json()}async function copyToClipboard(R){try{analytics.track("ClipboardCopy"),await navigator.clipboard.writeText(R),analytics.track("ClipboardCopySuccess")}catch{const F=document.createElement("textarea");return F.value=R,F.style.position="fixed",F.style.left="-999999px",F.style.top="-999999px",document.body.appendChild(F),F.focus(),F.select(),new Promise((U,se)=>{document.execCommand("copy")?(analytics.track("ClipboardCopySuccess"),U()):(analytics.track("ClipboardCopyFailure"),se(new Error("execCommand copy failed"))),F.remove()})}}function _classCallCheck(R,F){if(!(R instanceof F))throw new TypeError("Cannot call a class as a function")}var mulTable=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shgTable=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function processImageDataRGBA(R,F,U,se,ve,ct){for(var pt=R.data,yt=2*ct+1,Et=se-1,Xt=ve-1,Tt=ct+1,lr=Tt*(Tt+1)/2,jr=new BlurStack,Vr=jr,ri,si=1;si<yt;si++)Vr=Vr.next=new BlurStack,si===Tt&&(ri=Vr);Vr.next=jr;for(var Zr=null,di=null,gi=0,ui=0,pi=mulTable[ct],Jr=shgTable[ct],ei=0;ei<ve;ei++){Vr=jr;for(var oi=pt[ui],ai=pt[ui+1],hi=pt[ui+2],fi=pt[ui+3],ii=0;ii<Tt;ii++)Vr.r=oi,Vr.g=ai,Vr.b=hi,Vr.a=fi,Vr=Vr.next;for(var ci=0,ni=0,ti=0,mi=0,xi=Tt*oi,$i=Tt*ai,Oi=Tt*hi,Hi=Tt*fi,Pi=lr*oi,Ii=lr*ai,Ci=lr*hi,Ti=lr*fi,Ei=1;Ei<Tt;Ei++){var Ni=ui+((Et<Ei?Et:Ei)<<2),nn=pt[Ni],an=pt[Ni+1],sn=pt[Ni+2],on=pt[Ni+3],ji=Tt-Ei;Pi+=(Vr.r=nn)*ji,Ii+=(Vr.g=an)*ji,Ci+=(Vr.b=sn)*ji,Ti+=(Vr.a=on)*ji,ci+=nn,ni+=an,ti+=sn,mi+=on,Vr=Vr.next}Zr=jr,di=ri;for(var Gi=0;Gi<se;Gi++){var zi=Ti*pi>>Jr;if(pt[ui+3]=zi,zi!==0){var Wi=255/zi;pt[ui]=(Pi*pi>>Jr)*Wi,pt[ui+1]=(Ii*pi>>Jr)*Wi,pt[ui+2]=(Ci*pi>>Jr)*Wi}else pt[ui]=pt[ui+1]=pt[ui+2]=0;Pi-=xi,Ii-=$i,Ci-=Oi,Ti-=Hi,xi-=Zr.r,$i-=Zr.g,Oi-=Zr.b,Hi-=Zr.a;var wi=Gi+ct+1;wi=gi+(wi<Et?wi:Et)<<2,ci+=Zr.r=pt[wi],ni+=Zr.g=pt[wi+1],ti+=Zr.b=pt[wi+2],mi+=Zr.a=pt[wi+3],Pi+=ci,Ii+=ni,Ci+=ti,Ti+=mi,Zr=Zr.next;var Ri=di,ln=Ri.r,cn=Ri.g,un=Ri.b,hn=Ri.a;xi+=ln,$i+=cn,Oi+=un,Hi+=hn,ci-=ln,ni-=cn,ti-=un,mi-=hn,di=di.next,ui+=4}gi+=se}for(var ki=0;ki<se;ki++){ui=ki<<2;var Si=pt[ui],Ai=pt[ui+1],_i=pt[ui+2],vi=pt[ui+3],Ki=Tt*Si,Yi=Tt*Ai,Ji=Tt*_i,Qi=Tt*vi,Di=lr*Si,Mi=lr*Ai,Fi=lr*_i,Bi=lr*vi;Vr=jr;for(var dn=0;dn<Tt;dn++)Vr.r=Si,Vr.g=Ai,Vr.b=_i,Vr.a=vi,Vr=Vr.next;for(var fn=se,Xi=0,Zi=0,en=0,tn=0,Li=1;Li<=ct;Li++){ui=fn+ki<<2;var Ui=Tt-Li;Di+=(Vr.r=Si=pt[ui])*Ui,Mi+=(Vr.g=Ai=pt[ui+1])*Ui,Fi+=(Vr.b=_i=pt[ui+2])*Ui,Bi+=(Vr.a=vi=pt[ui+3])*Ui,tn+=Si,Xi+=Ai,Zi+=_i,en+=vi,Vr=Vr.next,Li<Xt&&(fn+=se)}ui=ki,Zr=jr,di=ri;for(var rn=0;rn<ve;rn++){var bi=ui<<2;pt[bi+3]=vi=Bi*pi>>Jr,vi>0?(vi=255/vi,pt[bi]=(Di*pi>>Jr)*vi,pt[bi+1]=(Mi*pi>>Jr)*vi,pt[bi+2]=(Fi*pi>>Jr)*vi):pt[bi]=pt[bi+1]=pt[bi+2]=0,Di-=Ki,Mi-=Yi,Fi-=Ji,Bi-=Qi,Ki-=Zr.r,Yi-=Zr.g,Ji-=Zr.b,Qi-=Zr.a,bi=ki+((bi=rn+Tt)<Xt?bi:Xt)*se<<2,Di+=tn+=Zr.r=pt[bi],Mi+=Xi+=Zr.g=pt[bi+1],Fi+=Zi+=Zr.b=pt[bi+2],Bi+=en+=Zr.a=pt[bi+3],Zr=Zr.next,Ki+=Si=di.r,Yi+=Ai=di.g,Ji+=_i=di.b,Qi+=vi=di.a,tn-=Si,Xi-=Ai,Zi-=_i,en-=vi,di=di.next,ui+=se}}return R}var BlurStack=function R(){_classCallCheck(this,R),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},imagePixels={exports:{}},toString=Object.prototype.toString,isPlainObj=function(R){var F;return toString.call(R)==="[object Object]"&&(F=Object.getPrototypeOf(R),F===null||F===Object.getPrototypeOf({}))},isBase64$2={exports:{}};(function(R,F){(function(U){function se(ve,ct){if(ve instanceof Boolean||typeof ve=="boolean"||(ct instanceof Object||(ct={}),ct.hasOwnProperty("allowBlank")&&!ct.allowBlank&&ve===""))return!1;var pt="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+/]{3}=)?";return ct.mime&&(pt="(data:\\w+\\/[a-zA-Z\\+\\-\\.]+;base64,)?"+pt),ct.paddingRequired===!1&&(pt="(?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}(==)?|[A-Za-z0-9+\\/]{3}=?)?"),new RegExp("^"+pt+"$","gi").test(ve)}R.exports&&(F=R.exports=se),F.isBase64=se})()})(isBase64$2,isBase64$2.exports);var pickByAlias=function(F,U,se){var ve={},ct,pt;if(typeof U=="string"&&(U=toList(U)),Array.isArray(U)){var yt={};for(pt=0;pt<U.length;pt++)yt[U[pt]]=!0;U=yt}for(ct in U)U[ct]=toList(U[ct]);var Et={};for(ct in U){var Xt=U[ct];if(Array.isArray(Xt))for(pt=0;pt<Xt.length;pt++){var Tt=Xt[pt];if(se&&(Et[Tt]=!0),Tt in F){if(ve[ct]=F[Tt],se)for(var lr=pt;lr<Xt.length;lr++)Et[Xt[lr]]=!0;break}}else ct in F&&(U[ct]&&(ve[ct]=F[ct]),se&&(Et[ct]=!0))}if(se)for(ct in F)Et[ct]||(ve[ct]=F[ct]);return ve},CACHE={};function toList(R){return CACHE[R]?CACHE[R]:(typeof R=="string"&&(R=CACHE[R]=R.split(/\s*,\s*|\s+/)),R)}var pick=pickByAlias,parseRect_1=parseRect;function parseRect(R){var F;return arguments.length>1&&(R=arguments),typeof R=="string"?R=R.split(/\s/).map(parseFloat):typeof R=="number"&&(R=[R]),R.length&&typeof R[0]=="number"?R.length===1?F={width:R[0],height:R[0],x:0,y:0}:R.length===2?F={width:R[0],height:R[1],x:0,y:0}:F={x:R[0],y:R[1],width:R[2]-R[0]||0,height:R[3]-R[1]||0}:R&&(R=pick(R,{left:"x l left Left",top:"y t top Top",width:"w width W Width",height:"h height W Width",bottom:"b bottom Bottom",right:"r right Right"}),F={x:R.left||0,y:R.top||0},R.width==null?R.right?F.width=R.right-F.x:F.width=0:F.width=R.width,R.height==null?R.bottom?F.height=R.bottom-F.y:F.height=0:F.height=R.height),F}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(R){if(R==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(R)}function shouldUseNative(){try{if(!Object.assign)return!1;var R=new String("abc");if(R[5]="de",Object.getOwnPropertyNames(R)[0]==="5")return!1;for(var F={},U=0;U<10;U++)F["_"+String.fromCharCode(U)]=U;var se=Object.getOwnPropertyNames(F).map(function(ct){return F[ct]});if(se.join("")!=="0123456789")return!1;var ve={};return"abcdefghijklmnopqrst".split("").forEach(function(ct){ve[ct]=ct}),Object.keys(Object.assign({},ve)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var objectAssign=shouldUseNative()?Object.assign:function(R,F){for(var U,se=toObject(R),ve,ct=1;ct<arguments.length;ct++){U=Object(arguments[ct]);for(var pt in U)hasOwnProperty.call(U,pt)&&(se[pt]=U[pt]);if(getOwnPropertySymbols){ve=getOwnPropertySymbols(U);for(var yt=0;yt<ve.length;yt++)propIsEnumerable.call(U,ve[yt])&&(se[ve[yt]]=U[ve[yt]])}}return se},isBlob$1=R=>typeof Blob=="undefined"?!1:R instanceof Blob||Object.prototype.toString.call(R)==="[object Blob]",clipPixels$1=function(F,U,se){for(var ve=U[2]||4,ct=U[0],pt=U[1]||Math.floor(F.length/ve/ct),yt=se[0],Et=se[1]||0,Xt=se[2]||ct-yt,Tt=se[3]||pt-Et,lr=Array(Xt*ve*Tt),jr=Et*ct*ve+yt*ve,Vr=0;Vr<Tt;Vr++)for(var ri=0;ri<Xt;ri++)for(var si=0;si<ve;si++)lr[Vr*Xt*ve+ri*ve+si]=F[jr+Vr*ct*ve+ri*ve+si];return lr},urlBrowser=function(R,F){return new Promise(function(U,se){var ve=new Image;ve.crossOrigin="Anonymous",ve.onload=function(){U(ve)},ve.onerror=function(ct){se(new Error("Bad image URL/path",ct))},ve.src=R})},imageType$1={exports:{}},fileType$1={exports:{}};(function(module){const toBytes=R=>[...R].map(F=>F.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(R,F=0){let U=R[F],se=1,ve=0;for(;++ve<8;)se*=256,U+=R[F+ve]*se;return U}const fileType=R=>{if(!(R instanceof Uint8Array||R instanceof ArrayBuffer||Buffer.isBuffer(R)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof R}\``);const F=R instanceof Uint8Array?R:new Uint8Array(R);if(!(F&&F.length>1))return null;const U=(ve,ct)=>{ct=Object.assign({offset:0},ct);for(let pt=0;pt<ve.length;pt++)if(ct.mask){if(ve[pt]!==(ct.mask[pt]&F[pt+ct.offset]))return!1}else if(ve[pt]!==F[pt+ct.offset])return!1;return!0},se=(ve,ct)=>U(toBytes(ve),ct);if(U([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(U([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(U([71,73,70]))return{ext:"gif",mime:"image/gif"};if(U([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(U([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((U([73,73,42,0])||U([77,77,0,42]))&&U([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(U([73,73,42,0])||U([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(U([66,77]))return{ext:"bmp",mime:"image/bmp"};if(U([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(U([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(U([80,75,3,4])){if(U([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(U(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(se("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(se("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(se("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const ve=(Et,Xt=0)=>Et.findIndex((Tt,lr,jr)=>lr>=Xt&&jr[lr]===80&&jr[lr+1]===75&&jr[lr+2]===3&&jr[lr+3]===4);let ct=0,pt=!1,yt=null;do{const Et=ct+30;if(pt||(pt=U(oxmlContentTypes,{offset:Et})||U(oxmlRels,{offset:Et})),yt||(se("word/",{offset:Et})?yt={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:se("ppt/",{offset:Et})?yt={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:se("xl/",{offset:Et})&&(yt={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),pt&&yt)return yt;ct=ve(F,Et)}while(ct>=0);if(yt)return yt}if(U([80,75])&&(F[2]===3||F[2]===5||F[2]===7)&&(F[3]===4||F[3]===6||F[3]===8))return{ext:"zip",mime:"application/zip"};if(U([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(U([82,97,114,33,26,7])&&(F[6]===0||F[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(U([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(U([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(U([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(U([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(U([51,103,112,53])||U([0,0,0])&&U([102,116,121,112],{offset:4})&&(U([109,112,52,49],{offset:8})||U([109,112,52,50],{offset:8})||U([105,115,111,109],{offset:8})||U([105,115,111,50],{offset:8})||U([109,109,112,52],{offset:8})||U([77,52,86],{offset:8})||U([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(U([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(U([26,69,223,163])){const ve=F.subarray(4,4100),ct=ve.findIndex((pt,yt,Et)=>Et[yt]===66&&Et[yt+1]===130);if(ct!==-1){const pt=ct+3,yt=Et=>[...Et].every((Xt,Tt)=>ve[pt+Tt]===Xt.charCodeAt(0));if(yt("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(yt("webm"))return{ext:"webm",mime:"video/webm"}}}if(U([0,0,0,20,102,116,121,112,113,116,32,32])||U([102,114,101,101],{offset:4})||U([102,116,121,112,113,116,32,32],{offset:4})||U([109,100,97,116],{offset:4})||U([109,111,111,118],{offset:4})||U([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(U([82,73,70,70])){if(U([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(U([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(U([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(U([48,38,178,117,142,102,207,17,166,217])){let ve=30;do{const ct=readUInt64LE(F,ve+16);if(U([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:ve})){if(U([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:ve+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(U([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:ve+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}ve+=ct}while(ve+24<=F.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(U([0,0,1,186])||U([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(U([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let ve=0;ve<2&&ve<F.length-16;ve++){if(U([73,68,51],{offset:ve})||U([255,226],{offset:ve,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(U([255,228],{offset:ve,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(U([255,248],{offset:ve,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(U([255,240],{offset:ve,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(U([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(U([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(U([79,103,103,83]))return U([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:U([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:U([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:U([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:U([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(U([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(U([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(U([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(U([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(U([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(U([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((F[0]===67||F[0]===70)&&U([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(U([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(U([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(U([119,79,70,70])&&(U([0,1,0,0],{offset:4})||U([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(U([119,79,70,50])&&(U([0,1,0,0],{offset:4})||U([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(U([76,80],{offset:34})&&(U([0,0,1],{offset:8})||U([1,0,2],{offset:8})||U([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(U([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(U([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(U([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(U([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(U([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(U([37,33]))return{ext:"ps",mime:"application/postscript"};if(U([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(U([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(U([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(U([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(U([77,83,67,70])||U([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(U([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(U([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(U([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(U([31,160])||U([31,157]))return{ext:"Z",mime:"application/x-compress"};if(U([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(U([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(U([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(U([71],{offset:4})&&(U([71],{offset:192})||U([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(U([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(U([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(U([0,0,0,12,106,80,32,32,13,10,135,10])){if(U([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(U([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(U([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(U([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(U([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(se("<?xml "))return{ext:"xml",mime:"application/xml"};if(U([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(U([102,116,121,112],{offset:4})){if(U([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(U([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(U([104,101,105,99],{offset:8})||U([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(U([104,101,118,99],{offset:8})||U([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return U([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:U([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:U([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:U([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:U([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:U([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:U([212,195,178,161])||U([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const R=new stream.PassThrough,F=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{R.fileType=fileType(F)}catch(U){reject(U)}readableStream.unshift(F),stream.pipeline?resolve(stream.pipeline(readableStream,R,()=>{})):resolve(readableStream.pipe(R))})})})(fileType$1);const fileType=fileType$1.exports,imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=R=>{const F=fileType(R);return imageExts.has(F&&F.ext)?F:null};imageType$1.exports=imageType;imageType$1.exports.default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType.minimumBytes});var browser=function R(F,U){U==null&&(U="utf8");var se=new Uint8Array(F);if(U==="hex"){for(var ve="",ct=0,pt=se.byteLength;ct<pt;++ct)ve+=toHex(se[ct]);return ve}if(U==="base64")return Et=String.fromCharCode.apply(null,se),btoa(Et);if(U==="binary"||U==="latin1"||!commonjsGlobal.TextDecoder)return Et=String.fromCharCode.apply(null,se),Et;U==="utf16le"&&(U="utf-16le");var yt=new TextDecoder(U),Et=yt.decode(se);return Et};function toHex(R){return R<16?"0"+R.toString(16):R.toString(16)}var primitivePool=getKey,cache$3={},nullObj={},undefinedObj={};function getKey(R){if(Array.isArray(R)&&R.raw&&(R=String.raw.apply(this,arguments)),R===null)return nullObj;if(R===void 0)return undefinedObj;var F;return typeof R=="number"||R instanceof Number?cache$3[R]?cache$3[R]:(F=new Number(R),cache$3[R]=F,F):typeof R=="string"||R instanceof String?cache$3[R]?cache$3[R]:(F=new String(R),cache$3[R]=F,F):typeof R=="boolean"||R instanceof Boolean?cache$3[R]?cache$3[R]:(F=new Boolean(R),cache$3[R]=F,F):R}var weakMap={exports:{}};(function R(){if(typeof ses!="undefined"&&ses.ok&&!ses.ok())return;function F(Jr){Jr.permitHostObjects___&&Jr.permitHostObjects___(F)}typeof ses!="undefined"&&(ses.weakMapPermitHostObjects=F);var U=!1;if(typeof WeakMap=="function"){var se=WeakMap;if(!(typeof navigator!="undefined"&&/Firefox/.test(navigator.userAgent))){var ve=new se,ct=Object.freeze({});if(ve.set(ct,1),ve.get(ct)!==1)U=!0;else{weakMap.exports=WeakMap;return}}}var pt=Object.getOwnPropertyNames,yt=Object.defineProperty,Et=Object.isExtensible,Xt="weakmap:",Tt=Xt+"ident:"+Math.random()+"___";if(typeof crypto!="undefined"&&typeof crypto.getRandomValues=="function"&&typeof ArrayBuffer=="function"&&typeof Uint8Array=="function"){var lr=new ArrayBuffer(25),jr=new Uint8Array(lr);crypto.getRandomValues(jr),Tt=Xt+"rand:"+Array.prototype.map.call(jr,function(Jr){return(Jr%36).toString(36)}).join("")+"___"}function Vr(Jr){return!(Jr.substr(0,Xt.length)==Xt&&Jr.substr(Jr.length-3)==="___")}if(yt(Object,"getOwnPropertyNames",{value:function(ei){return pt(ei).filter(Vr)}}),"getPropertyNames"in Object){var ri=Object.getPropertyNames;yt(Object,"getPropertyNames",{value:function(ei){return ri(ei).filter(Vr)}})}function si(Jr){if(Jr!==Object(Jr))throw new TypeError("Not an object: "+Jr);var ei=Jr[Tt];if(ei&&ei.key===Jr)return ei;if(!!Et(Jr)){ei={key:Jr};try{return yt(Jr,Tt,{value:ei,writable:!1,enumerable:!1,configurable:!1}),ei}catch{return}}}(function(){var Jr=Object.freeze;yt(Object,"freeze",{value:function(hi){return si(hi),Jr(hi)}});var ei=Object.seal;yt(Object,"seal",{value:function(hi){return si(hi),ei(hi)}});var oi=Object.preventExtensions;yt(Object,"preventExtensions",{value:function(hi){return si(hi),oi(hi)}})})();function Zr(Jr){return Jr.prototype=null,Object.freeze(Jr)}var di=!1;function gi(){!di&&typeof console!="undefined"&&(di=!0,console.warn("WeakMap should be invoked as new WeakMap(), not WeakMap(). This will be an error in the future."))}var ui=0,pi=function(){this instanceof pi||gi();var Jr=[],ei=[],oi=ui++;function ai(ci,ni){var ti,mi=si(ci);return mi?oi in mi?mi[oi]:ni:(ti=Jr.indexOf(ci),ti>=0?ei[ti]:ni)}function hi(ci){var ni=si(ci);return ni?oi in ni:Jr.indexOf(ci)>=0}function fi(ci,ni){var ti,mi=si(ci);return mi?mi[oi]=ni:(ti=Jr.indexOf(ci),ti>=0?ei[ti]=ni:(ti=Jr.length,ei[ti]=ni,Jr[ti]=ci)),this}function ii(ci){var ni=si(ci),ti,mi;return ni?oi in ni&&delete ni[oi]:(ti=Jr.indexOf(ci),ti<0?!1:(mi=Jr.length-1,Jr[ti]=void 0,ei[ti]=ei[mi],Jr[ti]=Jr[mi],Jr.length=mi,ei.length=mi,!0))}return Object.create(pi.prototype,{get___:{value:Zr(ai)},has___:{value:Zr(hi)},set___:{value:Zr(fi)},delete___:{value:Zr(ii)}})};pi.prototype=Object.create(Object.prototype,{get:{value:function(ei,oi){return this.get___(ei,oi)},writable:!0,configurable:!0},has:{value:function(ei){return this.has___(ei)},writable:!0,configurable:!0},set:{value:function(ei,oi){return this.set___(ei,oi)},writable:!0,configurable:!0},delete:{value:function(ei){return this.delete___(ei)},writable:!0,configurable:!0}}),typeof se=="function"?function(){U&&typeof Proxy!="undefined"&&(Proxy=void 0);function Jr(){this instanceof pi||gi();var ei=new se,oi=void 0,ai=!1;function hi(ni,ti){return oi?ei.has(ni)?ei.get(ni):oi.get___(ni,ti):ei.get(ni,ti)}function fi(ni){return ei.has(ni)||(oi?oi.has___(ni):!1)}var ii;U?ii=function(ni,ti){return ei.set(ni,ti),ei.has(ni)||(oi||(oi=new pi),oi.set(ni,ti)),this}:ii=function(ni,ti){if(ai)try{ei.set(ni,ti)}catch{oi||(oi=new pi),oi.set___(ni,ti)}else ei.set(ni,ti);return this};function ci(ni){var ti=!!ei.delete(ni);return oi&&oi.delete___(ni)||ti}return Object.create(pi.prototype,{get___:{value:Zr(hi)},has___:{value:Zr(fi)},set___:{value:Zr(ii)},delete___:{value:Zr(ci)},permitHostObjects___:{value:Zr(function(ni){if(ni===F)ai=!0;else throw new Error("bogus call to permitHostObjects___")})}})}Jr.prototype=pi.prototype,weakMap.exports=Jr,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():(typeof Proxy!="undefined"&&(Proxy=void 0),weakMap.exports=pi)})();var p=primitivePool,WeakMap$1=weakMap.exports,cache$2=new WeakMap$1,cache_1={get:function(R){return cache$2.get(p(R))},set:function(R,F){return Array.isArray(R)||(R=[R]),R.forEach(function(U){!U||cache$2.get(p(U))||cache$2.set(p(U),F)}),F}},imgType=imageType$1.exports,tostr=browser,cache$1=cache_1,canvas$1,context$1,rawBrowser=function R(F,U){var se=U.shape[0],ve=U.shape[1],ct=U.clip,pt=U.type;if(canvas$1||(canvas$1=document.createElement("canvas"),context$1=canvas$1.getContext("2d")),canvas$1.width=se,canvas$1.height=ve,F instanceof Uint8Array||F instanceof Uint8ClampedArray){if(pt||(pt=imgType(F),pt=pt&&pt.mime),pt){var yt=F;return new Promise(function(Tt,lr){var jr=new Image;jr.crossOrigin="Anonymous",jr.onload=function(){U.shape[0]||(U.shape[0]=jr.width),U.shape[1]||(U.shape[1]=jr.height),Tt(R(jr,U))},jr.onerror=function(Vr){lr(Vr)},jr.src=["data:"+pt,"base64,"+tostr(yt,"base64")].join(";")})}if(!se||!ve)throw new Error("Raw data requires options.width and options.height");var Et=context$1.createImageData(se,ve);Et.data.set(F),context$1.putImageData(Et,0,0)}else context$1.drawImage(F,0,0);var Xt;return U.cache&&(Xt=context$1.getImageData(0,0,se,ve),cache$1.set(U.cache,Xt)),Xt=context$1.getImageData(ct.x,ct.y,ct.width||se,ct.height||ve),Promise.resolve(Xt)},flipPixels=function R(F,U,se,ve){if(Array.isArray(F)){for(var ct=R(new Float64Array(F),U,se,ve),pt=0;pt<F.length;pt++)F[pt]=ct[pt];return F}if(!U||!se)throw Error("Bad dimensions");ve||(ve=F.length/(U*se));for(var yt=se>>1,Et=U*ve,Xt=F.constructor,Tt=new Xt(U*ve),lr=0;lr<yt;++lr){var jr=lr*Et,Vr=(se-lr-1)*Et;Tt.set(F.subarray(jr,jr+Et)),F.copyWithin(jr,Vr,Vr+Et),F.set(Tt,Vr)}return F},flipData=flipPixels,clipData=clipPixels$1,canvas,ctx,gl=function R(F,U){var se=U.shape[0],ve=U.shape[1],ct=U.clip;if(F.canvas){ctx||(canvas=document.createElement("canvas"),ctx=canvas.getContext("2d")),canvas.width=F.drawingBufferWidth,canvas.height=F.drawingBufferHeight,ctx.drawImage(F.canvas,0,0,F.drawingBufferWidth,F.drawingBufferHeight);var yt=ctx.getImageData(ct.x,ct.y,ct.width||se,ct.height||ve);return yt}var pt=new Uint8Array(F.drawingBufferWidth*F.drawingBufferHeight*4);F.readPixels(0,0,F.drawingBufferWidth,F.drawingBufferHeight,F.RGBA,F.UNSIGNED_BYTE,pt);var yt={};return yt.width=F.drawingBufferWidth,yt.height=F.drawingBufferHeight,pt=flipData(pt,yt.width,yt.height),yt.data=pt,(ct.x||ct.y||ct.width&&ct.width!==yt.width||ct.height&&ct.height!==yt.height)&&(pt=new Uint8Array(clipData(pt,[yt.width,yt.height],[ct.x,ct.y,ct.width,ct.height])),yt.data=pt,yt.width=ct.width,yt.height=ct.height),Promise.resolve(yt)},atobBrowser=function R(F){return atob(F)},atob$1=atobBrowser,isBase64$1=isBase64$2.exports,stringToArraybuffer=function R(F){if(typeof F!="string")throw Error("Argument should be a string");return/^data\:/i.test(F)?decode(F):(isBase64$1(F)&&(F=atob$1(F)),str2ab$1(F))};function str2ab$1(R){for(var F=new Uint8Array(R.length),U=0;U<R.length;U++)F[U]=R.charCodeAt(U);return F.buffer}function decode(R){R=R.replace(/\r?\n/g,"");var F=R.indexOf(",");if(F===-1||F<=4)throw new TypeError("malformed data-URI");for(var U=R.substring(5,F).split(";"),se=!1,ve="US-ASCII",ct=0;ct<U.length;ct++)U[ct]=="base64"?se=!0:U[ct].indexOf("charset=")==0&&(ve=U[ct].substring(8));var pt=unescape(R.substring(F+1));se&&(pt=atob$1(pt));var yt=str2ab$1(pt);return yt.type=U[0]||"text/plain",yt.charset=ve,yt}var dtype$1=function(R){switch(R){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}},dtype=dtype$1,flattenVertexData_1=flattenVertexData;function flattenVertexData(R,F,U){if(!R)throw new TypeError("must specify data as first parameter");if(U=+(U||0)|0,Array.isArray(R)&&R[0]&&typeof R[0][0]=="number"){var se=R[0].length,ve=R.length*se,ct,pt,yt,Et;(!F||typeof F=="string")&&(F=new(dtype(F||"float32"))(ve+U));var Xt=F.length-U;if(ve!==Xt)throw new Error("source length "+ve+" ("+se+"x"+R.length+") does not match destination length "+Xt);for(ct=0,yt=U;ct<R.length;ct++)for(pt=0;pt<se;pt++)F[yt++]=R[ct][pt]===null?NaN:R[ct][pt]}else if(!F||typeof F=="string"){var Tt=dtype(F||"float32");if(Array.isArray(R)||F==="array")for(F=new Tt(R.length+U),ct=0,yt=U,Et=F.length;yt<Et;yt++,ct++)F[yt]=R[ct]===null?NaN:R[ct];else U===0?F=new Tt(R):(F=new Tt(R.length+U),F.set(R,U))}else F.set(R,U);return F}var str2ab=stringToArraybuffer,flat$3=flattenVertexData_1,toArrayBuffer=function R(F){if(!F)return null;if(F instanceof ArrayBuffer)return F;if(typeof F=="string")return str2ab(F);if(ArrayBuffer.isView(F))return F.byteOffset?F.buffer.slice(F.byteOffset,F.byteOffset+F.byteLength):F.buffer;if(F.buffer||F.data||F._data){var se=R(F.buffer||F.data||F._data);return se}if(Array.isArray(F)){for(var U=0;U<F.length;U++)if(F[U].length!=null){F=flat$3(F);break}}var se=new Uint8Array(F);return se.length?se.buffer:null},isFloatArray=function R(F){return!F||F.length==null?!1:!!(Array.isArray(F)||F instanceof Float64Array||F instanceof Float32Array)},clamp_1=clamp$1;function clamp$1(R,F,U){return F<U?R<F?F:R>U?U:R:R<U?U:R>F?F:R}/*!
 * arr-flatten <https://github.com/jonschlinkert/arr-flatten>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var arrFlatten=function(R){return flat$2(R,[])};function flat$2(R,F){for(var U=0,se,ve=R.length;U<ve;U++)se=R[U],Array.isArray(se)?flat$2(se,F):F.push(se);return F}var toab=toArrayBuffer,isFloat=isFloatArray,clamp=clamp_1,flat$1=arrFlatten,toUint8=function R(F,U){if(!F)return null;if(F.data&&(F=F.data),F instanceof Uint8Array)return F;if(F instanceof Uint8ClampedArray)return new Uint8Array(F.buffer);if(U==null&&(U=!0),Array.isArray(F)){for(var se=0;se<F.length;se++)if(F[se]&&F[se].length!=null){F=flat$1(F);break}}if(isFloat(F)){if(U){for(var se=0;se<F.length;se++)if(F[se]>1||F[se]<0)return uninfinite(new Uint8Array(F),F)}for(var ve=new Uint8Array(F.length),se=0;se<F.length;se++)ve[se]=clamp(F[se],0,1)*255;return uninfinite(ve,F)}if(F.length!=null&&typeof F!="string")return uninfinite(new Uint8Array(F),F);var ct=toab(F);return ct?uninfinite(new Uint8Array(ct),F):null};function uninfinite(R,F){for(var U=0;U<F.length;U++)F[U]===1/0&&(R[U]=255);return R}function isNumber$3(R){return(typeof R=="number"||Object.prototype.toString.call(R)==="[object Number]")&&R.valueOf()===R.valueOf()}var lib$i=isNumber$3,isNumber$2=lib$i;function isInteger$5(R){return isNumber$2(R)&&R%1===0}var lib$h=isInteger$5,isInteger$4=lib$h;function isPositiveInteger$1(R){return isInteger$4(R)&&R>0}var lib$g=isPositiveInteger$1;function isArray$3(R){return Object.prototype.toString.call(R)==="[object Array]"}var lib$f=Array.isArray||isArray$3;function ndarrayLike$1(R){return R!==null&&typeof R=="object"&&typeof R.data=="object"&&typeof R.shape=="object"&&typeof R.strides=="object"&&typeof R.offset=="number"&&typeof R.dtype=="string"&&typeof R.length=="number"}var lib$e=ndarrayLike$1,isInteger$3=lib$h;function isNonNegativeInteger$1(R){return isInteger$3(R)&&R>=0}var lib$d=isNonNegativeInteger$1,lib$c=Number.POSITIVE_INFINITY;function isBuffer$3(R){return typeof R=="object"&&R!==null&&(R._isBuffer||R.constructor&&typeof R.constructor.isBuffer=="function"&&R.constructor.isBuffer(R))}var lib$b=isBuffer$3,toStr$2=Object.prototype.toString;function funcName(R){if(R.name)return R.name;var F=/^\s*function\s*([^\(]*)/im.exec(R.toString());return F?F[1]:""}function ctorName(R){var F=toStr$2.call(R).slice(8,-1);return(F==="Object"||F==="Error")&&R.constructor?funcName(R.constructor):F}function typeName$1(R){var F;return R===null?"null":(F=typeof R,F==="object"?ctorName(R):F)}var typeName_1=typeName$1;function isString$1(R){return typeof R=="string"}var lib$a=isString$1,re=/^\/((?:\\\/|[^\/])+)\/([imgy]*)$/,lib$9=re,isString=lib$a,RE=lib$9;function regex$1(R){if(!isString(R))throw new TypeError("invalid input argument. Must provide a regular expression string. Value: `"+R+"`.");return R=RE.exec(R),R?new RegExp(R[1],R[2]):null}var lib$8=regex$1,toStr$1=Object.prototype.toString,isArguments=function R(F){var U=toStr$1.call(F),se=U==="[object Arguments]";return se||(se=U!=="[object Array]"&&F!==null&&typeof F=="object"&&typeof F.length=="number"&&F.length>=0&&toStr$1.call(F.callee)==="[object Function]"),se},keysShim$1;if(!Object.keys){var has=Object.prototype.hasOwnProperty,toStr=Object.prototype.toString,isArgs$1=isArguments,isEnumerable=Object.prototype.propertyIsEnumerable,hasDontEnumBug=!isEnumerable.call({toString:null},"toString"),hasProtoEnumBug=isEnumerable.call(function(){},"prototype"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],equalsConstructorPrototype=function(R){var F=R.constructor;return F&&F.prototype===R},excludedKeys={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},hasAutomationEqualityBug=function(){if(typeof window=="undefined")return!1;for(var R in window)try{if(!excludedKeys["$"+R]&&has.call(window,R)&&window[R]!==null&&typeof window[R]=="object")try{equalsConstructorPrototype(window[R])}catch{return!0}}catch{return!0}return!1}(),equalsConstructorPrototypeIfNotBuggy=function(R){if(typeof window=="undefined"||!hasAutomationEqualityBug)return equalsConstructorPrototype(R);try{return equalsConstructorPrototype(R)}catch{return!1}};keysShim$1=function(F){var U=F!==null&&typeof F=="object",se=toStr.call(F)==="[object Function]",ve=isArgs$1(F),ct=U&&toStr.call(F)==="[object String]",pt=[];if(!U&&!se&&!ve)throw new TypeError("Object.keys called on a non-object");var yt=hasProtoEnumBug&&se;if(ct&&F.length>0&&!has.call(F,0))for(var Et=0;Et<F.length;++Et)pt.push(String(Et));if(ve&&F.length>0)for(var Xt=0;Xt<F.length;++Xt)pt.push(String(Xt));else for(var Tt in F)!(yt&&Tt==="prototype")&&has.call(F,Tt)&&pt.push(String(Tt));if(hasDontEnumBug)for(var lr=equalsConstructorPrototypeIfNotBuggy(F),jr=0;jr<dontEnums.length;++jr)!(lr&&dontEnums[jr]==="constructor")&&has.call(F,dontEnums[jr])&&pt.push(dontEnums[jr]);return pt}}var implementation=keysShim$1,slice=Array.prototype.slice,isArgs=isArguments,origKeys=Object.keys,keysShim=origKeys?function R(F){return origKeys(F)}:implementation,originalKeys=Object.keys;keysShim.shim=function R(){if(Object.keys){var F=function(){var U=Object.keys(arguments);return U&&U.length===arguments.length}(1,2);F||(Object.keys=function(se){return isArgs(se)?originalKeys(slice.call(se)):originalKeys(se)})}else Object.keys=keysShim;return Object.keys||keysShim};var objectKeys$2=keysShim,deepCopy$2=lib$1,getKeys=objectKeys$2.shim();function copy(R){var F,U,se,ve,ct;if(!(R instanceof Error))throw new TypeError("invalid input argument. Must provide an error object. Value: `"+R+"`.");for(ve=new R.constructor(R.message),R.stack&&(ve.stack=R.stack),R.code&&(ve.code=R.code),R.errno&&(ve.errno=R.errno),R.syscall&&(ve.syscall=R.syscall),F=getKeys(R),ct=0;ct<F.length;ct++)se=F[ct],U=Object.getOwnPropertyDescriptor(R,se),U.hasOwnProperty("value")&&(U.value=deepCopy$2(R[se])),Object.defineProperty(ve,se,U);return ve}var copy_1=copy,lib$7=copy_1;function isNumber$1(R){return typeof R=="number"&&R===R}var lib$6=isNumber$1,isNumber=lib$6;function isInteger$2(R){return isNumber(R)&&R%1===0}var lib$5=isInteger$2,lib$4=4294967295,isInteger$1=lib$5,MAX=lib$4;function isArrayLike$1(R){return R!=null&&typeof R!="function"&&isInteger$1(R.length)&&R.length>=0&&R.length<=MAX}var lib$3=isArrayLike$1,isArrayLike=lib$3,isInteger=lib$5;function indexOf$1(R,F,U){var se,ve;if(!isArrayLike(R))throw new TypeError("invalid input argument. First argument must be an array-like object. Value: `"+R+"`.");if(se=R.length,se===0)return-1;if(arguments.length===3){if(!isInteger(U))throw new TypeError("invalid input argument. `fromIndex` must be an integer. Value: `"+U+"`.");if(U>=0){if(U>=se)return-1;ve=U}else ve=se+U,ve<0&&(ve=0)}else ve=0;if(F!==F){for(;ve<se;ve++)if(R[ve]!==R[ve])return ve}else for(;ve<se;ve++)if(R[ve]===F)return ve;return-1}var lib$2=indexOf$1,objectKeys$1=objectKeys$2,typedArrays$1={Int8Array:null,Uint8Array:null,Uint8ClampedArray:null,Int16Array:null,Uint16Array:null,Int32Array:null,Uint32Array:null,Float32Array:null,Float64Array:null};(function R(){var F=objectKeys$1(typedArrays$1),U=F.length,se,ve;for(ve=0;ve<U;ve++)se=F[ve],typedArrays$1[se]=new Function("arr","return new "+se+"( arr );")})();var typedarrays=typedArrays$1,isArray$2=lib$f,isBuffer$2=lib$b,typeName=typeName_1,regex=lib$8,copyError=lib$7,indexOf=lib$2,objectKeys=objectKeys$2,typedArrays=typedarrays;function cloneInstance(R){var F=[],U=[],se,ve,ct,pt,yt,Et;for(yt=Object.create(Object.getPrototypeOf(R)),F.push(R),U.push(yt),se=Object.getOwnPropertyNames(R),Et=0;Et<se.length;Et++)ve=se[Et],ct=Object.getOwnPropertyDescriptor(R,ve),ct.hasOwnProperty("value")&&(pt=isArray$2(R[ve])?[]:{},ct.value=deepCopy$1(R[ve],pt,F,U,-1)),Object.defineProperty(yt,ve,ct);return Object.isExtensible(R)||Object.preventExtensions(yt),Object.isSealed(R)&&Object.seal(yt),Object.isFrozen(R)&&Object.freeze(yt),yt}function deepCopy$1(R,F,U,se,ve){var ct,pt,yt,Et,Xt,Tt,lr,jr,Vr,ri;if(ve=ve-1,typeof R!="object"||R===null)return R;if(isBuffer$2(R))return new Buffer(R);if(R instanceof Error)return copyError(R);if(yt=typeName(R),yt==="Date")return new Date(+R);if(yt==="RegExp")return regex(R.toString());if(yt==="Set")return new Set(R);if(yt==="Map")return new Map(R);if(yt==="String"||yt==="Boolean"||yt==="Number")return R.valueOf();if(Xt=typedArrays[yt],Xt)return Xt(R);if(yt!=="Array"&&yt!=="Object")return typeof Object.freeze=="function"?cloneInstance(R):{};if(pt=objectKeys(R),ve>0)for(ct=yt,ri=0;ri<pt.length;ri++){if(Tt=pt[ri],jr=R[Tt],yt=typeName(jr),typeof jr!="object"||jr===null||yt!=="Array"&&yt!=="Object"||isBuffer$2(jr)){ct==="Object"?(Et=Object.getOwnPropertyDescriptor(R,Tt),Et.hasOwnProperty("value")&&(Et.value=deepCopy$1(jr)),Object.defineProperty(F,Tt,Et)):F[Tt]=deepCopy$1(jr);continue}if(Vr=indexOf(U,jr),Vr!==-1){F[Tt]=se[Vr];continue}lr=isArray$2(jr)?[]:{},U.push(jr),se.push(lr),ct==="Array"?F[Tt]=deepCopy$1(jr,lr,U,se,ve):(Et=Object.getOwnPropertyDescriptor(R,Tt),Et.hasOwnProperty("value")&&(Et.value=deepCopy$1(jr,lr,U,se,ve)),Object.defineProperty(F,Tt,Et))}else if(yt==="Array")for(ri=0;ri<pt.length;ri++)Tt=pt[ri],F[Tt]=R[Tt];else for(ri=0;ri<pt.length;ri++)Tt=pt[ri],Et=Object.getOwnPropertyDescriptor(R,Tt),Object.defineProperty(F,Tt,Et);return Object.isExtensible(R)||Object.preventExtensions(F),Object.isSealed(R)&&Object.seal(F),Object.isFrozen(R)&&Object.freeze(F),F}var deepcopy=deepCopy$1,isArray$1=lib$f,isNonNegativeInteger=lib$d,PINF=lib$c,deepCopy=deepcopy;function createCopy$1(R,F){var U;if(arguments.length>1){if(!isNonNegativeInteger(F))throw new TypeError("invalid input argument. Level must be a nonnegative integer. Value: `"+F+"`.");if(F===0)return R}else F=PINF;return U=isArray$1(R)?[]:{},deepCopy(R,U,[R],[U],F)}var lib$1=createCopy$1,isPositiveInteger=lib$g,isArray=lib$f,ndarrayLike=lib$e,createCopy=lib$1;function dims$1(R,F,U){U&&F.length===U||!isArray(R[0])||(F.push(R[0].length),dims$1(R[0],F,U))}function check(R,F){for(var U=R.length,se=F.shift(),ve=F.length,ct,pt,yt=0;yt<U;yt++)if(ct=R[yt],!isArray(ct)||ct.length!==se||ve&&(pt=check(ct,F.slice()),!pt))return!1;return!0}function compute(R,F){var U,se;if(arguments.length>1&&!isPositiveInteger(F))throw new TypeError("dims()::invalid input argument. `max` option must be a positive integer.");if(ndarrayLike(R)===!0)return U=createCopy(R.shape),F&&F<=U.length&&(U.length=F),U;if(isArray(R))return U=[R.length],dims$1(R,U,F),U.length>1&&(se=check(R,U.slice(1)),!se)?null:U;throw new TypeError("dims()::invalid input argument. Must provide an array, matrix or ndarray.")}var lib=compute;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var isBuffer$1=function R(F){return F!=null&&F.constructor!=null&&typeof F.constructor.isBuffer=="function"&&F.constructor.isBuffer(F)},u8=toUint8,dims=lib,flat=arrFlatten,isBuffer=isBuffer$1,flip=flipPixels,pxls_1=pxls$1,context;function pxls$1(R,F){if(!R)return R;if(isNdarray(R)){var U=0;if(R.shape[2]===3){for(var se=R.shape[0]*R.shape[1],ve=Array(se<<2),ct=!1,pt=0;pt<R.shape[0];pt++)for(var yt=0;yt<R.shape[1];yt++){var Et=R.get(yt,pt,0),Xt=R.get(yt,pt,1),Tt=R.get(yt,pt,2);ve[U<<2]=Et,ve[(U<<2)+1]=Xt,ve[(U<<2)+2]=Tt,!ct&&(Et>1||Xt>1||Tt>1)&&(ct=!0),U++}for(var lr=ct?255:1,U=0;U<se;U++)ve[(U<<2)+3]=lr;R=ve}else if(R.shape[2]===1||!R.shape[2]){for(var se=R.shape[0]*R.shape[1],ve=Array(se<<2),ct=!1,pt=0;pt<R.shape[0];pt++)for(var yt=0;yt<R.shape[1];yt++){var Et=R.get(yt,pt,0);ve[U<<2]=Et,ve[(U<<2)+1]=Et,ve[(U<<2)+2]=Et,!ct&&Et>1&&(ct=!0),U++}for(var lr=ct?255:1,U=0;U<se;U++)ve[(U<<2)+3]=lr;R=ve}else R=R.data;return u8(R)}var jr,Vr;if(Array.isArray(F)&&(jr=F[0],Vr=F[1],F=F[2]),jr||(jr=R.shape?R.shape[0]:R.width),Vr||(Vr=R.shape?R.shape[1]:R.height),(R.gl||R._gl||R.regl)&&(R=R.regl?R.regl._gl:R.gl||R._gl),R.readPixels){var ri=R,si=new Uint8Array(ri.drawingBufferWidth*ri.drawingBufferHeight*4);return ri.readPixels(0,0,ri.drawingBufferWidth,ri.drawingBufferHeight,ri.RGBA,ri.UNSIGNED_BYTE,si),flip(si,ri.drawingBufferWidth,ri.drawingBufferHeight)}if(R.canvas&&(R=R.canvas),(R.tagName||typeof ImageBitmap!="undefined"&&R instanceof ImageBitmap)&&(context||(context=document.createElement("canvas").getContext("2d")),context.canvas.width=R.width||jr,context.canvas.height=R.height||Vr,context.drawImage(R,0,0),R=context.getImageData(0,0,context.canvas.width,context.canvas.height)),R.data&&(R=R.data),Array.isArray(R)){var Zr=dims(R,3);Zr&&(Zr[2]?F=Zr[2]:Zr[1]&&Zr[1]<=4&&(F=Zr[1])),R=flat(R)}if(F==null&&jr&&Vr&&(F=Math.floor(R.length/(jr*Vr))),(R instanceof ArrayBuffer||isBuffer(R))&&(R=new Uint8Array(R)),R.length==null)return null;if(F===3){for(var se=Math.floor(R.length/3),ve=Array(se<<2),ct=!1,U=0;U<se;U++){var Et=R[U*3],Xt=R[U*3+1],Tt=R[U*3+2];ve[U<<2]=Et,ve[(U<<2)+1]=Xt,ve[(U<<2)+2]=Tt,!ct&&(Et>1||Xt>1||Tt>1)&&(ct=!0)}for(var lr=ct?255:1,U=0;U<se;U++)ve[(U<<2)+3]=lr;R=ve}else if(F===1){for(var se=R.length,ve=Array(se<<2),ct=!1,U=0;U<se;U++){var Et=R[U];ve[U<<2]=Et,ve[(U<<2)+1]=Et,ve[(U<<2)+2]=Et,!ct&&Et>1&&(ct=!0)}for(var lr=ct?255:1,U=0;U<se;U++)ve[(U<<2)+3]=lr;R=ve}return u8(R)}function isNdarray(R){return R&&R.shape&&R.stride&&R.offset!=null&&R.dtype}var isObj=isPlainObj,isBase64=isBase64$2.exports,rect=parseRect_1,extend=objectAssign,isBlob=isBlob$1,clipPixels=clipPixels$1,loadUrl=urlBrowser,loadRaw=rawBrowser,loadGl=gl,cache=cache_1,pxls=pxls_1;imagePixels.exports=function(R,F,U){return Array.isArray(R)&&R.raw&&(R=String.raw.apply(this,arguments)),typeof F=="function"&&(U=F,F=isObj(R)?R:null),getPixels(R,F).then(function(se){return cache.get(se)||cache.set(se,se),U&&U(null,se),se},function(se){throw U&&U(se),se})};imagePixels.exports.cache=cache;imagePixels.exports.all=function R(F,U,se){if(!F)return null;if(typeof U=="function"&&(se=U,U=null),Array.isArray(F)){var ct=F.map(function(Et){return getPixels(Et,U)});return Promise.all(ct).then(function(Et){return se&&se(null,Et),Et},function(Et){return se&&se(Et),Promise.reject(Et)})}var ve={},ct=[];for(var pt in F)ve[pt]=ct.push(getPixels(F[pt],U))-1;return Promise.all(ct).then(function(yt){var Et={};for(var Xt in ve)Et[Xt]=yt[ve[Xt]];return se&&se(null,Et),Et},function(yt){return se&&se(yt),Promise.reject(yt)})};function getPixels(R,F){typeof F=="string"?F={type:F}:F?Array.isArray(F)?F={shape:F}:F=extend({},F):F={};var U;isObj(R)&&(F=extend(R,F)),(F.src||F.source)&&(R=F.src||F.source),isObj(R)&&(R.src||R.source)&&(R=R.src||R.source),R||(R={}),F.cache==null&&(F.cache=!0);var se,ve,ct=F.clip&&rect(F.clip)||{x:0,y:0},pt=F.type||F.mime;if(U=checkCached(R,ct))return U;var yt=[];if(Xt(F),Xt(R),(isBlob(R)||R instanceof File)&&(R=URL.createObjectURL(R),yt.push(R),U=checkCached(R,ct)))return U;if(typeof R=="string")return R?(yt.push(R),isBase64(R,{mime:!1})?(R=pxls(R),loadRaw(R,{type:pt,cache:F.cache&&yt,shape:[se,ve],clip:ct})):loadUrl(R).then(function(Tt){return(U=checkCached(Tt,ct))?U:(Xt(Tt),loadRaw(Tt,{type:pt,cache:F.cache&&yt,shape:[se,ve],clip:ct}))})):Promise.reject(new Error("Bad URL"));if(R.tagName){if(R.tagName.toLowerCase()==="image"){var Et=R.getAttribute("xlink:href");if(R=new Image,R.src=Et,U=checkCached(Et,ct))return U}if(R.tagName.toLowerCase()==="picture"&&(R=R.querySelector("img"),U=checkCached(R,ct)))return U;if(R.tagName.toLowerCase()==="img")return(U=checkCached(R.src,ct))?U:(yt.push(R.src),R.complete?(Xt(R),loadRaw(R,{type:pt,cache:F.cache&&yt,shape:[se,ve],clip:ct})):new Promise(function(Tt,lr){R.addEventListener("load",function(){Xt(R),Tt(R)}),R.addEventListener("error",function(jr){lr(jr)})}).then(function(Tt){return loadRaw(Tt,{type:pt,cache:F.cache&&yt,shape:[se,ve],clip:ct})}));if(commonjsGlobal.HTMLMediaElement&&R instanceof HTMLMediaElement)return(U=checkCached(R.src,ct))?U:(yt.push(R.src),R.readyState?(Xt({w:R.videoWidth,h:R.videoHeight}),loadRaw(R,{type:pt,cache:F.cache&&yt,shape:[se,ve],clip:ct})):new Promise(function(Tt,lr){R.addEventListener("loadeddata",function(){Xt({w:R.videoWidth,h:R.videoHeight}),Tt(R)}),R.addEventListener("error",function(jr){lr(new Error("Bad video src `"+R.src+"`"))})}).then(function(Tt){return loadRaw(Tt,{type:pt,cache:F.cache&&yt,shape:[se,ve],clip:ct})}))}return Promise.resolve(R).then(function(Tt){if(U=checkCached(Tt,ct))return U;var lr=Tt.readPixels||Tt.getImageData?Tt:Tt._gl||Tt.gl||Tt.context||Tt.ctx||Tt.getContext&&(Tt.getContext("2d")||Tt.getContext("webgl"));if(lr){if(Xt(lr),lr.readPixels){var jr=loadGl(lr,{type:pt,shape:[se,ve],clip:ct});return jr}return Xt(lr.canvas),loadRaw(lr.canvas,{type:pt,shape:[se,ve],clip:ct})}return Xt(Tt),Tt=pxls(Tt)||Tt,yt.push(Tt),loadRaw(Tt,{type:pt,cache:F.cache&&yt,shape:[se,ve],clip:ct})});function Xt(Tt){(!se||typeof se!="number")&&(se=Tt&&Tt.shape&&Tt.shape[0]||Tt.width||Tt.w||Tt.drawingBufferWidth),(!ve||typeof ve!="number")&&(ve=Tt&&Tt.shape&&Tt.shape[1]||Tt.height||Tt.h||Tt.drawingBufferHeight)}}function checkCached(R,F){var U=cache.get(R);if(U)return(F.x||F.y||F.width&&F.width!==U.width||F.height&&F.height!==U.height)&&(U={data:new Uint8Array(clipPixels(U.data,[U.width,U.height],[F.x,F.y,F.width,F.height])),width:F.width,height:F.height}),Promise.resolve(U)}var getPixels$1=imagePixels.exports;export{logout as a,share as b,createLink as c,analytics as d,isLoggedIn as e,getPixels$1 as g,init as i,login as l,processImageDataRGBA as p,storage as s};
